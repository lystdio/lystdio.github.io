<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
































<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/blog/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/blog/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Mist',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="撼地神牛">
<meta property="og:url" content="https://handishenniu.coding.me/blog/page/23/index.html">
<meta property="og:site_name" content="撼地神牛">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="撼地神牛">






  <link rel="canonical" href="https://handishenniu.coding.me/blog/page/23/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>撼地神牛</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?304ebec1c594afeac3282f7afb1f3448";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <meta name="baidu-site-verification" content="mI6O7pmEdr">
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
    
    
    
    <a href="https://github.com/lystdio" target="_blank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">撼地神牛</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/blog/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/blog/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/blog/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/blog/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/blog/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>站点地图</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/blog/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

    <a href="https://github.com/lystdio" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/blog/blog/2014/03/30/2014-03-30-WYSIWYG/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2014/03/30/2014-03-30-WYSIWYG/" class="post-title-link" itemprop="https://handishenniu.coding.me/blog/page/23/index.html">一个所见即所得的博客</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-03-30 00:00:00" itemprop="dateCreated datePublished" datetime="2014-03-30T00:00:00+08:00">2014-03-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/03/30/github-logo.png" data-source="http://hi.barretlee.com/imgs/shares/github-logo.png" style="width:200px;height:200px" alt="github logo"></p>
<p>最简单的博客就是，你只需要写，其他的啥都不用管。github 就能够做到。</p>
<p>gihub pages 生成的页面和存放在 github 上的文件存在对应关系，我为每篇文章都加了对应的 edit 链接，这个链接被我隐藏掉了，但是只要在 url 后面加上<code>?edit</code>，就可以在文中的页面里找到这个小小的 edit 链接。同时也在<a href="/">首页</a>加了一个 new post 的链接，方便加入新的文章。</p>
<p>我把这个网站作为平时一些感受和想法的聚集平台，操作简单，上手方便，建议跟我一起玩玩，呵呵~</p>
<p>感兴趣的童鞋可以从右上角点进这个 github 地址，fork 代码后自行研究。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/blog/blog/2014/03/25/2014-03-25-cb-million-data-show-in-front-end/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2014/03/25/2014-03-25-cb-million-data-show-in-front-end/" class="post-title-link" itemprop="https://handishenniu.coding.me/blog/page/23/index.html">百万数据如何在前端快速流畅显示？</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-03-25 12:54:00" itemprop="dateCreated datePublished" datetime="2014-03-25T12:54:00+08:00">2014-03-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/前端杂烩/网络交互/" itemprop="url" rel="index"><span itemprop="name">网络交互</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>如果要在前端呈现大量的数据，一般的策略就是分页。前端要呈现百万数据，这个需求是很少见的，但是展示千条稍微复杂点的数据，这种需求还是比较常见，只要内存够，javascript 肯定是吃得消的，计算几千上万条数据，js 效率根本不在话下，但是 DOM 的渲染浏览器扛不住，CPU 稍微搓点的电脑必然会卡爆。</p>
<p>本文的策略是，显示三屏数据，其他的移除 DOM。</p>
<h3 id="一、-策略"><a href="#一、-策略" class="headerlink" title="一、 策略"></a>一、 策略</h3><p>下面是我简单勾画的一个草图，我们把一串数据放到一个容器当中，这串数据的高度（Data List）肯定是比 Container 的高度要高很多的，如果我们一次性把数据都显示出来，浏览器需要花费大量的时间来计算每个 data 的位置，并且依次渲染出来，整个过程中 JS 并没有花费太多的时间，开销主要是 DOM 渲染。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">                          /==============&gt; Data List</span><br><span class="line">        |     ....     | /</span><br><span class="line">        +--------------+/</span><br><span class="line">+=======|=====data=====|========+</span><br><span class="line">|       +--------------+        |</span><br><span class="line">|       |     data     |        |</span><br><span class="line">|       +--------------+        |\</span><br><span class="line">|       |     data     |        | \</span><br><span class="line">|       +--------------+        |  \======&gt; Container</span><br><span class="line">+=======|=====data=====|========+</span><br><span class="line">        +--------------+</span><br><span class="line">        |     ....     |        Created By Barret Lee</span><br></pre></td></tr></table></figure>
<p>为了解决这个问题，我们让数据是显示一部分，这一部分是 Container 可视区域的内容，以及上下各一屏（一屏指的是 Container 高度所能容纳的区域大小）的缓存内容。如果 Container 比较高，也可是只缓存半屏，缓存的原因是，在我们滚动滚动条的时候，js 需要时间来拼凑字符串（或者创建 Node ），这个时候浏览器还来不及渲染，所以会出现临时的空白，这种体验是相当不好的。</p>
<h3 id="二、Demo"><a href="#二、Demo" class="headerlink" title="二、Demo"></a>二、Demo</h3><p>demo 在 IE 7、8 有 bug，请读者自己修复吧~</p>
<p>代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>百万数据前端快速流畅显示<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">#box &#123;position: relative; height: 300px; width: 200px; border:1px solid #CCC; overflow: auto&#125;</span></span><br><span class="line"><span class="undefined">#box div &#123; position: absolute; height: 20px; width: 100%; left: 0; overflow: hidden; font: 16px/20px Courier;&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">var total = 1e5</span></span><br><span class="line"><span class="undefined">  , len = total</span></span><br><span class="line"><span class="undefined">  , height = 300</span></span><br><span class="line"><span class="undefined">  , delta = 20</span></span><br><span class="line"><span class="undefined">  , num = height / delta</span></span><br><span class="line"><span class="undefined">  , data = [];</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">for(var i = 0; i &lt; total; i++)&#123;</span></span><br><span class="line"><span class="undefined">  data.push(&#123;content: "item-" + i&#125;);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">var box = document.getElementById("box");</span></span><br><span class="line"><span class="undefined">box.onscroll = function()&#123;</span></span><br><span class="line"><span class="undefined">  var sTop = box.scrollTop||0</span></span><br><span class="line"><span class="undefined">    , first = parseInt(sTop / delta, 10)</span></span><br><span class="line"><span class="undefined">    , start = Math.max(first - num, 0)</span></span><br><span class="line"><span class="undefined">    , end = Math.min(first + num, len - 1)</span></span><br><span class="line"><span class="undefined">    , i = 0;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  for(var s = start; s &lt;= end; s++)&#123;</span></span><br><span class="line"><span class="undefined">    var child = box.children[s];</span></span><br><span class="line"><span class="undefined">    if(!box.contains(child) &amp;&amp; s != len - 1)&#123;</span></span><br><span class="line"><span class="undefined">      insert(s);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  while(child = box.children[i++])&#123;</span></span><br><span class="line"><span class="undefined">    var index = child.getAttribute("data-index");</span></span><br><span class="line"><span class="xml">    if((index &gt; end || index <span class="tag">&lt; <span class="attr">start</span>) &amp;&amp; <span class="attr">index</span> != <span class="string">len</span> <span class="attr">-</span> <span class="attr">1</span>)&#123;</span></span></span><br><span class="line"><span class="undefined">      box.removeChild(child);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">function insert(i)&#123;</span></span><br><span class="line"><span class="undefined">  var div = document.createElement("div");</span></span><br><span class="line"><span class="undefined">  div.setAttribute("data-index", i);</span></span><br><span class="line"><span class="undefined">  div.style.top = delta * i + "px";</span></span><br><span class="line"><span class="undefined">  div.appendChild(document.createTextNode(data[i].content));</span></span><br><span class="line"><span class="undefined">  box.appendChild(div);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">box.onscroll();</span></span><br><span class="line"><span class="undefined">insert(len - 1);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以戳这个 <a href="http://rawgithub.com/barretlee/9744160/raw/a71dd5561a910b48063cc81e8ee7b042cfeb1574/gistfile1.html" target="_blank" rel="noopener">demo</a>，或者看这里 <a href="http://gist.github.com/barretlee/9744160" target="_blank" rel="noopener">http://gist.github.com/barretlee/9744160</a></p>
<h3 id="三、算法说明"><a href="#三、算法说明" class="headerlink" title="三、算法说明"></a>三、算法说明</h3><h4 id="1-计算-start-和-end-节点"><a href="#1-计算-start-和-end-节点" class="headerlink" title="1. 计算 start 和 end 节点"></a>1. 计算 start 和 end 节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">        |              |</span><br><span class="line">+=======|==============|========+——</span><br><span class="line">|    ↓——+--------------+        | ↑</span><br><span class="line">| delta |              |        |</span><br><span class="line">|    ↑——+--------------+        | height</span><br><span class="line">|       |              |        |</span><br><span class="line">|       +--------------+        | ↓</span><br><span class="line">+=======|==============|========+——</span><br><span class="line">        |              |</span><br></pre></td></tr></table></figure>
<p>Container 可以容纳的 Data 数目为 <code>num = height / delta</code>，Container 顶部第一个节点的索引值为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> first = <span class="built_in">parseInt</span>(Container.scrollTop / delta);</span><br></pre></td></tr></table></figure>
<p>由于我们上下都有留出一屏，所以</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> start = <span class="built_in">Math</span>.max(first - num, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> end = <span class="built_in">Math</span>.min(first + num, len - <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<h4 id="2-插入节点"><a href="#2-插入节点" class="headerlink" title="2. 插入节点"></a>2. 插入节点</h4><p>通过上面的计算，从 start 到 end 将节点一次插入到 Container 中，并且将最后一个节点插入到 DOM 中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入最后一个节点</span></span><br><span class="line">insert(len - <span class="number">1</span>);</span><br><span class="line"><span class="comment">// 插入从 start 到 end 之间的节点</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> s = start; s &lt;= end; s++)&#123;</span><br><span class="line">  <span class="keyword">var</span> child = Container.children[s];</span><br><span class="line">  <span class="comment">// 如果 Container 中已经有该节点，或者该节点为最后一个节点则跳过</span></span><br><span class="line">  <span class="keyword">if</span>(!Container.contains(child) &amp;&amp; s != len - <span class="number">1</span>)&#123;</span><br><span class="line">    insert(s);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里解释下为什么要插入最后一个节点，插入节点的方式是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">insert</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">  div.setAttribute(<span class="string">"data-index"</span>, i);</span><br><span class="line">  div.style.top = delta * i + <span class="string">"px"</span>;</span><br><span class="line">  div.appendChild(<span class="built_in">document</span>.createTextNode(data[i].content));</span><br><span class="line">  Container.appendChild(div);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到我们给插入的节点都加了一个 top 属性，最后一个节点的 top 是最大的，只有把这个节点插入到 DOM 中，才能让滚动条拉长，让人感觉放了很多的数据。</p>
<h4 id="3-删除节点"><a href="#3-删除节点" class="headerlink" title="3. 删除节点"></a>3. 删除节点</h4><p>为了减少浏览器的重排（reflow），我们可以隐藏三屏之外的数据。我这里为了方便，直接给删除掉了，后续需要再重新插入。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(child = Container.children[i++])&#123;</span><br><span class="line">  <span class="keyword">var</span> index = child.getAttribute(<span class="string">"data-index"</span>);</span><br><span class="line">  <span class="comment">// 这里记得不要把最后一个节点给删除掉了</span></span><br><span class="line">  <span class="keyword">if</span>((index &gt; end || index &lt; start) &amp;&amp; index != len - <span class="number">1</span>)&#123;</span><br><span class="line">    Container.removeChild(child);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当 DOM 加载完毕之后，触发一次 <code>Container.onscroll()</code>，然后整个程序就 OK 了。</p>
<h3 id="四、小结"><a href="#四、小结" class="headerlink" title="四、小结"></a>四、小结</h3><p>本文主要是叙述大数据加载的一点基本原理，程序可能有 bug，也有很多地方可以优化，了解下算法就行了。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/blog/blog/2014/03/17/2014-03-17-cb-two-yeas/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2014/03/17/2014-03-17-cb-two-yeas/" class="post-title-link" itemprop="https://handishenniu.coding.me/blog/page/23/index.html">感想以及一些文章索引</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-03-17 03:02:00" itemprop="dateCreated datePublished" datetime="2014-03-17T03:02:00+08:00">2014-03-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/03/17/two-yeas.html" target="_blank">博客园</a>.</div>

<p>接触前端快三年了，记得是在大二的时候开始进博客园写博，三年的成长有两年得益于与各位前辈的交流和讨论。首先感谢博客园给我们提供了很好的交流平台，也祝博客园的建设越来越好！同时也感谢技术上擦过火花的小伙伴们，希望以后的日子里可以更多更深入的交流！</p><br><h3>一点学习经验</h3><br><p>以 <strong>Barret</strong> 这个名字混迹于不少 QQ 群中，时间比较久了，跟一些人也建立了比较好的友谊关系。在群里，不管是提问还是回答别人提出的问题，总能在未知领域找到属于自己的东西。现在还会经常在群里碰到学习前端的新人，他们有时提问抓不到关键词或者不知道如何形容自己的问题，这也让我看到了当初的自己，希望有经验的学习者可以包容这些人，耐心的回答他们提出的问题，因为我们也是这么成长起来的~</p><br><p>这几年时间我看过很多<a title="豆瓣读书，部分书籍列表" href="http://book.douban.com/people/hustskyking/collect" target="_blank">书籍</a>，每本书都是作者学习经验的浓缩，我很推荐大家买几本参考书籍，如《JavaScript权威指南》、《JavaScript设计模式》、《JavaScript异步编程》、《JavaScript高级程序设计》、《JavaScript语言精粹》、《CSS权威指南》等，这些书籍我都读过三五遍，有些则看过七八遍，所以对一些 JS 比较基础的东西都有所了解。我们在网上所有资料的时候，也推荐大家上权威一点的网站上去查询，如 <a href="//developer.mozilla.org/en/" target="_blank">MDN</a>、<a href="http://msdn.microsoft.com/en-us/#fbid=OYqXopniVLY" target="_blank"> MSDN&nbsp;</a>&nbsp;、<a href="http://www.whatwg.org/" target="_blank">whatwg</a>、<a href="http://www.w3.org/TR/" target="_blank">w3</a>等，在这里我们可以找到最全面最深入的资料。</p><br><p>对于问题的剖析一定要刨根问底，一直追溯到最底层的原理，比如 垃圾回收机制 追溯到 V8，websocket 追溯到 TCP 层等，把最底层的原理搞明白了，回答别人的问题才会有底气，不然人家几个为什么就会把你问的无话可说了。</p><br><p>去年的六月份在百度实习了三个月，那时候的同事给我取了个外号，叫\<strong>小胡子哥</strong>“，我也比较喜欢这个 nickname，所以在博客顶上也加上了这个外号。现在我在淘宝UED实习，阿里有个传统就是给自己取花名，当时也没多想，天王被人注册了，所以给自己取了个名字，叫 \<strong>阎王</strong>“。所以大家也可以叫我阎王。</p><br><h3>文章罗列</h3><br><p>本来打算在入园两周年发点有技术含量的文章，结果，呵..呵，太忙了，就简单的罗列下自己写过的一点点东西。</p><br><h4>1. web语音通信</h4><br><ul><br><li><a href="http://www.cnblogs.com/hustskyking/p/webAudio-filter.html" target="_blank" rel="noopener">让音乐响起来</a></li><br><li><a href="http://www.cnblogs.com/hustskyking/p/webAudio-show-audio.html" target="_blank" rel="noopener">看得到的音频流</a></li><br><li><a href="http://www.cnblogs.com/hustskyking/p/webAudio-volume.html" target="_blank" rel="noopener">音量的控制</a></li><br><li><a href="http://www.cnblogs.com/hustskyking/p/webAudio-cross-fading.html" target="_blank" rel="noopener">声道的转换</a></li><br><li><a href="http://www.cnblogs.com/hustskyking/p/webAudio-filter.html" target="_blank" rel="noopener">声音的过滤</a></li><br></ul><br><p>这一系列的文章还没有写完，后续还有几篇，等有时间了整理下。包括如何使用 JavaScript 录音，还是音频的压缩和船速等等。</p><br><h4>2. 一些原理性的东西</h4><br><ul><br><li><a href="http://www.cnblogs.com/hustskyking/p/javascript-asynchronous-programming.html" target="_blank" rel="noopener">Javascript异步编程原理</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_17" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/how-to-achieve-loading-module.html" target="_blank" rel="noopener">浅谈模块化加载的实现原理</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_19" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/websocket-with-node.html" target="_blank" rel="noopener">细说WebSocket - Node篇</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_19" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/websocket-with-node.html" target="_blank" rel="noopener"></a><a id="homepage1_PostList1_rptEntries_TitleUrl_18" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/websocket-with-php.html" target="_blank" rel="noopener">细说websocket - php篇</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_14" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/how-regular-expressions-work.html" target="_blank" rel="noopener">进阶正则表达式</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_4" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/javascript-array.html" target="_blank" rel="noopener">你所不知道的JavaScript数组</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_0" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/web-communication.html" target="_blank" rel="noopener">JavaScript之web通信</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_2" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/principle-of-javascript-template.html" target="_blank" rel="noopener">JavaScript模板引擎原理</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_11" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/javascript-closure.html" target="_blank" rel="noopener">对闭包机制的深入理解</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_11" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/javascript-closure.html" target="_blank" rel="noopener"></a><a id="homepage1_PostList1_rptEntries_TitleUrl_11" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/problem-javascript-event.html" target="_blank" rel="noopener">[解惑]JavaScript事件机制</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_11" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/problem-javascript-event.html" target="_blank" rel="noopener"></a><a id="homepage1_PostList1_rptEntries_TitleUrl_17" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/extend-in-jQuery.html" target="_blank" rel="noopener">解读jQuery中extend函数</a></li><br></ul><br><p>因为喜欢去偏底层的思考，所以对一些经常遇到的东西做了稍微深层的分析。</p><br><h4>3. 介绍性的东西</h4><br><ul><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_1" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/open-source.html" target="_blank" rel="noopener">软件（代码）开源，协议声明</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_5" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/javascript-fullscreen.html" target="_blank" rel="noopener">让你的页面瞬间全屏</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_12" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/multiple-download-with-javascript.html" target="_blank" rel="noopener">JavaScript多文件下载</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_13" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/manufacture-font-face-in-web.html" target="_blank" rel="noopener">再探@font-face及webIcon制作</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_1" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/history-api-in-html5.html" target="_blank" rel="noopener">PJAX的实现与应用</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_4" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/ES6-introduce.html" target="_blank" rel="noopener">ECMAScript 6 简介</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_7" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/let-your-page-understood-by-search-engine.html" target="_blank" rel="noopener">SEO：让搜索引擎对你的网站更有亲和力(译)</a></li><br></ul><br><h4>4. 偏应用的</h4><br><ul><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_3" class="PostTitle" href="http://www.cnblogs.com/hustskyking/archive/2013/06/03/3D-Tank-War.html" target="_blank" rel="noopener">【屌丝之作】3D遥控坦克大战</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_7" class="PostTitle" href="http://www.cnblogs.com/hustskyking/archive/2013/05/04/getkeywords.html" target="_blank" rel="noopener">Javascript综合应用小案例</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_18" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/change-fontSize-with-pure-css.html" target="_blank" rel="noopener">字体大小自适应纯css解决方案</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_14" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/responsive-web-desigin.html" target="_blank" rel="noopener">那些年，我们一起玩过的响应式布局</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_13" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/javascript-spec.html" target="_blank" rel="noopener">前端编码规范之JavaScript</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_15" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/css-spec.html" target="_blank" rel="noopener">前端编码规范之CSS</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_9" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/javascript-regexp.html" target="_blank" rel="noopener">玩转正则之highlight高亮</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_0" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/semicolon-retalk.html" target="_blank" rel="noopener">Javascript分号，加还是不加？</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_3" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/problems-in-git-when-ssh.html" target="_blank" rel="noopener">git/ssh捋不清的几个问题</a></li><br><li><a id="homepage1_PostList1_rptEntries_TitleUrl_15" class="PostTitle" href="http://www.cnblogs.com/hustskyking/p/user-exprience-in-login-box.html" target="_blank" rel="noopener">从登录框看前端</a></li><br></ul><br><h3>结语</h3><br><p>在学校，很多时间都是自己支配的，相当自由，工作之后一些事情就身不由己了，我希望自己记录的一点东西可以对新人有帮助，也希望可以通过这些文字记录自己学习的历程。谢谢大家的支持！&nbsp;</p>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/blog/blog/2014/03/16/2014-03-16-cb-semicolon-retalk/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2014/03/16/2014-03-16-cb-semicolon-retalk/" class="post-title-link" itemprop="https://handishenniu.coding.me/blog/page/23/index.html">Javascript分号，加还是不加？</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-03-16 03:51:00" itemprop="dateCreated datePublished" datetime="2014-03-16T03:51:00+08:00">2014-03-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/03/16/semicolon-retalk.html" target="_blank">博客园</a>.</div>

<p>关于这个问题，网上已经有很多人讨论过了，我先说说自己对这个问题的回答：加！（但非必须）</p><br><p>有些人写代码，懒得加分号，除非是迫不得已才勉强放一个分号上去。如果你可以保证你写的代码不出现任何 bug，那当然是没有问题，但是很多 JSer 新人，对一些隐含的问题并不是特别清楚，很容易在不知不觉中写出一堆 bug，我们先来了解下 JS 词法语法解析的时候，哪些情况下会自动插入分号。</p><br><h3>一、自动插入分号的规则</h3><br><p><span><strong>注：鼠标滑过文字可以看到翻译原文</strong></span></p><br><p>1. <span class="translator" title="When, as the program is parsed from left to right, a token (called the offending token) is encountered that is not allowed by any production of the grammar, then a semicolon is automatically inserted before the offending token if one or more of the following conditions is true:">程序从左到右解析，当纳入下一个 token 无法匹配任何语法：</span></p><br><ul><br><li><span class="translator" title="The offending token is separated from the previous token by at least one LineTerminator.">如该 token 跟之前的 token 之间有至少一个 LineTerminal 行终结符违反分割</span></li><br><li><span class="translator" title="The offending token is }.">该 token 为 <code>}</code> 符号时</span></li><br></ul><br><p>2. <span class="translator" title="When, as the program is parsed from left to right, the end of the input stream of tokens is encountered and the parser is unable to parse the input token stream as a single complete ECMAScript Program, then a semicolon is automatically inserted at the end of the input stream.">程序从左到右解析，当纳入下一个（或几个） token 不能产生一条合法的语句的时候，会在这个地方插入一个分号。</span></p>

<p><br>3. &lt;span class=”translator” title=”When, as the program is parsed from left to right, a token is encountered that is allowed by some production of the grammar, but the production is a restricted production and the token would be the first token for a terminal or nonterminal immediately following the annotation [no LineTerminator here]” within the restricted production (and therefore such a token is called a restricted token), and the restricted token is separated from the previous token by at least one LineTerminator, then a semicolon is automatically inserted before the restricted token.”&gt;程序从左到右解析，当纳入的 token 能够产生一条合法语句，但是这条语句是受限产生式时，在该受限 token 前面自动插入分号。<br></p><br><p>上面提到的一些内容来自 ECMAScript5.1 第七章第九节，可以戳<a href="http://barretlee.com/ST/ES5.1/#sec-7.9.1" target="_blank">这里</a>，翻译的不太通顺，实在是太难翻译了= =</p><br><h3>二、一些不加分号会出问题的场景</h3><br><p><strong>场景一：</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = a + b</span><br><span class="line">(x + y).doSomething()</span><br></pre></td></tr></table></figure>
<p>我们期望这是这是两条语句，结果会被解析成：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = a + b(x + y).doSomething();</span><br></pre></td></tr></table></figure>
<p>b 在这里成了一个函数了。</p><br><p><strong>场景二：</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x</span><br><span class="line">++</span><br><span class="line">y</span><br></pre></td></tr></table></figure>
<p>这个 ++ 符号会给谁？答案是：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x; ++y;</span><br></pre></td></tr></table></figure>
<p>这样的代码当然是很少遇到，但是遇到这种情况：</p><br><p><strong>场景三：</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">return</span><br><span class="line">true</span><br></pre></td></tr></table></figure>
<p>我们期望返回 true，结果：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">return;</span><br><span class="line">true;</span><br></pre></td></tr></table></figure>
<p>给我们返回了 undefined。</p><br><p><strong>场景四：</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = function(x)&#123;return x&#125;</span><br><span class="line">(1 + 2).toString()</span><br></pre></td></tr></table></figure>
<p>他被解析成了</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = function(x)&#123;return x&#125;(1 + 2).toString()</span><br></pre></td></tr></table></figure>
<p><code>function(x){return x}(1 + 2)</code> 这个作为一个整体，1+2 作为参数送入函数，该函数的返回值为 3，然后执行 3.toString()，这样的问题藏的比较深，不容易被发现。</p><br><h3>三、规避问题</h3><br><p>有些语句是以 <code>[</code> 或者 <code>(</code> 开头，就像上面提到的场景一和场景四，这些 token 很容易和上一条没有加分号的语句合并到一起，如果你不太喜欢加分号，可以这样来处理：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = function(x)&#123;return x&#125;</span><br><span class="line">;(1 + 2).toString()</span><br></pre></td></tr></table></figure>
<p>这也是为什么我们会经常看到别人的代码中写出这样的函数：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">;(function()&#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>在 function 的前面加了一个分号，目的就是为了防止整个函数的返回值作为参数送入上一条语句之中。</p><br><p>对于场景三，要特别说明一下，除了 return 之外，还有 break 和 continue 语句，break 和 continue 类似 C 语言中的 goto ，他是可以在后面添加 tag 的，如果 tag 和 这些关键词之间存在 <a href="http://barretlee.com/ST/ES5.1/#sec-7.3" target="_blank">LineTerminal </a>，这些 tag 就会被忽略，如：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">break</span><br><span class="line">tag</span><br></pre></td></tr></table></figure>
<p>我们期望程序会调到 tag 所指向的程序段，但结果被解析成</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">break;</span><br><span class="line">tag;</span><br></pre></td></tr></table></figure>
<p></p><h3>四、小结</h3><p></p>
<p>看到上面的一些列问题，相信大家心里还是有自己的答案了，如果你有信心代码里头不出现因为不写分号而导致的错误，那分号的取舍其实是无所谓的。</p>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/blog/blog/2014/03/14/2014-03-14-cb-open-source/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2014/03/14/2014-03-14-cb-open-source/" class="post-title-link" itemprop="https://handishenniu.coding.me/blog/page/23/index.html">软件（代码）开源，协议声明</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-03-14 07:52:00" itemprop="dateCreated datePublished" datetime="2014-03-14T07:52:00+08:00">2014-03-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/03/14/open-source.html" target="_blank">博客园</a>.</div>

<p><strong>注意：对于协议有个大概的了解就行了，本文叙述不是很标准，如果要做具体了解，请戳文中给出的链接。</strong></p><br><p>关于开源协议网上有很多说明，不过写的都十分晦涩，让人木有读下去的欲望，下面给大家简单的科普一下。</p><br><p>一般很少人关注代码开源的协议说明，我们平时看到的 MIT Apache BSD 等，一堆英文的缩写，也懒得去看具体的内容，这说明你的维权意识还不是很强。辛辛苦苦写了一堆代码，贴到某个分享区，啪一下被人家复制走了，然后别人改个名字，捎带加个协议，说是自己写的，一般情况下这种事情的发生我们可以忽视之，当如果这串代码被人家作为商用，成为挣钱利器，那个时候你后悔也来不及了。</p><br><p>目前市面上看到的协议种类还是挺繁多的，同一种协议可能还有几个版本，每个版本之间存在细微的差异，如何给自己的代码添加合适的协议？太宽松了，自己劳动成果容易被人家窃取；太苛刻了，人家也不想用你的东西。</p><br><h4>1. 如果你想使用一个简单不那么麻烦的协议，可以选择 <strong><a href="http://choosealicense.com/licenses/mit/" target="_blank">MIT</a></strong></h4><br><p>别人需要注意什么呢？署上你的大名，就可以带走你的代码了。你不用为他项目中因使用你的代码出现的问题承担任何责任。</p><br><h4>2. 如果你顾及到专利，可以选择 <strong><a href="http://choosealicense.com/licenses/apache/" target="_blank">Apache</a></strong></h4><br><p>可能代码中的某个技术或者创新点，你申请了专利，使用这个协议可以保护你专利的一些权力，简单点说就是让别人免费使用你这专利中的东西。</p><br><h4>3. 如果你很在意别人对你代码的修改，希望分享并得到促进，可以选择 <strong><a href="http://choosealicense.com/licenses/gpl-v2/" target="_blank">GPL</a></strong></h4><br><p>GPL 分为两个版本一个是 <a href="http://choosealicense.com/licenses/gpl-v2/" target="_blank">V2</a>，一个是 <a href="http://choosealicense.com/licenses/gpl-v3/" target="_blank">V3</a>，作品带上这个协议之后，别人想分享的话也得加上这个协议，对代码作出比较大的更改也是需要附带说明的。</p><br><p>上面提到的几个是比较常见的，也提一下其他几个。</p><br><ul><br><li><a href="http://choosealicense.com/licenses/lgpl-v2.1/" target="_blank">LGPL</a> 在GPL前面多了个 L，内容和 GPL 差不多，适合一些代码库或者框架使用。</li><br><li><a href="http://choosealicense.com/licenses/bsd/" target="_blank">BSD</a> 也有两个版本，类似 MIT</li><br><li><a href="http://choosealicense.com/licenses/no-license/" target="_blank">No License</a> 注意，这可不是没有版权声明，只是作者保留版权（包括分发，复制或者创造衍生物），只是你分享的时候允许分享平台附带的一些操作。如代码扔到 gitlab 上，就表示你允许别人查看并且 fork 你的代码。</li><br><li><a href="http://choosealicense.com/licenses/unlicense/" target="_blank">Public domain dedication</a> 这玩意儿才是不保留版权，也就是版权自由（Copy Left），跟保留版权（Copy Right）是相对的。基本就是放弃对这段代码的任何权利，可以自由使用。他和不声明版权的区别就是，告诉别人，兄弟，我这代码是没版权的，你随便使用~</li><br></ul><br><p><strong>如果还想具体了解其他相关的知识，请直接去<a href="http://choosealicense.com/" target="_blank">http://choosealicense.com/</a>，这里有最权威最全面的的说明。</strong></p><br><p><strong>汉化版地址：<a href="http://choosealicense.gitcafe.com/" target="_blank">http://choosealicense.gitcafe.com/</a></strong></p>




          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/blog/blog/2014/03/12/2014-03-12-cb-work-in-life/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2014/03/12/2014-03-12-cb-work-in-life/" class="post-title-link" itemprop="https://handishenniu.coding.me/blog/page/23/index.html">工作，但别忘了生活</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-03-12 03:02:00" itemprop="dateCreated datePublished" datetime="2014-03-12T03:02:00+08:00">2014-03-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/观点和感想/" itemprop="url" rel="index"><span itemprop="name">观点和感想</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/03/12/work-in-life.html" target="_blank">博客园</a>.</div>

<p>已经一点多了[昨晚写的]，其实我现在挺累的，想去睡个觉，不过有些东西还是需要记录一下。</p><br><p>人已经不在学校了，也不想谈太多学校里面的事情，社会和学校之间似乎有一层屏障，把很多东西都分隔开了。我挺喜欢学校，很自由，可以不慌不忙的支配时间。只是有些许内疚，大学没去好好支配时间。</p><br><p>最近在看什么呢？《宏观经济学》、《心理学导论》、《税法》，当然也少不了一些技术书籍。这几天发生在我身边的事情让我感觉到，人特别渺小，尤其是缺乏知识的人，跟社会接轨的比较少，当走进社会之后就显得更渺小了。在学校，每个人都期望着找准自己的位置，寻找社会上适合自己的角色，一些人找到了，还有一些人，继续留在学校，他们或许找到了自己的定位，或许…只是等待更好的时机。</p><br><p>我是一个工作起来会忘我的人，今天一个 git/ssh 的配置折腾到十点多，八点多的时候站起来看了下周边，已经没什么人了。我不喜欢加班，只是学习的时候忘记了时间。每次思考都会沉浸在自己的世界中，有时候还会哼起小曲儿。不知道这是不是程序员特有的风格。我不喜欢承认自己是程序员，我有很多爱好，也有能力将这些爱好变成我的专长，就像编程一样。</p><br><p>现在很多上班族都是在外租房，不是自己的家所以也没有太多的归属感。在一个不是自己家的地方生活，会过的比较散漫，上班的唠叨容易带回住处，上班的情绪也会滞留在住处，慢慢地，工作占据了生活。</p><br><p>做饭做菜就甭说了，一没时间，二没技术，三没心情。周末可能也就是窝在几米见方的小室内，过的很压抑，甚至有压力。</p><br><p>我觉得现在在外面拼搏的人需要考虑下生活，怎么去生活！很多人做事总是匆匆忙忙的，但是结果呢，像样的东西啥也没做出来，成天说忙，结果不知道时间去哪儿了。整天在挣钱，结果也不知道钱去哪儿了。</p><br><p>让节奏慢下来，不是让你一分钟敲十行代码改成敲一行。规划好下一步要做的事情，让自己有一个思考和停顿的时间。</p><br><p>其实生活很简单，它就是吃完饭收拾下碗筷，就是停下脚步看看身边的人在做什么，就是学学做菜，就是出去走走…工作很重要，不过他只是我们生活的一部分，不要让工作占据你生活的一切！</p>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/blog/blog/2014/03/11/2014-03-11-cb-problems-in-git-when-ssh/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2014/03/11/2014-03-11-cb-problems-in-git-when-ssh/" class="post-title-link" itemprop="https://handishenniu.coding.me/blog/page/23/index.html">git/ssh捋不清的几个问题</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-03-11 11:09:00" itemprop="dateCreated datePublished" datetime="2014-03-11T11:09:00+08:00">2014-03-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/前端杂烩/网络交互/" itemprop="url" rel="index"><span itemprop="name">网络交互</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/03/11/problems-in-git-when-ssh.html" target="_blank">博客园</a>.</div>

<p>主要是 windows 用户会遇到很多纠结的问题，linux/unix 用户属于这方面的高端用户，应该有能力处理此类问题，而且网络上也有很多解决方案，本文的授众是 windows 用户。由于今天配置了一下午，虽说配置过程基本搞清楚，懒得重新配置一遍，所以文中皆以文字形式叙述，没有截图。</p><br><p>本文地址：<a href="http://www.cnblogs.com/hustskyking/p/problems-in-git-when-ssh.html" target="_blank" rel="noopener">http://www.cnblogs.com/hustskyking/p/problems-in-git-when-ssh.html</a>，转载请注明源地址。</p><br><h3>一、概念的解释</h3><br><h4>1. rsa 与 rsa.pub</h4><br><p>网上很容易搜到的东西我就不说了，我们知道，通过：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;something&quot;</span><br></pre></td></tr></table></figure>
<p>可以生成两个文件，这两个文件的命名默认是 id_rsa 和 id_rsa.pub，如果你在键入上述命令回车之后，重新输入了命名，那此时生成的两个文件就是 <code>[命名]</code> 和 <code>[命名].pub</code>，这个好理解。</p><br><p>主要是解释下生成了两个什么东西。id_rsa 可以称之为私有密钥，id_rsa.pub 可以称之为公有密钥。我们会把公有密钥交给服务端，当需要从服务端请求内容的时候，要带上私有密钥。此时，服务器会通过一定的算法计算私有密钥，并判断计算的结果是否与公有密钥一样，如果不一样则响应请求失败。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-----------+                           +-----------+</span><br><span class="line">|           |                           |           |</span><br><span class="line">|           |    enc(rsa) == rsa.pub    |           |</span><br><span class="line">|  client   | ------------------------&gt; |   server  |</span><br><span class="line">|           |             ?             |           |</span><br><span class="line">|           |                           |           |</span><br><span class="line">+-----------+                           +-----------+</span><br></pre></td></tr></table></figure>
<p>rsa.pub 里面是个什么东西，其实很简单：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-rsa base64(加密内容) &quot;something&quot;</span><br></pre></td></tr></table></figure>
<p>而 rsa 中是：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">base64(私有密钥的一些处理)</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>
<p></p><h4>2. 验证程序</h4><p></p>
<p>在使用 git 命令与服务端进行交互之前，我们可以先验证下服务器和客户端是否握手成功了。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@xxx.com</span><br></pre></td></tr></table></figure>
<p>如果是 github，就可以直接写 <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>, 如果是 aaa.bbb.com，就可以写 <a href="mailto:git@aaa.bbb.com" target="_blank" rel="noopener">git@aaa.bbb.com</a>。 如果成功，你会看到 success 之类的字眼。</p><br><h4>3. known_hosts 文件</h4><br><p>这是个什么文件呢？一般情况下 windows 下不会产生这个文件，先说说他是干什么的。当我们成功与服务端进行连接时，ssh 会记录服务端的 Host、IP 以及 rsa 文件，当连接过程中出现：</p><br><pre><code>Permanently added ‘10.0.0.0’ (RSA) to the list of known hosts.<br></code></pre><br><p>如果你选择 Yes，那这个 known_hosts 文件中就会多出一条记录。windows 是不会自动产生这个文件的，也可能是程序产生了，但是没权限写入，所以我们没有在 .ssh/ 目录下看到这个文件。但如果我们创建了这个文件，会发现里面的内容会随着我们的验证慢慢增加。</p><br><p>搞清楚了这些概念，我们再说说会遇到的问题。</p><br><h3>二、常见问题</h3><br><h4>1. <a href="mailto:git@xxx.com" target="_blank" rel="noopener">git@xxx.com</a> 输入密钥</h4><br><p>当你键入 <code>ssh -T <a href="mailto:git@xxx.com" target="_blank" rel="noopener">git@xxx.com</a></code> 这条命令之后，程序提示要你输入 <a href="mailto:git@xxx.com" target="_blank" rel="noopener">git@xxx.com</a> 的密码，那不用想了，程序没找到你的私有密钥。在哪些情况下会这样呢？</p><br><p>我们在生成这两个密钥的时候，程序可能没有帮我们在根目录下(C:/Users/yourName)新建一个 .ssh/ 文件夹，而他在建立连接的时候会默认寻找 <code>~/.ssh/id_rsa</code>，如果没有新建一个这样的文件夹很显然是找不到的。你可以在根目录下通过命令行来新建一个文件夹</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir .ssh</span><br></pre></td></tr></table></figure>
<p>之所以要用命令行是因为有时候浏览器不让你在文件夹名第一位放点号。</p><br><p>当然也有可能是因为你没有把创建的两个密钥放到 .ssh/ 目录下，而是直接扔在根目录下。</p><br><h4>2. Host key verification failed</h4><br><p>“Host key verification failed.” 相信你也撞到了这个问题，主机的密钥验证失败，主机就是你的机器，密钥验证失败有两个原因，一个是 RSA 做了更改，另一个原因是在 known_hosts 中存在一个缓存的记录，如果确认了 RSA 没有错误，那你就应该去 known_hosts 中删掉对应的那个记录（这个记录可以当做是缓存，是对验证做了一次缓存，缓存的作用是减少验证次数，不需要每次都验证，读取缓存就行了）。</p><br><p>当然，你也可以直接删除这个 known_hosts 文件。</p><br><h4>3. Permission denied (publickey)</h4><br><p>“Permission denied (publickey).” 这个问题其实和上面的 2 差不多，当你出现过 “Host key verification failed.”，然后继续执行程序，如执行 <code>ssh -T <a href="mailto:git@xxx.com" target="_blank" rel="noopener">git@xxx.com</a></code> 的时候就会出现这个问题提醒。说到底就是没有找到你的 rsa 私有密钥，或者 rsa 密钥匹配出错。</p><br><h3>三、windows 下让人纠结的问题</h3><br><h4>1. 找不到根目录</h4><br><p>生成密钥默认放在 “~/.ssh/“ 下，但是在 cmd 下操作会找不到 “~/“ 这个根目录，因为这是 windows 不是 linux/unix，有些童鞋可能装了 cygwin，在这个环境下操作可以 “cd ~”，git bash 下当然也是可以的。</p><br><p>如果不知道有这个问题的存在，你会碰到上述问题一，程序直接让你输入密码，但不过你输入什么密码都是错误的。输入三次之后状态为 <code>Permission denied</code>，这里的原因就是没找到 <code>~/.ssh/id_rsa</code> ，cmd 下她根本就不认识 “~/“ 这个目录。</p><br><h4>2. 多个服务端的维护</h4><br><p>很常见的问题。上面我们说到了，程序会默认寻找 <code>~/.ssh/id_rsa</code> 这个文件，同一目录下显然不能有两个重名文件，也就是说当我们去认证 github 和另外一个 git 服务器的时候，我们需要把两个 rsa 私有密钥的名字换来换去，想用谁就把谁改成 id_rsa。特别麻烦，那肿么办？</p><br><p>之前在网上看到说是对 ssh_config 进行配置，配置内容是：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">    User boy-a</span><br><span class="line">    IdentifyFile ~/.ssh/github</span><br><span class="line">Host xxx.com</span><br><span class="line">    User boy-b</span><br><span class="line">    IdentifyFile ~/.ssh/xxx</span><br></pre></td></tr></table></figure>
<p>这里的 “~/.ssh/github” 和 “~/.ssh/xxx” 都是 rsa 文件，文件的命令可以直接改，也可以在开始生成的时候设定，命名对内容没有任何影响。项目的几行代码应该也是十分清晰的，针对不同的 git 服务器，使用不用的 IdentifyFile。</p><br><p>但是你会发现，你的设置毫无用处，因为你把文件名搞错了！在 linux/unix 下可能是使用 ssh_config 这个文件名，但是在 windows 下是使用 config 作为文件名放在 ~/.ssh/ 目录中！</p><br><h3>四、小结</h3><br><p>这东西我纠结了一个下午，花了将近三个多小时才解决问题，真心快吐血了！说到底就是一个 config 的配置问题，遇到这种问题最快捷的方式并不是在网上疯狂的搜索答案，而是静下心来看看 rsa | git | ssh 的基础知识，了解每个参数及其用途，对症下药！</p>




<p><strong>补充：</strong></p><br><p>　　1）\ssh-add -l” 报错 \Could not open a connection to your authentication agent.”</p><br><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <strong>操作：ssh-agent bash -login -i</strong></p><br><p><strong>　　</strong>2）\Are you sure you want to continue connecting (yes/no)?” 选择 yes ，否则会报错\fatal: Could not read from remote repository.”</p><br><p>　　3） config 文件貌似没啥用，IdentifyFile path/to/rsa 这个地方报错。</p>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/blog/blog/2014/03/03/2014-03-03-cb-javascript-array/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2014/03/03/2014-03-03-cb-javascript-array/" class="post-title-link" itemprop="https://handishenniu.coding.me/blog/page/23/index.html">你所不知道的JavaScript数组</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-03-03 01:56:00" itemprop="dateCreated datePublished" datetime="2014-03-03T01:56:00+08:00">2014-03-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/03/03/javascript-array.html" target="_blank">博客园</a>.</div>

<p>相信每一个 javascript 学习者，都会去了解 JS 的各种基本数据类型，数组就是数据的组合，这是一个很基本也十分简单的概念，他的内容没多少，学好它也不是件难事情。但是本文着重要介绍的并不是我们往常看到的 Array，而是 ArrayBuffer。</p><br><p>我写的很多东西都是因为要完成某些特定的功能而刻意总结的，可以算是备忘，本文也是如此！前段时间一直在研究 Web Audio API 以及语音通信相关的知识，内容侧重于音频流在 AudioContext 各个节点之间的流动情况，而现在要摸清楚音频到流底是个什么样的数据格式，所以对 ArrayBuffer 的研究就显得格外重要了。</p><br><p>本文地址：<a href="http://www.cnblogs.com/hustskyking/p/javascript-array.html" target="_blank" rel="noopener">http://www.cnblogs.com/hustskyking/p/javascript-array.html</a>，转载请注明源地址。</p><br><h3>一、Array 在内存中的堆栈模型</h3><br><h4>1. Array 的获取</h4><br><p>Javascript 中如何产生 Array：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[element0, element1, ..., elementN]</span><br><span class="line">new Array(element0, element1, ..., elementN)</span><br><span class="line">new Array(arrayLength)</span><br></pre></td></tr></table></figure>
<p>直接定义，或者通过构造函数创建一个 Array，当然也可以使用其他的手段：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;array&quot;.split(&quot;&quot;);</span><br><span class="line">&quot;array&quot;.match(/a|r/g);</span><br></pre></td></tr></table></figure>
<p>等等，方式有很多。但是 Array 内部是个什么样的结构，恐怕很多人还不是很清楚。</p><br><h4>2. 堆栈模型</h4><br><p>在数组中我们可以放很多不同数据类型的数据，如：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var arr = [21, &quot;李靖&quot;, new Date(), function()&#123;&#125;, , null];</span><br></pre></td></tr></table></figure>
<p>上面这个数组中一次放入了 数字、字符串、对象、函数、undefined 和 null，对于上面的数据接口我们可以具象的描述下：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    栈</span><br><span class="line">+---------+                  堆</span><br><span class="line">|   21    |         +-------------------+</span><br><span class="line">+---------+         |                   |</span><br><span class="line">|  &quot;李靖&quot; |         |                   |</span><br><span class="line">+---------+         |  +--------+       |</span><br><span class="line">| [refer] |-----------&gt;| Object |       |</span><br><span class="line">+---------+         |  +--------+       |</span><br><span class="line">| [refer] |-----------------&gt;+--------+ |</span><br><span class="line">+---------+         |        |function| |</span><br><span class="line">|undefined|         |        +--------+ |</span><br><span class="line">+---------+         |                   |</span><br><span class="line">|   null  |         +-------------------+</span><br><span class="line">+---------+         Created By Barret Lee</span><br></pre></td></tr></table></figure>
<p>JavaScript 的数据类型分为两种，一种是值类型，一种是引用类型，常见的引用类型有 Object 和 Array，数组的储存模型中，如果是诸如 Number、String 之类的值类型数据会被直接压入栈中，而引用类型只会压入对该值的一个索引，用 C 语言的概念来解释就是只保存了数据的指针，这些数据是储存在堆中的某块区间中。栈堆并不是独立的，栈也可以在堆中存放。</p><br><p>好了，对 Array 的说明就到这里，下面具体说说 ArrayBuffer 的相关知识。</p><br><h3>二、ArrayBuffer</h3><br><p>web 是个啥玩意儿，web 要讨论的最基本问题是什么？我觉得有两点，一个是数据，一个是数据传输，至于数据的展示，纷繁复杂，这个应该是 web 上层的东西。而本文要讨论的 ArrayBuffer 就是最基础的数据类型，甚至不能称之为数据类型，它是一个数据容器，需要通过其他方式来读写。</p><br><p>官方点的定义：</p><br><blockquote><br><p>The ArrayBuffer is a data type that is used to represent a generic, fixed-length binary data buffer. You can’t directly manipulate the contents of an ArrayBuffer; instead, you create an ArrayBufferView object which represents the buffer in a specific format, and use that to read and write the contents of the buffer.</p><br><p><strong>表示二进制数据的原始缓冲区，该缓冲区用于存储各种类型化数组的数据。 无法直接读取或写入 ArrayBuffer，但可根据需要将其传递到类型化数组或 DataView 对象 来解释原始缓冲区。</strong></p><br></blockquote><br><p>他是一个二进制数据的原始缓冲区，虽然 JavaScript 是弱类型语言，但是他本身是对数据的类型和大小都有限制的，我们需要通过某种数据结构将缓冲区的内容有序的读取出来（写进去）。</p><br><h4>1. 原始缓冲区的创建</h4><br><p>通过 ArrayBuffer 这个构造函数可以创建一个原始缓冲区：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var buffer  = new ArrayBuffer(30);</span><br></pre></td></tr></table></figure>
<p>从 chrome 控制台可以看到：</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/03/03/031349161314084.jpg" data-source="http://images.cnitblog.com/i/387325/201403/031349161314084.jpg" alt=""></p><br><p>buffer 实例拥有一个 byteLength 的属性，用于获取 buffer 的 size，一个只有 IE11+ 以及 ios6+ 支持的 slice 方法，用于对 buffer 长度进行截取操作。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ArrayBuffer slice(</span><br><span class="line">    unsigned long begin</span><br><span class="line">    unsigned long end Optional</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>可以测试这个 DEMO：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var buffer = new ArrayBuffer(12);</span><br><span class="line">var x = new Int32Array(buffer);</span><br><span class="line">x[1] = 1234;</span><br><span class="line">var slice = buffer.slice(4);</span><br><span class="line">var y = new Int32Array(slice);</span><br><span class="line">console.log(x[1]);</span><br><span class="line">console.log(y[0]);</span><br><span class="line">x[1] = 6789;</span><br><span class="line">console.log(x[1]);</span><br><span class="line">console.log(y[0]);</span><br></pre></td></tr></table></figure>
<p></p><h4>2. 类型化数组</h4><p></p>
<p>类型化数组类型表示可编制索引和操纵的 ArrayBuffer 对象 的各种视图。 所有数组类型的长度均固定。</p><br><table><br><thead><br><tr><th>名称</th><th>大小（以字节为单位）</th><th>描述</th></tr><br></thead><br><tbody><br><tr><br><td>Int8Array</td><br><td>1</td><br><td>8 位二补码有符号整数</td><br></tr><br><tr><br><td>Uint8Array</td><br><td>1</td><br><td>8 位无符号整数</td><br></tr><br><tr><br><td>Int16Array</td><br><td>2</td><br><td>16 位二补码有符号整数</td><br></tr><br><tr><br><td>Uint16Array</td><br><td>2</td><br><td>16 位无符号整数</td><br></tr><br><tr><br><td>Int32Array</td><br><td>4</td><br><td>32 位二补码有符号整数</td><br></tr><br><tr><br><td>Uint32Array</td><br><td>4</td><br><td>32 位无符号整数</td><br></tr><br><tr><br><td>Float32Array</td><br><td>4</td><br><td>32 位 IEEE 浮点数</td><br></tr><br><tr><br><td>Float64Array</td><br><td>8</td><br><td>64 位 IEEE 浮点数</td><br></tr><br></tbody><br></table><br><p>Int 就是整型，Uint 为无符号整形，Float 为浮点型，这些是 C 语言中的基本概念，我就不具体解释了。由于这些视图化结构都是大同小异，本文只对 Float32Array 类型作说明，读者可以举一反三。</p><br><p>Float32Array 跟 Array 是十分类似的，只不过他每一个元素都是都是一个 32位（4字节） 的浮点型数据。Float32Array 一旦创建其大小不能再修改。</p><br><p>我们可以直接创建一个 Float32Array:</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var x = new Float32Array(2);</span><br><span class="line">x[0] = 17;</span><br><span class="line">console.log(x[0]); // 17</span><br><span class="line">console.log(x[1]); // 0</span><br><span class="line">console.log(x.length); // 2</span><br></pre></td></tr></table></figure>
<p>需要有这么一个概念，他依然是一个数组，只不过该数组中的每个元素都是 Float 32 位的数据类型，再如：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var x = new Float32Array([17, -45.3]);</span><br><span class="line">console.log(x[0]);  // 17</span><br><span class="line">console.log(x[1]);  // -45.29999923706055</span><br><span class="line">console.log(x.length); // 2</span><br></pre></td></tr></table></figure>
<p>我们把一个数组的值直接赋给了 x 这个 Float32Array 对象，那么在储存之前会将它转换成一个 32位浮点数。</p><br><p>由于该类数组的每个元素都是同一类型，所以在堆栈模型中，他们全部会被压入到栈之中，因此类型化数组都是值类型，他并不是引用类型！这个要引起注意，从下面的例子中也可以反映出来：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var x = new Float32Array([17, -45.3]);</span><br><span class="line">var y = new Float32Array(x);</span><br><span class="line">console.log(x[0]); // 17</span><br><span class="line">console.log(x[1]); //-45.29999923706055</span><br><span class="line">console.log(x.length); // 2</span><br><span class="line">x[0] = -2;</span><br><span class="line">console.log(y[0]); // 17, y的值没变</span><br></pre></td></tr></table></figure>
<p>将 x 的值复制给 y，修改 x[0], y[0] 并没有变化。</p><br><p>除了上面的方式，我们还可以通过其他方式来创建一个类型化数组：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var buffer = new ArrayBuffer(12);</span><br><span class="line">var x = new Float32Array(buffer, 0, 2);</span><br><span class="line">var y = new Float32Array(buffer, 4, 1);</span><br><span class="line">x[1] = 7;</span><br><span class="line">console.log(y[0]); // 7</span><br></pre></td></tr></table></figure>
<p>解释下这里为什么返回 7.</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">       ArrayBuffer（12）</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|0|1|2|3|4|5|6|7|8| | | | |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">\              /</span><br><span class="line">  x (Float32Array)</span><br><span class="line">  offset：0</span><br><span class="line">  byteLength：4</span><br><span class="line">  length:2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">       ArrayBuffer（12）</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|0|1|2|3|4|5|6|7|8| | | | |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        \       /</span><br><span class="line">             y</span><br><span class="line"></span><br><span class="line">      Created By Barret Lee</span><br></pre></td></tr></table></figure>
<p>看了上面的图解还有疑问么？我觉得我不用继续解释了。可以把 ArrayBuffer 的单位看成 1，而 Float32Array 的单位是 4.</p><br><h4>3. DataView对象</h4><br><p>DataView 对象对数据的操作更加细致，不过我觉得没啥意思，上面提到的各种类型化数组已经可以基本满足应用了，所以这里就一笔带过，一个简单的示例：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var buffer = new ArrayBuffer(12);</span><br><span class="line">var x = new DataView(buffer, 0);</span><br><span class="line">x.setInt8(0, 22);</span><br><span class="line">x.setFloat32(1, Math.PI);</span><br><span class="line">console.log(x.getInt8(0)); // 22</span><br><span class="line">console.log(x.getFloat32(1)); // 3.1415927410125732</span><br></pre></td></tr></table></figure>
<p>如果感兴趣，可以移步<a href="http://www.javascripture.com/DataView" target="_blank">http://www.javascripture.com/DataView</a>，作详细了解。</p><br><h3>三、XHR2 中的 ArrayBuffer</h3><br><p>ArrayBuffer 的应用特别广泛，无论是 WebSocket、WebAudio 还是 Ajax等等，前端方面只要是处理大数据或者想提高数据处理性能，那一定是少不了 ArrayBuffer 。</p><br><p>XHR2 并不是什么新东西，可能你用到了相关的特性，却不知这就是 XHR2 的内容。最主要的一个东西就是 <code>xhr.responseType</code>，他的作用是设置响应的数据格式，可选参数有：”text”、”arraybuffer”、”blob”或”document”。请注意，设置（或忽略）xhr.responseType = ‘’ 会默认将响应设为”text”。这里存在一个这样的对应关系：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">请求            响应</span><br><span class="line">text            DOMString</span><br><span class="line">arraybuffer     ArrayBuffer</span><br><span class="line">blob            Blob</span><br><span class="line">document        Document</span><br></pre></td></tr></table></figure>
<p>举个栗子：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var xhr = new XMLHttpRequest();</span><br><span class="line">xhr.open(&apos;GET&apos;, &apos;/path/to/image.png&apos;, true);</span><br><span class="line">xhr.responseType = &apos;arraybuffer&apos;;</span><br><span class="line"></span><br><span class="line">xhr.onload = function(e) &#123;</span><br><span class="line">    // this.response == uInt8Array.buffer</span><br><span class="line">    var uInt8Array = new Uint8Array(this.response);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>
<p></p><p>我们在 xhr.responseType 中设置了属性为 arraybuffer，那么在拿到的数据中就可以用类型化数组来接受啦！</p><p></p>
<p></p><h3>四、小结</h3><p></p>
<p></p><p>本文主要介绍了 Array 在堆栈模型中的存放方式，也详细描述了 ArrayBuffer 这个原始缓冲区的二进制数据类型，在 web 开发中，数据以及数据的储存是一个重要的部分，希望引起注意！</p><p></p>
<p></p><p>本文叙述上可能存在错误，请多多斧正！</p><p></p>
<p></p><h3>五、参考资料</h3><p></p>
<ul><br><li><a href="http://www.javascripture.com/ArrayBuffer" target="_blank">http://www.javascripture.com/ArrayBuffer</a></li><br><li><a href="//developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">//developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array</a> MDN Array</li><br><li><a href="http://www.html5rocks.com/zh/tutorials/file/xhr2/" target="_blank">http://www.html5rocks.com/zh/tutorials/file/xhr2/</a> html5rocks</li><br><li><a href="http://technet.microsoft.com/zh-cn/ie/br212485" target="_blank">http://technet.microsoft.com/zh-cn/ie/br212485</a> MSDN</li><br></ul>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/blog/blog/2014/03/01/2014-03-01-cb-javascript-fullscreen/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2014/03/01/2014-03-01-cb-javascript-fullscreen/" class="post-title-link" itemprop="https://handishenniu.coding.me/blog/page/23/index.html">让你的页面瞬间全屏</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-03-01 03:11:00" itemprop="dateCreated datePublished" datetime="2014-03-01T03:11:00+08:00">2014-03-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/03/01/javascript-fullscreen.html" target="_blank">博客园</a>.</div>

<p><span>@update 文章下方有更新，提到了更多全屏的知识以及错误的矫正。</span></p><br><p><span>页面全屏是一个体验非常棒的功能，他可以让你的视觉焦点聚集在你想关注的元素块上。很多浏览器都支持全屏，按下 F11，哦了！ 页面全屏了~&nbsp;但是本文要说的并不是这种全屏。当页面中有个小 DEMO 或者小游戏要展示的时候，用户期望，这个 DEMO 或者游戏可以在全屏下展示，本文就教你如何来展示。</span></p><br><p>如果你是非 IE 浏览器进入的该页面，你可能已经看到了页面上发生了一点小变化，多个东西：</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/03/01/010309260367360.png" data-source="http://images.cnitblog.com/i/387325/201403/010309260367360.png" alt=""></p><br><p>没错，多了个\进入全屏”的按钮，这就是本文要介绍的内容！</p><br><p>本文地址：<a href="http://www.cnblogs.com/hustskyking/p/javascript-fullscreen.html" target="_blank" rel="noopener">http://www.cnblogs.com/hustskyking/p/javascript-fullscreen.html</a>，转载请注明源地址。</p><br><h3>一、全屏策略</h3><br><h4>1. 原理</h4><br><p>一些浏览器提供了元素全屏的接口，这些接口的调用特别简单：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 进入全屏</span><br><span class="line">element.requestFullScreen();</span><br><span class="line">// 退出全屏</span><br><span class="line">document.exitFullscreen();</span><br></pre></td></tr></table></figure>
<p>这是 w3c 规范统一的接口，但是浏览器总是那么调皮，内部实现的时候会加上自己厂商的前缀，如：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 小狐</span><br><span class="line">element.mozRequestFullScreen();</span><br><span class="line">// Chrome</span><br><span class="line">document.webkitCancelFullScreen();</span><br></pre></td></tr></table></figure>
<p>这里有两点需要引起注意，W3C 中的退出全屏是 <code>exitFullscreen</code>，而小狐跟 Chrome 使用的是 <code>cancelFullScreen</code>，这里在作判断的时候不要弄错了；再一点就是当我们退出全屏的时候，并不是使用 element 作为退出的对象了，而是使用 document。</p><br><h4>2. 兼容处理</h4><br><p>原理是很简单，但是针对浏览器的兼容性写起来还是挺麻烦的，幸好 Chrome 换用 blink内核 之后没有继续加上一个 <code>-blink-</code>，否则开发者心里会有无数个草泥马奔腾的！</p><br><p>对于进入全屏：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function launchFullScreen(element) &#123;</span><br><span class="line">   if (element.requestFullscreen) &#123;</span><br><span class="line">      element.requestFullscreen();</span><br><span class="line">    &#125; else if (element.msRequestFullscreen) &#123;</span><br><span class="line">      element.msRequestFullscreen();</span><br><span class="line">    &#125; else if (element.mozRequestFullScreen) &#123;</span><br><span class="line">      element.mozRequestFullScreen();</span><br><span class="line">    &#125; else if (element.webkitRequestFullscreen) &#123;</span><br><span class="line">      element.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于退出全屏：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function cancelFullScreen() &#123;</span><br><span class="line">   if (document.exitFullscreen) &#123;</span><br><span class="line">      document.exitFullscreen();</span><br><span class="line">    &#125; else if (document.msExitFullscreen) &#123;</span><br><span class="line">      document.msExitFullscreen();</span><br><span class="line">    &#125; else if (document.mozCancelFullScreen) &#123;</span><br><span class="line">      document.mozCancelFullScreen();</span><br><span class="line">    &#125; else if (document.webkitExitFullscreen) &#123;</span><br><span class="line">      document.webkitExitFullscreen();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><h4>3. 浏览器兼容性</h4><p></p>
<p><span>IE 用户就甭看了，刚测试，IE11 不兼容</span>（需要加前缀 ms）。对于浏览器的兼容情况，请戳<a href="//developer.mozilla.org/en/DOM/Using_full-screen_mode#AutoCompatibilityTable" target="_blank">这里</a>。目前 Firefox 兼容，不过有点离谱。他会弹出一个让你全屏的提示，此时确实是全屏的，但当你点击提示中的\允许”时，屏幕又退出了全屏，真是让人匪夷所思。我测试的版本（27.0.1）有这个问题，当然，这是浏览器本身的问题，不用纠结。</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/03/01/010319363967428.png" data-source="http://images.cnitblog.com/i/387325/201403/010319363967428.png" alt="" width="553" height="195"></p><br><p>Chrome 对于新特性的支持永远是站在前排，不得不佩服 google 开发工程师的牛掰！</p><br><h3>二、3 个 bug</h3><br><h4>1. window 失去焦点</h4><br><p>当全屏一个元素块的时候，原始状态该元素块可能没有 padding 或者 margin 值，为了让他显示的稍微养眼一些，我们可能会给他主动加上 padding 值，然后在退出全屏的时候在拿到设置的值。但此时，一个 bug 出现鸟，当我们点击全屏页面中的 a 标签，或者触发了某个 <code>window.open</code> 之后，浏览器会失去焦点，跳到新开的页面中，而全屏的页面会退出全屏，搞笑的是我们开始设置的 padding 值他不给我们去掉，这个是令人十分神伤的，<span>不过没关系，有 bug 咱们就打补丁！</span></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">window.onblur = function()&#123;</span><br><span class="line">    cancelFullsreen();</span><br><span class="line">    changeThePadding();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>有人会想到，我们在点击 a 链接的时候先 changeThePadding()，再让 a 标签跳走，这种方式是不合理的，因为除了 a 链接会让页面失去焦点之外还有其他的可能（如 window.open）。</p><br><p><span>@update</span> 因为 bug 3 的存在，这里不能这样改，需要利用浏览器的全屏探测：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(document).on(&apos;webkitfullscreenchange mozfullscreenchange msfullscreenchange fullscreenchange&apos;, function()&#123;</span><br><span class="line">    if (!document.fullscreenElement &amp;&amp;    // alternative standard method</span><br><span class="line">    !document.mozFullScreenElement &amp;&amp;</span><br><span class="line">    !document.webkitFullscreenElement &amp;&amp;</span><br><span class="line">    !document.msFullscreenElement ) &#123;</span><br><span class="line">        // 在这里处理 bug        changeThePadding();</span><br><span class="line">&#125; &#125;);</span><br></pre></td></tr></table></figure>
<p></p><h4>2. 一个貌似可以重现的 bug</h4><p></p>
<p>所谓的可以重现就是，把代码逻辑抽离出来，写个 demo 还能看到 bug。反正我试过好几次，这个 bug 都出现了，懒得写一个 DEMO 重现他。他出现的位置是：我的滚动条是自己设置的样式，当全屏之后，滚动条本应该在页面的最右侧，但是我测试的时候他偶尔会离最右侧有十几个像素，我也不知道为什么。但是当我打开 DevTools 的时候，这十几个像素又奇妙的被缝合了~</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/03/01/010322023845093.png" data-source="http://images.cnitblog.com/i/387325/201403/010322023845093.png" alt=""></p><br><p>后来一想，管你呢，这肯定是 google 的工程师没有留意到的位置！既然开打 DevTools 可以修复，那就说明触发 window.resize 也能解决这个问题，好吧，那就这样试试吧：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">newCancelFullscreen = function()&#123;</span><br><span class="line">    cancelFullscreen();</span><br><span class="line">    window.onresize();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>果然有效，bug 搞定！</p><br><h4>3. 全屏之后，部分浏览器会在该页面失去焦点</h4><br><p>这就相当于，全屏之后，触发了 window.blur();</p><br><h3>三、小结</h3><br><p>除了上面提到的两个 bug，还有一个值得注意的是，如果你全屏的那个元素块很高但却没有设置</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element &#123; overflow:auto; &#125;</span><br></pre></td></tr></table></figure>
<p>之类的东西，你会发现滚烂你的鼠标也滚不出那块区域。</p><br><p>本文介绍了如何使用 javascript 将页面中的某个元素调至全屏，并指出了再使用过程中的两个 bug，希望引起注意！</p><br><h3>四、参考资料</h3><br><ul><br><li><a href="http://baidufe.com/" target="_blank">http://baidufe.com/</a> Alien的笔记</li><br></ul><br><br><br><h4><span>@update 2014/03/01 12:00</span></h4><br><p>1. Trident 内核的 IE 浏览器是支持的，可以用&nbsp;element.msRequestFullscreen()，退出用&nbsp;<span>msExitFullscreen()</span></p><br><p>2. 对于全屏的元素可以使用伪元素给他加样式：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:-webkit-full-screen #myvideo &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3. 浏览器提供的两个方便开发的东西：</p><br><p><a href="//developer.mozilla.org/en-US/docs/Web/API/document.mozFullScreenElement" target="_blank">fullscreenElement</a>：如果这个属性为空，则浏览器处于非全屏状态，否则就是处于全屏。</p><br><p><a href="//developer.mozilla.org/en-US/docs/Web/API/document.mozFullScreenEnabled" target="_blank">fullscreenEnabled</a>：这个属性告诉你浏览器 document 是否可以全屏。</p><br><p>4. 也可以使用 keydown 来控制全屏，如：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">document.addEventListener(&quot;keydown&quot;, function(e) &#123;</span><br><span class="line">  if (e.keyCode == 13) &#123;</span><br><span class="line">    toggleFullScreen();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, false);</span><br></pre></td></tr></table></figure>
<p>对于 toggleFullScreen 函数：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function toggleFullScreen() &#123;</span><br><span class="line">  if (!document.fullscreenElement &amp;&amp;    // alternative standard method</span><br><span class="line">      !document.mozFullScreenElement &amp;&amp; !document.webkitFullscreenElement &amp;&amp; !document.msFullscreenElement ) &#123;  // current working methods</span><br><span class="line">    if (document.documentElement.requestFullscreen) &#123;</span><br><span class="line">      document.documentElement.requestFullscreen();</span><br><span class="line">    &#125; else if (document.documentElement.msRequestFullscreen) &#123;</span><br><span class="line">      document.documentElement.msRequestFullscreen();</span><br><span class="line">    &#125; else if (document.documentElement.mozRequestFullScreen) &#123;</span><br><span class="line">      document.documentElement.mozRequestFullScreen();</span><br><span class="line">    &#125; else if (document.documentElement.webkitRequestFullscreen) &#123;</span><br><span class="line">      document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    if (document.exitFullscreen) &#123;</span><br><span class="line">      document.exitFullscreen();</span><br><span class="line">    &#125; else if (document.msExitFullscreen) &#123;</span><br><span class="line">      document.msExitFullscreen();</span><br><span class="line">    &#125; else if (document.mozCancelFullScreen) &#123;</span><br><span class="line">      document.mozCancelFullScreen();</span><br><span class="line">    &#125; else if (document.webkitExitFullscreen) &#123;</span><br><span class="line">      document.webkitExitFullscreen();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Toggle FullScreen</span><br></pre></td></tr></table></figure>
<p>5. 全屏事件</p><br><p>看到这句代码你可能就懂了：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(document).on(&apos;webkitfullscreenchange mozfullscreenchange fullscreenchange&apos;,fn);</span><br></pre></td></tr></table></figure>
<p>当全屏状态改变时会触发上面的 fullscreenchange 事件，所以 <a href="#2885642"><span><span>#15</span> p2227</span></a> 给我提出的问题就可以得到解决了。</p>


<p><span>文章可能还存在错误的地方，还请多多斧正！</span></p>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/blog/blog/2014/02/28/2014-02-28-cb-webAudio-filter/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2014/02/28/2014-02-28-cb-webAudio-filter/" class="post-title-link" itemprop="https://handishenniu.coding.me/blog/page/23/index.html">声音的滤波</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-02-28 01:57:00" itemprop="dateCreated datePublished" datetime="2014-02-28T01:57:00+08:00">2014-02-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/JavaScript/前端杂烩/网络交互/" itemprop="url" rel="index"><span itemprop="name">网络交互</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/02/28/webAudio-filter.html" target="_blank">博客园</a>.</div>

<p>本系列文章主要是介绍 Web Audio API 的相关知识，以及 web语音通信 中会遇到的一些问题，阐述可能存在错误，还请多多斧正！</p><br><p>通过设备获取音频流会不可避免的渗入一些杂音，这些杂音可能来自你周边的环境，也有可能来自录音设备本身，一些低频的声音还好，人耳难以分辨出来，但是那些高频的白噪声对音质的影响是特别大的，如我们听收音机没有调到正确的频率上，会听到吱吱兹兹的刺耳的杂音。这些杂音不仅增大了音频流信号本身的体积，而且我们的耳朵也不喜欢，所以在传输之前必须对音频做相应的滤波处理。</p><br><p>本文地址：<a href="http://www.cnblogs.com/hustskyking/p/webAudio-filter.html" target="_blank" rel="noopener">http://www.cnblogs.com/hustskyking/p/webAudio-filter.html</a>，转载请注明源地址。</p><br><p><strong>P.S：请在较新版的 chrome 火狐 Firefox 中测试。</strong></p><br><h3>一、滤波节点</h3><br><h4>1. 接口介绍</h4><br><p>频率，是单位时间内完成振动的次数，是描述振动物体往复运动频繁程度的量。一段音频流中包含了各种频率，温和的音乐频率在一个范围之内，超过这个范围的声音一般就是噪声，人和人之间的语音交流，声音也是在一定的频段之中。</p><br><p>在 AudioContext 中用于滤波的节点叫做 BiquadFilterNode，Biquad 是双二阶的意思，这里涉及到了很多通信中专业词汇，我们暂时可以不用在意。BiquadFilterType 包含了各种滤波类型：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">enum BiquadFilterType &#123;</span><br><span class="line">    &quot;lowpass&quot;,</span><br><span class="line">    &quot;highpass&quot;,</span><br><span class="line">    &quot;bandpass&quot;,</span><br><span class="line">    &quot;lowshelf&quot;,</span><br><span class="line">    &quot;highshelf&quot;,</span><br><span class="line">    &quot;peaking&quot;,</span><br><span class="line">    &quot;notch&quot;,</span><br><span class="line">    &quot;allpass&quot;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>用的比较多的就是 lowpass（低通滤波），highpass（高通滤波），bandpass（带通滤波）。低通滤波就是过滤某个临界点的高频信号，只让低频信号通过，高通滤波反之。带通滤波就是允许某个频段的信号通过。这个节点的参数比较多：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">attribute BiquadFilterType type;</span><br><span class="line">readonly attribute AudioParam frequency; // in Hertz</span><br><span class="line">readonly attribute AudioParam detune; // in Cents</span><br><span class="line">readonly attribute AudioParam Q; // Quality factor</span><br><span class="line">readonly attribute AudioParam gain; // in Decibels</span><br><span class="line"></span><br><span class="line">void getFrequencyResponse(Float32Array frequencyHz,</span><br><span class="line">                          Float32Array magResponse,</span><br><span class="line">                          Float32Array phaseResponse);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>其中几个参数的取值范围是：</p><br><blockquote><br><p><strong>Q</strong> 默认是 1, 取值从 0.0001 到 1000.</p><br><p><strong>gain</strong> 默认是 0, 取值从 -40 到 40.</p><br></blockquote><br><h4>2. 初始化接口</h4><br><p>我们可以在初始化的时候将 BiquadFilterType 送进去：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 初始化为低通滤波</span><br><span class="line">var filter = context.createBiquadFilter(&quot;lowpass&quot;);</span><br></pre></td></tr></table></figure>
<p>当然，我们也可以通过设置他的 AudioParam 来控制参数：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var filter = context.createBiquadFilter();</span><br><span class="line">// 设置为低通滤波</span><br><span class="line">filter.type = filter.LOWPASS;</span><br><span class="line">// 只允许频率小于 800Hz 的音频信号通过</span><br><span class="line">filter.frequency.value = 800;</span><br></pre></td></tr></table></figure>
<p>两只方式都是一样的，都好控制。</p><br><h4>3. DEMO 测试</h4><br><p>简单点的话，中间只用一个 filter 节点就可以了，使用低通滤波，将频率设置为 800Hz，可以听到声音很闷，声音不是变小了，而是变闷了~节点之间的连接方式是：</p><br><blockquote><br><p>Source -&gt; Filter -&gt; Destination</p><br></blockquote><br><p>代码：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var AudioContext = AudioContext || webkitAudioContext;</span><br><span class="line">var context = new AudioContext;</span><br><span class="line">//创建节点</span><br><span class="line">var audio = new Audio(&quot;http://qianduannotes.duapp.com/file/SuperMario.mp3&quot;);</span><br><span class="line">audio.loop = true;</span><br><span class="line">var media = context.createMediaElementSource(audio);</span><br><span class="line">var filter = context.createBiquadFilter();</span><br><span class="line">filter.type=filter.LOWPASS;</span><br><span class="line">filter.frequency.value=800;</span><br><span class="line">//连接：media → filter → destination</span><br><span class="line">media.connect(filter);</span><br><span class="line">filter.connect(context.destination);audio.play();</span><br></pre></td></tr></table></figure>
<p>为了方面查看改变频率之后波形的变化，我做了一些处理：</p><br><blockquote><br><p>Source -&gt; Filter -&gt; Analyser -&gt; Destination</p><br><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p><br><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +—–&gt; 波形绘制到 Canvas</p><br></blockquote><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;canvas id=&quot;canvas&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;&lt;br&gt;</span><br><span class="line">&lt;input type=&quot;range&quot; min=&quot;0&quot; max=&quot;100&quot; id=&quot;volume&quot;&gt;</span><br><span class="line">&lt;input type=&quot;button&quot; onclick=&quot;audio.play()&quot; value=&quot;播放&quot;&gt;</span><br><span class="line">&lt;input type=&quot;button&quot; onclick=&quot;audio.pause()&quot; value=&quot;暂停&quot;&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">var AudioContext=AudioContext||webkitAudioContext;</span><br><span class="line">var context=new AudioContext;</span><br><span class="line">//创建节点</span><br><span class="line">var audio = new Audio(&quot;http://qianduannotes.duapp.com/file/SuperMario.mp3&quot;);</span><br><span class="line">audio.loop = true;</span><br><span class="line">var media=context.createMediaElementSource(audio);</span><br><span class="line">var filter=context.createBiquadFilter();</span><br><span class="line">var analyser=context.createAnalyser();</span><br><span class="line">//只允许小于800的频率通过</span><br><span class="line">filter.type=filter.LOWPASS;</span><br><span class="line">filter.frequency.value=800;</span><br><span class="line">//Canvas初始化</span><br><span class="line">var width=canvas.width,height=canvas.height;</span><br><span class="line">var g=canvas.getContext(&quot;2d&quot;);</span><br><span class="line">g.translate(0.5,height/2+0.5);</span><br><span class="line">//连接：media → filter → analyser → destination</span><br><span class="line">media.connect(filter);</span><br><span class="line">filter.connect(analyser);</span><br><span class="line">analyser.connect(context.destination);</span><br><span class="line">//以fftSize为长度创建一个字节数组作为数据缓冲区</span><br><span class="line">var output=new Uint8Array(analyser.fftSize);</span><br><span class="line">//播放帧</span><br><span class="line">(function callee(e)&#123;</span><br><span class="line">  analyser.getByteTimeDomainData(output);</span><br><span class="line">  //将缓冲区的数据绘制到Canvas上</span><br><span class="line">  g.clearRect(-0.5,-height/2-0.5,width,height);</span><br><span class="line">  g.beginPath();</span><br><span class="line">  for(var i=0;i&lt;width;i++)</span><br><span class="line">    g.lineTo(i,height*(output[output.length*i/width|0]/256-0.5));</span><br><span class="line">  g.stroke();</span><br><span class="line">  //请求下一帧</span><br><span class="line">  requestAnimationFrame(callee);</span><br><span class="line">&#125;)();</span><br><span class="line">//播放</span><br><span class="line">audio.play();</span><br><span class="line">load = volume.onchange = function()&#123;</span><br><span class="line">    filter.frequency.value = volume.value * volume.value;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">DEMO Code</span><br></pre></td></tr></table></figure><br><br><p>这里频率的变化是：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter.frequency.value = volume.value * volume.value;</span><br></pre></td></tr></table></figure>
<p></p><p>线性变化可能不太明显，所以改成了平方变化。</p><p></p>
<p></p><h3>二、小结</h3><p></p>
<p></p><p>滤波在通信中一个重要的意义是减少数据传输量，节约频带，提高传送效率，在硬件设备还未跟上语音通信的 web环境中，这个操作是十分有意义的！</p><p></p>
<p></p><p>本节重点是介绍 BiquadFilterNode 在 AudioContext 环境中的使用，比较简单。</p><p></p>
<p></p><h3>三、参考资料</h3><p></p>
<ul><br><li><a href="http://www.w3.org/TR/webaudio/" target="_blank">http://www.w3.org/TR/webaudio/</a> W3C Group</li><br><li><a href="http://www.web-tinker.com/" target="_blank">http://www.web-tinker.com/</a> 次碳酸钴</li><br></ul>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/22/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/blog/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/32/">32</a><a class="extend next" rel="next" href="/blog/page/24/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Lion</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/blog/archives/">
                
                    <span class="site-state-item-count">311</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/blog/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">94</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/blog/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">241</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lion</span>

  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/blog/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/blog/js/src/utils.js?v=6.6.0"></script>

  <script src="/blog/js/src/motion.js?v=6.6.0"></script>



  
  

  

  


  <script src="/blog/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/blog/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  

  

  

  

  

  

  

  <script src="/blog/js/src/music/aplayer.js?v=6.6.0"></script>
  <script src="/blog/js/src/music/init.js?v=6.6.0"></script>
</body>
</html>
