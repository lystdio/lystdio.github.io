<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
































<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="撼地神牛">
<meta property="og:url" content="https://handishenniu.coding.me/page/27/index.html">
<meta property="og:site_name" content="撼地神牛">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="撼地神牛">






  <link rel="canonical" href="https://handishenniu.coding.me/page/27/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>撼地神牛</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?304ebec1c594afeac3282f7afb1f3448";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <meta name="baidu-site-verification" content="qInMpCXDbF">
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
    
    
    
    <a href="https://github.com/lystdio" target="_blank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">撼地神牛</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>站点地图</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

    <a href="https://github.com/lystdio" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/2013/03/29/2013-03-29-cb-lightweight-solution-for-an-iframe-cross-domain-communication/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2013/03/29/2013-03-29-cb-lightweight-solution-for-an-iframe-cross-domain-communication/" class="post-title-link" itemprop="https://handishenniu.coding.me/page/27/index.html">iframe跨域通信的通用解决方案</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-03-29 11:10:00" itemprop="dateCreated datePublished" datetime="2013-03-29T11:10:00+08:00">2013-03-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/杂物间/" itemprop="url" rel="index"><span itemprop="name">杂物间</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2013/03/29/lightweight-solution-for-an-iframe-cross-domain-communication.html" target="_blank">博客园</a>.</div>

<p><a href="http://www.alloyteam.com/wp-content/uploads/2012/08/two_messenger.png" rel="noopener" target="_blank"><img class="aligncenter lh_lazyimg slideshow_imgs" title="图2" src="http://www.alloyteam.com/wp-content/uploads/2012/08/two_messenger.png" alt="2个信使的情况" width="390" height="322"></a></p><br><p><strong>一、背景</strong></p><br><p>在这个Web页面越来越丰富的时代，页面通过iframe嵌入其他的页面也越来越常见。但由于浏览器同源策略的限制，不同域之间属性和操作是无法直接交互的，所以在这个时候，开发者多多少少需要一些方案来突破这些限制。跨域问题涉及的地方也很多，如文档之间的消息通信、ajax请求、Cookie等，本文讨论的是iframe和父页面的消息通信。</p>


<p><strong>二、现状</strong></p><br><p>目前网上也可以找到各种解决方案（少说都有10+个，有兴趣的话可以<a href="http://www.woiweb.net/10-cross-domain-methods.html" target="_blank">去看看</a>），对于现代浏览器来说，原生的postMessage API一定是不二的选择，所以各种方案的不同点均在于IE 6、7中的处理（不用兼容IE6、7的同志可以去看其他文章了）。当然这么多方案有各种优缺点，甚至有些只支持单向跨域，个人觉得实际意义不大。另外一些方案需要proxy.html这样的代理页面做中转，但是涉及服务器上的部署，并且对于多方合作来说还是有些麻烦。</p><br><p><strong>三、思路</strong></p><br><p>虽然不再复述现有的各种方案，但还是想交待一点上下文。相信网上看到最多方案就是利用location.hash或是window.name进行iframe的跨域通信：</p><br><ul><br><li>location.hash会直接暴露在URL里，并且在一些浏览器里会产生历史记录，数据安全性不高也影响用户体验，所以不做考虑。另外由于URL大小的限制，支持传递的数据量也不大。</li><br><li>window.name相比来讲就好很多了，支持2M的数据量，并且当iframe的页面跳到其他地址时，其window.name值保持不变，副作用可以说是最小的。</li><br></ul><br><p>讲到这思路也比较清晰了，咱们就用window.name呗，但问题又来了：只有两个页面同域时才能访问window.name。这个问题还好，只要把iframe改为与父页面同域就可以了。这又衍生了新的问题：这不是意味着只能单向通信了吗，iframe怎么向父页面发消息（不可能去改父页面的location吧）？在暗骂坑爹的同时偶然发现了一个很神奇的方法，就是想访问一个iframe的window.name时，只要将其location改为”about:blank”即可，屡试不爽~没错这个\特性”可以视为IE6/7的一项安全性问题，但利用这个特性来进行跨域通信并没有实际的安全风险。</p><br><p>具体的实现见下图，在iframe的内部再创建一个iframe（我们称之为信使），父子页面轮询信使的window.name，父子页面各自使用变量保存window.name，轮询时发现有变化即被视为收到消息。基本原理就是这么简单，我们继续..</p><br><p><a href="http://www.alloyteam.com/wp-content/uploads/2012/08/one_messenger1.png" rel="noopener" target="_blank"><img class="aligncenter size-full wp-image-2868 lh_lazyimg slideshow_imgs" title="图1" src="http://www.alloyteam.com/wp-content/uploads/2012/08/one_messenger1.png" alt="1个信使的情况" width="487" height="403"></a></p><br><p>图1</p><br><p>作为一个通用的解决方案，我们的目标是提供一个js文件，封装通信的接口，需要通信的页面只要加载js文件就行。但在封装前，需要考虑更复杂一点的情况：当父子页面双方频率较高地双向通信时，如何进行支持？按照上述的方案，信使的window.name并没有读写锁的概念，这意味着消息很容易乱掉或被漏掉。所以更好的方案应该是：创建两个信使，分别负责”父–&gt;子”和”子–&gt;父”的消息传递，并且为了防止消息被冲掉，发送消息时会维护一个消息队列，在取消息时处理消息队列里的所有消息。见图2。</p><br><p><a href="http://www.alloyteam.com/wp-content/uploads/2012/08/two_messenger.png" rel="noopener" target="_blank"><img class="aligncenter size-full wp-image-2869 lh_lazyimg slideshow_imgs" title="图2" src="http://www.alloyteam.com/wp-content/uploads/2012/08/two_messenger.png" alt="2个信使的情况" width="488" height="402"></a></p><br><p>图2</p><br><p><strong>四、封装</strong></p><br><p>最后的封装就是加入了postMessage API的检测，另外也要判断是否为跨域，这样就满足了所有iframe通信的情况了。这里实现的信使只负责消息的监听和发送，所以在使用上是非常简单的：</p><br><div><br><div id="highlighter_724833" class="syntaxhighlighter  js"><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 父页面中</span><br><span class="line">// 初始化信使, 告知与其交互的iframe引用</span><br><span class="line">var messenger = Messenger.initInParent(iframeEl);</span><br><span class="line"></span><br><span class="line">// 监听消息</span><br><span class="line">messenger.onmessage = function (data) &#123;</span><br><span class="line">          ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 发送消息</span><br><span class="line">messenger.send(message);</span><br></pre></td></tr></table></figure><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// iframe中</span><br><span class="line">// 初始化信使</span><br><span class="line">var messenger = Messenger.initInIframe();</span><br><span class="line"></span><br><span class="line">// 监听消息</span><br><span class="line">messenger.onmessage = function (data) &#123;</span><br><span class="line">      ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 发送消息</span><br><span class="line">messenger.send(message);</span><br></pre></td></tr></table></figure><br><br></div><br></div><br><p>具体使用可以参考下方的demo : )</p><br><p><strong>五、总结</strong></p><br><p>虽然国内也有人提过使用”about:blank”进行iframe通信的，但是代码的封装和可读性都不是太好，<a href="http://www.ne.jp/asahi/nanto/moon/2011/12/08/ie-post-message.html" target="_blank">本方案</a>是一日本人所提出<span>，我觉得处理的很好，所以就拿出来和大家分享下</span>。虽然尝试过优化轮询那一块，但暂时无果，有兴趣的朋友可以一起研究下~</p><br><p><strong>DEMO：<a href="http://www.alloyteam.com/wp-content/uploads/2012/08/parent.html" target="_blank">点击这里</a></strong></p><br><p><strong>脚本下载：<a href="http://biqing.alloyteam.com/lab/messenger/messenger.js" target="_blank">http://biqing.alloyteam.com/lab/messenger/messenger.js</a></strong></p><br><p><strong>GitHub：<a href="//github.com/biqing/MessengerJS" target="_blank">//github.com/biqing/MessengerJS</a></strong></p>


<p><strong>原文链接：<a href="http://www.alloyteam.com/2012/08/lightweight-solution-for-an-iframe-cross-domain-communication" target="_blank" rel="noopener">http://www.alloyteam.com/2012/08/lightweight-solution-for-an-iframe-cross-domain-communication</a></strong></p>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/2013/03/29/2013-03-29-cb-ten-methods-cross-domain/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2013/03/29/2013-03-29-cb-ten-methods-cross-domain/" class="post-title-link" itemprop="https://handishenniu.coding.me/page/27/index.html">跨域资源共享的10种方式</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-03-29 11:04:00" itemprop="dateCreated datePublished" datetime="2013-03-29T11:04:00+08:00">2013-03-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/杂物间/" itemprop="url" rel="index"><span itemprop="name">杂物间</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2013/03/29/ten-methods-cross-domain.html" target="_blank">博客园</a>.</div>

<p>在客户端编程语言中，如<span class="wp_keywordlink_affiliate"><a title="javascript" href="http://www.woiweb.net/category/javascript" rel="nofollow" target="_blank">javascript</a></span>和ActionScript，<a href="http://www.woiweb.net/same-origin-policy.html" target="_blank" rel="noopener">同源策略</a>是一个很重要的安全理念，它在保证数据的安全性方面有着重要的意义。<a href="http://www.woiweb.net/same-origin-policy.html" target="_blank" rel="noopener">同 源策略</a>规定<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>之间的脚本是隔离的，一个域的脚本不能访问和操作另外一个域的绝大部分属性和方法。那么什么叫相同域，什么叫不同的域呢？<span id="more-1400"></span></p><br><h3>同源策略</h3><br><p>在客户端编程语言中，如<span class="wp_keywordlink_affiliate"><a title="javascript" href="http://www.woiweb.net/category/javascript" rel="nofollow" target="_blank">javascript</a></span>和ActionScript，同源策略是一个很重要的安全理念，它在保证数据的安全性方面有着重要的意义。同源策略规定<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>之间的脚本是隔离的，一个域的脚本不能访问和操作另外一个域的绝大部分属性和方法。</p><br><p>那么什么叫相同域，什么叫不同的域呢？当两个域具有相同的协议(如http), 相同的端口(如80)，相同的host（如<a href="http://www.example.org)，那么我们就可以认为它们是相同的域。比如http://www.example.org/和http://www.example.org/sub/是同域，而http://www.example.org" target="_blank" rel="noopener">www.example.org)，那么我们就可以认为它们是相同的域。比如http://www.example.org/和http://www.example.org/sub/是同域，而http://www.example.org</a>, //<a href="http://www.example.org" target="_blank" rel="noopener">www.example.org</a>, <a href="http://www.example.org:8080" target="_blank" rel="noopener">http://www.example.org:8080</a>, <a href="http://sub.example.org中的任何两个都将构成" target="_blank" rel="noopener">http://sub.example.org中的任何两个都将构成</a><a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>。同源策略还应该对一些特殊情况做处理，比如限制file协议下脚本的访问权限。本地的<span class="wp_keywordlink_affiliate"><a title="html" href="http://www.woiweb.net/category/html_css" rel="nofollow" target="_blank">html</a></span>文件在浏览器中是通过file协议打开的，如果脚本能通过file协议访问到硬盘上其它任意文件，就会出现安全隐患，目前IE8还有这样的隐患。</p><br><p>受到同源策略的影响，<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a><span class="wp_keywordlink_affiliate"><a title="资源" href="http://www.woiweb.net/category/resource" rel="nofollow" target="_blank">资源</a></span>共享就会受到制约。但是随着人们的实践和浏览器的进步，目前在<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>请求的技巧上，有很多宝贵经验的沉淀和积累。这里我把<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a><span class="wp_keywordlink_affiliate"><a title="资源" href="http://www.woiweb.net/category/resource" rel="nofollow" target="_blank">资源</a></span>共享分成两种，一种是单向的数据请求，还有一种是双向的消息通信。接下来我将罗列出常见的一些<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>方式，以下<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>实例的源代码可以从<a href="http://github.com/colorhook/crossdomain" target="_blank">这里获得</a>。</p><br><h3>单向<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a></h3><br><h4><strong>JSONP</strong></h4><br><p>JSONP (JSON with Padding)是一个简单高效的<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>方式，<span class="wp_keywordlink_affiliate"><a title="html" href="http://www.woiweb.net/category/html_css" rel="nofollow" target="_blank">html</a></span>中的script标签可以加载并执行其他域的JavaScript，于是我们可以通过script标记来动态加载其他域的<span class="wp_keywordlink_affiliate"><a title="资源" href="http://www.woiweb.net/category/resource" rel="nofollow" target="_blank">资源</a></span>。例如我要从域A的页面pageA加载域B的数据，那么在域B的页面pageB中我以JavaScript的形式声明pageA需要的数据，然后在pageA中用script标签把pageB加载进来，那么pageB中的脚本就会得以执行。JSONP在此基础上加入了回调函数，pageB加载完之后会执行pageA中定义的函数，所需要的数据会以参数的形式传递给该函数。JSONP易于实现，但是也会存在一些安全隐患，如果第三方的脚本随意地执行，那么它就可以篡改页面内容，截获敏感数据。但是在受信任的双方传递数据，JSONP是非常合适的选择。</p><br><h4><span class="wp_keywordlink_affiliate"><a title="flash" href="http://www.woiweb.net/tag/flash" rel="nofollow" target="_blank">flash</a></span> <strong>URLLoader</strong></h4><br><p><span class="wp_keywordlink_affiliate"><a title="flash" href="http://www.woiweb.net/tag/flash" rel="nofollow" target="_blank">flash</a></span>有自己的一套安全策略，服务器可以通过crossdomain.xml文件来声明能被哪些域的SWF文件访问，SWF也可以通过API来确定自身能被哪些域的SWF加载。当<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>访问资源时，例如从域<a href="http://www.a.com请求域www.b.com上的数据，我们可以借助" target="_blank" rel="noopener">www.a.com请求域www.b.com上的数据，我们可以借助</a><span class="wp_keywordlink_affiliate"><a title="flash" href="http://www.woiweb.net/tag/flash" rel="nofollow" target="_blank">flash</a></span>来发送HTTP请求。首先，修改域<a href="http://www.b.com上的crossdomain.xml(一般存放在根目录，如果没有需要手动创建)" target="_blank" rel="noopener">www.b.com上的crossdomain.xml(一般存放在根目录，如果没有需要手动创建)</a> ，把<a href="http://www.a.com加入到白名单。其次，通过Flash" target="_blank" rel="noopener">www.a.com加入到白名单。其次，通过Flash</a> URLLoader发送HTTP请求，最后，通过Flash API把响应结果传递给JavaScript。Flash URLLoader是一种很普遍的<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>解决方案，不过需要支持iOS的话，这个方案就无能为力了。</p><br><h4><strong>Access Control</strong></h4><br><p>Access Control是比较超越的<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>方式，目前只在很少的浏览器中得以支持，这些浏览器可以发送一个<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>的HTTP请求（Firefox, Google Chrome等通过XMLHTTPRequest实现，IE8下通过XDomainRequest实现），请求的响应必须包含一个Access-Control-Allow-Origin的HTTP响应头，该响应头声明了请求域的可访问权限。例如<a href="http://www.a.com对www.b.com下的asset.php发送了一个" target="_blank" rel="noopener">www.a.com对www.b.com下的asset.php发送了一个</a><a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>的HTTP请求，那么asset.php必须加入如下的响应头：</p><br><h4><strong>window.name</strong></h4><br><p>window对象的name属性是一个很特别的属性，当该window的location变化，然后重新加载，它的name属性可以依然保持不变。那么我们可以在页面A中用iframe加载其他域的页面B，而页面B中用JavaScript把需要传递的数据赋值给window.name，iframe加载完成之后，页面A修改iframe的地址，将其变成同域的一个地址，然后就可以读出window.name的值了。这个方式非常适合单向的数据请求，而且协议简单、安全。不会像JSONP那样不做限制地执行外部脚本。</p><br><h4><strong>server proxy</strong></h4><br><p>在数据提供方没有提供对JSONP协议或者window.name协议的支持，也没有对其它域开放访问权限时，我们可以通过server proxy的方式来抓取数据。例如当<a href="http://www.a.com域下的页面需要请求www.b.com下的资源文件asset.txt时，直接发送一个指向www.b.com/asset.txt的" target="_blank" rel="noopener">www.a.com域下的页面需要请求www.b.com下的资源文件asset.txt时，直接发送一个指向www.b.com/asset.txt的</a><span class="wp_keywordlink_affiliate"><a title="Ajax" href="http://www.woiweb.net/tag/ajax" rel="nofollow" target="_blank">Ajax</a></span>请求肯定是会被浏览器阻止。这时，我们在<a href="http://www.a.com下配一个代理，然后把" target="_blank" rel="noopener">www.a.com下配一个代理，然后把</a><span class="wp_keywordlink_affiliate"><a title="Ajax" href="http://www.woiweb.net/tag/ajax" rel="nofollow" target="_blank">Ajax</a></span>请求绑定到这个代理路径下，例如<a href="http://www.a.com/proxy/" target="_blank" rel="noopener">www.a.com/proxy/</a>, 然后这个代理发送HTTP请求访问<a href="http://www.b.com下的asset.txt，" target="_blank" rel="noopener">www.b.com下的asset.txt，</a><a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>的HTTP请求是在服务器端进行的，客户端并没有产生<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>的<span class="wp_keywordlink_affiliate"><a title="Ajax" href="http://www.woiweb.net/tag/ajax" rel="nofollow" target="_blank">Ajax</a></span>请求。这个<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>方式不需要和目标资源签订协议，带有侵略性，另外需要注意的是实践中应该对这个代理实施一定程度的保护，比如限制他人使用或者使用频率。</p><br><h3>双向<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a></h3><br><h4><strong>document.domain</strong></h4><br><p>通过修改document的domain属性，我们可以在域和子域或者不同的子域之间通信。同域策略认为域和子域隶属于不同的域，比如<a href="http://www.a.com和sub.a.com是不同的域，这时，我们无法在www.a.com下的页面中调用sub.a.com中定义的JavaScript方法。但是当我们把它们document的domain属性都修改为a.com，浏览器就会认为它们处于同一个域下，那么我们就可以互相调用对方的method来通信了。" target="_blank" rel="noopener">www.a.com和sub.a.com是不同的域，这时，我们无法在www.a.com下的页面中调用sub.a.com中定义的JavaScript方法。但是当我们把它们document的domain属性都修改为a.com，浏览器就会认为它们处于同一个域下，那么我们就可以互相调用对方的method来通信了。</a></p><br><h4><strong>FIM – Fragment Identitier Messaging</strong></h4><br><p>不同的域之间，JavaScript只能做很有限的访问和操作，其实我们利用这些有限的访问权限就可以达到<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>通信的目的了。FIM (Fragment Identitier Messaging)就是在这个大前提下被发明的。父窗口可以对iframe进行URL读写，iframe也可以读写父窗口的URL，URL有一部分被称为frag，就是#号及其后面的字符，它一般用于浏览器锚点定位，Server端并不关心这部分，应该说HTTP请求过程中不会携带frag，所以这部分的修改不会产生HTTP请求，但是会产生浏览器历史记录。FIM的原理就是改变URL的frag部分来进行双向通信。每个window通过改变其他window的location来发送消息，并通过监听自己的URL的变化来接收消息。这个方式的通信会造成一些不必要的浏览器历史记录，而且有些浏览器不支持onhashchange事件，需要轮询来获知URL的改变，最后，URL在浏览器下有长度限制，这个制约了每次传送的数据量。</p><br><h4><strong>Flash LocalConnection</strong></h4><br><p>页面上的双向通信也可以通过Flash来解决，Flash API中有LocalConnection这个类，该类允许两个SWF之间通过进程通信，这时SWF可以播放在独立的Flash Player或者AIR中，也可以嵌在<span class="wp_keywordlink_affiliate"><a title="html" href="http://www.woiweb.net/category/html_css" rel="nofollow" target="_blank">html</a></span>页面或者是PDF中。遵循这个通信原则，我们可以在不同域的HTML页面各自嵌套一个SWF来达到相互传递数据的目的了。SWF通过LocalConnection交换数据是很快的，但是每次的数据量有40kb的大小限制。用这种方式来<a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>通信过于复杂，而且需要了2个SWF文件，实用性不强。</p><br><h4><strong>window.postMessage</strong></h4><br><p>window.postMessage是<span class="wp_keywordlink_affiliate"><a title="html5" href="http://www.woiweb.net/tag/html5" rel="nofollow" target="_blank">html5</a></span>定义的一个<a href="http://dev.w3.org/html5/postmsg/" target="_blank">很新的方法</a>，这个方法可以很方便地跨window通信。由于它是一个很新的方法，所以在很旧和比较旧的浏览器中都无法使用。</p><br><h4><strong>Cross Frame</strong></h4><br><p>Cross Frame是FIM的一个变种，它借助了一个空白的iframe，不会产生多余的浏览器历史记录，也不需要轮询URL的改变，在可用性和性能上都做了很大的改观。它的基本原理大致是这样的，假设在域<a href="http://www.a.com上有页面A.html和一个空白代理页面proxyA.html" target="_blank" rel="noopener">www.a.com上有页面A.html和一个空白代理页面proxyA.html</a>, 另一个域<a href="http://www.b.com上有个页面B.html和一个空白代理页面proxyB.html，A.html需要向B.html中发送消息时，页面会创建一个隐藏的iframe" target="_blank" rel="noopener">www.b.com上有个页面B.html和一个空白代理页面proxyB.html，A.html需要向B.html中发送消息时，页面会创建一个隐藏的iframe</a>, iframe的src指向proxyB.html并把message作为URL frag，由于B.html和proxyB.html是同域，所以在iframe加载完成之后，B.html可以获得iframe的URL，然后解析出message，并移除该iframe。当B.html需要向A.html发送消息时，原理一样。Cross Frame是很好的双向通信方式，而且安全高效，但是它在Opera中无法使用，不过在Opera下面我们可以使用更简单的window.postMessage来代替。</p><br><h3>总结</h3><br><p><a href="http://www.woiweb.net/tag/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener">跨域</a>的方法很多，不同的应用场景我们都可以找到一个最合适的解决方案。比如单向的数据请求，我们应该优先选择JSONP或者window.name，双向通信我们采取Cross Frame，在未与数据提供方没有达成通信协议的情况下我们也可以用server proxy的方式来抓取数据。&nbsp;</p>


<p>原文：<a href="http://www.woiweb.net/10-cross-domain-methods.html" target="_blank" rel="noopener">http://www.woiweb.net/10-cross-domain-methods.html</a></p>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/2013/03/28/2013-03-28-JSON/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2013/03/28/2013-03-28-JSON/" class="post-title-link" itemprop="https://handishenniu.coding.me/page/27/index.html">JSON</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-03-28 11:27:00" itemprop="dateCreated datePublished" datetime="2013-03-28T11:27:00+08:00">2013-03-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/杂物间/" itemprop="url" rel="index"><span itemprop="name">杂物间</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2013/03/28/2986357.html" target="_blank">博客园</a>.</div>

<p><strong>JSON</strong>(JavaScript Object Notation) 是一种轻量级的数据交换格式。 易于人阅读和编写。同时也易于机器解析和生成。 它基于<a href="http://www.crockford.com/javascript" target="_blank" rel="noopener">JavaScript Programming Language</a>,&nbsp;<a href="http://www.ecma-international.org/publications/files/ecma-st/ECMA-262.pdf" target="_blank" rel="noopener">Standard ECMA-262 3rd Edition - December 1999</a>的一个子集。 JSON采用完全独立于语言的文本格式，但是也使用了类似于C语言家族的习惯（包括C, C++, C#, Java, JavaScript, Perl, Python等）。 这些特性使JSON成为理想的数据交换语言。</p><br><p>JSON建构于两种结构：</p><br><ul><br><li>\名称/值”对的集合（A collection of name/value pairs）。不同的语言中，它被理解为<em>对象（object）</em>，纪录（record），结构（struct），字典（dictionary），哈希表（hash table），有键列表（keyed list），或者关联数组 （associative array）。</li><br><li>值的有序列表（An ordered list of values）。在大部分语言中，它被理解为数组（array）。</li><br></ul><br><p>这些都是常见的数据结构。事实上大部分现代计算机语言都以某种形式支持它们。这使得一种数据格式在同样基于这些结构的编程语言之间交换成为可能。</p><br><p>JSON具有以下这些形式：</p><br><p>对象是一个无序的\”名称/值”对”集合。一个对象以{“（左括号）开始，}“（右括号）结束。每个\名称”后跟一个\:”（冒号）；\”名称/值” 对”之间使用\,”（逗号）分隔。</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2013/03/28/object.gif" data-source="http://json.org/object.gif" alt="" width="598" height="113"></p><br><p>数组是值（value）的有序集合。一个数组以[“（左中括号）开始，]“（右中括号）结束。值之间使用\,”（逗号）分隔。</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2013/03/28/array.gif" data-source="http://json.org/array.gif" alt="" width="598" height="113"></p><br><p>值（<em>value</em>）可以是双引号括起来的字符串（<em>string</em>）、数值(number)、<code>true</code>、<code>false</code>、&nbsp;<code>null</code>、对象（object）或者数组（array）。这些结构可以嵌套。</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2013/03/28/value.gif" data-source="http://json.org/value.gif" alt="" width="598" height="278"></p><br><p>字符串（<em>string</em>）是由双引号包围的任意数量Unicode字符的集合，使用反斜线转义。一个字符（character）即一个单独的字符串（character string）。</p><br><p>字符串（<em>string</em>）与C或者Java的字符串非常相似。</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2013/03/28/string.gif" data-source="http://json.org/string.gif" alt="" width="598" height="413"></p><br><p>数值（<em>number</em>）也与C或者Java的数值非常相似。除去未曾使用的八进制与十六进制格式。除去一些编码细节。</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2013/03/28/number.gif" data-source="http://json.org/number.gif" alt="" width="598" height="266"></p><br><p>空白可以加入到任何符号之间。 以下描述了完整的语言。</p><br><p><strong>原文链接：<a href="http://json.org/json-zh.html" target="_blank" rel="noopener">http://json.org/json-zh.html</a></strong></p>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/2013/03/28/2013-03-28-cb-javascript-userdata-and-localstorage/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2013/03/28/2013-03-28-cb-javascript-userdata-and-localstorage/" class="post-title-link" itemprop="https://handishenniu.coding.me/page/27/index.html">JavaScript本地储存（2）：userData和localStorage</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-03-28 11:25:00" itemprop="dateCreated datePublished" datetime="2013-03-28T11:25:00+08:00">2013-03-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/杂物间/" itemprop="url" rel="index"><span itemprop="name">杂物间</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2013/03/28/javascript-userdata-and-localstorage.html" target="_blank">博客园</a>.</div>

<p>　　<a title="JavaScript本地储存（1）：cookie在前端" href="http://www.cnblogs.com/hustskyking/archive/2013/03/27/2984328.html" target="_blank">上文</a>对cookie的知识进行了归纳，同时也提到了cookie的大小是有限制的。</p><br><blockquote><br><p><span>cookie 是有大小限制的，每个 cookie 所存放的数据不能超过4kb，如果 cookie 字符串的长度超过4kb，则该属性将返回空字符串。&mdash;&mdash;<a title="JavaScript本地储存（1）：cookie在前端" href="http://www.cnblogs.com/hustskyking/archive/2013/03/27/2984328.html" target="_blank">上文</a>提要</span></p><br></blockquote><br><p>　　<span>如果我们需要在客户端储存比较大容量的数据，怎么办？下面给大家介绍userData和localStorage的基本知识和一些应用。先说明下为什么把两个东西扯到一起说，因为后面写了个对象，把UserData和localStorage包装到了一起O(&cap;_&cap;)O~</span></p>


<h3><span>Conception [基本概念]</span></h3><br><p><span>　　毫无疑问，无论是UserData还是localStorage都是储存在客户端磁盘的一段文本，但是两者也有很大的差异性。</span></p><br><p><strong>　　1.UserData</strong></p><br><p>　　单单说UserData是不太准确的，要实现本地储存得说\UserData Behavior”。</p><br><blockquote><br><p>　<span>UserData Behavior</span></p><br><span>&mdash;&mdash; Enables the object to persist data in user data.　　</span></blockquote><br><p>　　这是来自<a title="MS UserData" href="http://msdn.microsoft.com/zh-cn/vstudio/ms531424" target="_blank">微软</a>的解释。意思是允许对象在用户页面保存数据。它适用于win32和Unix的MS IE5.0版本以上平台。</p><br><table class="clsStd"><br><tbody><br><tr><th>Security Zone</th><th>Document Limit (KB)</th><th>Domain Limit (KB)</th></tr><br><tr><br><td>Local Machine</td><br><td>128</td><br><td>1024</td><br></tr><br><tr><br><td>Intranet</td><br><td>512</td><br><td>10240</td><br></tr><br><tr><br><td>Trusted Sites</td><br><td>128</td><br><td>1024</td><br></tr><br><tr><br><td>Internet</td><br><td>128</td><br><td>1024</td><br></tr><br><tr><br><td>Restricted</td><br><td>64</td><br><td>640</td><br></tr><br></tbody><br></table><br><p>　　上表是UserData的大小限制，也是从微软那里拷贝过来的，大家应该知道IE浏览器有可以设置安全等级</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2013/03/28/28222651-d8a98f6c104a45b2a2e3bb404811f269.png" data-source="http://images.cnitblog.com/blog/387325/201303/28222651-d8a98f6c104a45b2a2e3bb404811f269.png" alt="IE安全设置"></p><br><p>　　表格里的几个英文单词就对应着看吧，~(≧▽≦)/~</p><br><p><strong>　　2.localStorage</strong></p><br><blockquote><br><p><span>Web storage is being standardized by the World Wide Web Consortium (W3C). It was originally part of the HTML 5 specification, but is now in a separate specification. It is supported by Internet Explorer 8, Mozilla-based browsers ,Safari 4, Google Chrome 4, and Opera 10.50. As of 14 March 2011 Opera and IE9 supports the storage events.</span></p><br></blockquote><br><p>　　上面一串*&lt;%￥…是来自<a title="wiki localStorage" href="http://en.wikipedia.org/wiki/Web_storage" target="_blank">wiki</a>的说明，跟localStorage一起的还有sessionStorage，这里就只说说localStorage。上文大意（英语水平低就是可怜）：网页储存被W3C标准化，原来本属于HTML5标准的一部分，现在已经被独立出来了。它适用于IE 8+，FF 2+，Safari 4+，chrome 4+， Opera 10.50+。</p><br><p>　　<strong>P.S.：</strong>sessionStorage用于本地存储一个会话（session）中的数据，这些数据只有在同一个会话中的页面才能访问并且当会话结束后数据也随之销毁。因此sessionStorage不是一种持久化的本地存储，仅仅是会话级别的存储。</p><br><p><span>　　</span>标准建议对于每个domain，localStorage大小为<strong>5M</strong>，达到限制时浏览器可以去问用户是否允许增加存储空间。</p><br><p>　 &nbsp; 这是<a title="test" href="http://hi.baidu.com/erik168/item/85490cce5ccb7ad9ee183bdf" target="_blank">网友</a>的对\浏览器具体能保存多少个字符”的一个测试。</p><br><blockquote><br><p><strong>测试结果：</strong></p><br><p>　对英文字符和中文字符来说，测试结果并无变化，所以存储格式可能为UTF16。</p><br><p>　以下为测试数据(key有5个字符):</p><br><p>　　　　IE 9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;&nbsp;4999995 + 5 = 5000000</p><br><p>　　　　firefox&nbsp;8.0.2&nbsp;&gt;&nbsp;5242875 + 5 = 5242880</p><br><p>　　　　chrome &nbsp;16.0 &nbsp;&gt;&nbsp;2621435 + 5 = 2621440</p><br><p>　　　　safari &nbsp;5.1 &nbsp;&nbsp;&gt;&nbsp;2621435&nbsp;+ 5 = 2621440</p><br><p>　　　　opera &nbsp; 11.60&nbsp;&gt;&nbsp;1966068&nbsp;+ 5 = 1966073</p><br><p>&nbsp;</p><br></blockquote><br><br><br><h3>&nbsp;Grammar [语法介绍]</h3><br><p><strong>　　1.userData</strong></p><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">XML       &lt;prefix: customtag=&quot;&quot; id=&quot;sID&quot;&gt;</span><br><span class="line">HTML     　&lt;element id=&quot;sID&quot;&gt;</span><br><span class="line">Scripting  object .style.behavior = &quot;url(&apos;#default#userData&apos;)&quot;</span><br><span class="line">object .addBehavior (&quot;#default#userData&quot;)</span><br></pre></td></tr></table></figure><br><br>&lt;/prefix:&gt;<br><p>　　上面介绍了几种语言中userData的用法，当然这也是从<a title="MSDN UserData" href="http://msdn.microsoft.com/zh-cn/vstudio/ms531424" target="_blank">MSDN</a>拿过来的（呵呵，真心好用）。那这里我们重点放在前端常用的位置上，也就是标红了的HTML中。</p><br><p>　　　　1）<span><strong>属性:</strong></span></p><br><p><span>　　　　　　expires &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;设置或者获取 userData behavior 保存数据的失效日期。</span></p><br><p><span>　　　　　　XMLDocument &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;获取 XML 的引用。</span></p><br><p><span>　　　　2）<strong>方法:</strong></span></p><br><p><span>　　　　　　getAttribute() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;获取指定的属性值。</span></p><br><p><span>　　　　　　load(object) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;从 userData &nbsp;存储区载入存储的对象数据。</span></p><br><p><span>　　　　　　removeAttribute() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;移除对象的指定属性。</span></p><br><p><span>　　　　　　save(object) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 将对象数据存储到一个 userData 存储区。</span></p><br><p><span>　　　　　　setAttribute() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 设置指定的属性值。</span></p><br><p><span>　　具体如何实现，请转到最下面封装的一个对象中~</span></p><br><p><strong>　　2.localStorage</strong></p><br><p>　　　　1）<strong>方法：</strong></p><br><p>　　　　　　localStorage.getItem(key) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;获取指定key本地存储的值</p><br><p>　　　　　　localStorage.setItem(key,value) &nbsp;将value存储到key字段</p><br><p>　　　　　　localStorage.removeItem(key) &nbsp; &nbsp;删除指定key本地存储的值</p><br><br><br><h3>Pacaking [对象封装]</h3>

<figure class="highlight plain"><figcaption><span>of userDate&&localStorage</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">localData = &#123;</span><br><span class="line">         hname:location.hostname?location.hostname:&apos;localStatus&apos;,</span><br><span class="line">         isLocalStorage:window.localStorage?true:false,</span><br><span class="line">         dataDom:null,</span><br><span class="line"></span><br><span class="line">         initDom:function()&#123; //初始化userData</span><br><span class="line">             if(!this.dataDom)&#123;</span><br><span class="line">                 try&#123;</span><br><span class="line">                     this.dataDom = document.createElement(&apos;input&apos;);//这里使用hidden的input元素</span><br><span class="line">                     this.dataDom.type = &apos;hidden&apos;;</span><br><span class="line">                     this.dataDom.style.display = &quot;none&quot;;</span><br><span class="line">                     this.dataDom.addBehavior(&apos;#default#userData&apos;);//这是userData的语法</span><br><span class="line">                     document.body.appendChild(this.dataDom);</span><br><span class="line">                     var exDate = new Date();</span><br><span class="line">                     exDate = exDate.getDate()+30;</span><br><span class="line">                     this.dataDom.expires = exDate.toUTCString();//设定过期时间</span><br><span class="line">                 &#125;catch(ex)&#123;</span><br><span class="line">                     return false;</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">             return true;</span><br><span class="line">         &#125;,</span><br><span class="line">         set:function(key,value)&#123;</span><br><span class="line">             if(this.isLocalStorage)&#123;</span><br><span class="line">                 window.localStorage.setItem(key,value);</span><br><span class="line">             &#125;else&#123;</span><br><span class="line">                 if(this.initDom())&#123;</span><br><span class="line">                     this.dataDom.load(this.hname);</span><br><span class="line">                     this.dataDom.setAttribute(key,value);</span><br><span class="line">                     this.dataDom.save(this.hname)</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;,</span><br><span class="line">         get:function(key)&#123;</span><br><span class="line">             if(this.isLocalStorage)&#123;</span><br><span class="line">                 return window.localStorage.getItem(key);</span><br><span class="line">             &#125;else&#123;</span><br><span class="line">                 if(this.initDom())&#123;</span><br><span class="line">                     this.dataDom.load(this.hname);</span><br><span class="line">                     return this.dataDom.getAttribute(key);</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;,</span><br><span class="line">         remove:function(key)&#123;</span><br><span class="line">             if(this.isLocalStorage)&#123;</span><br><span class="line">                 localStorage.removeItem(key);</span><br><span class="line">             &#125;else&#123;</span><br><span class="line">                 if(this.initDom())&#123;</span><br><span class="line">                     this.dataDom.load(this.hname);</span><br><span class="line">                     this.dataDom.removeAttribute(key);</span><br><span class="line">                     this.dataDom.save(this.hname)</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p></p><h3>Usage [使用说明]</h3><p></p>
<p>　　<strong>1.初始化</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localData.initDom();</span><br></pre></td></tr></table></figure>
<p>　　<strong>2.设置 key/value</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localData.set(key, value);</span><br></pre></td></tr></table></figure>
<p>　　<strong>3.获取 value</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localData.get(key);</span><br></pre></td></tr></table></figure>
<p>　　<strong>4.删除</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localData.remove(key);</span><br></pre></td></tr></table></figure>
<p></p><h3>Attention [注意事项]</h3><p></p>
<p>　　1.localStorage用于持久化的本地存储，除非主动删除数据，否则数据是永远不会过期的。</p><br><p>　　2.出于安全原因，只有在同一个目录和相同的协议下才能进行持久化存储。数据是未加密的，建议你不要保存过于隐私的信息。</p><br><p>下文将对<a title="web离线" href="http://www.cnblogs.com/hustskyking/archive/2013/03/30/javascript-applicationcache.html" target="_blank">web离线</a>作具体介绍。</p>


<p></p><h3>Related blog [相关博文]</h3><p></p>
<p>　　<a class="titlelink" href="http://www.cnblogs.com/hustskyking/archive/2013/03/27/javascript-cookie.html" target="_blank" rel="noopener">JavaScript本地储存（1）：cookie在前端</a><span>&nbsp;</span></p><br><p>　　<a class="titlelink" href="http://www.cnblogs.com/hustskyking/archive/2013/03/30/javascript-applicationcache.html" target="_blank" rel="noopener">Javascript本地储存（3）：离线web应用</a></p>


<p></p><h3>Reference [参考资料]</h3><p></p>
<p>　　1.<a title="wiki localStorage" href="http://en.wikipedia.org/wiki/Web_storage" target="_blank">wiki</a></p><br><p>　　2.<a title="MSDN UserData" href="http://msdn.microsoft.com/zh-cn/vstudio/ms531424" target="_blank">MSDN</a></p><br><p>　　3.<a title="beiYuu博客" href="http://www.cnblogs.com/beiyuu/archive/2011/07/20/js-localstorage-userdata.html" target="_blank">BeiYuu博客</a></p><br><p>　　4.<a title="test" href="http://hi.baidu.com/erik168/item/85490cce5ccb7ad9ee183bdf" target="_blank">网友</a></p>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/2013/03/27/2013-03-27-cb-javascript-cookie/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2013/03/27/2013-03-27-cb-javascript-cookie/" class="post-title-link" itemprop="https://handishenniu.coding.me/page/27/index.html">JavaScript本地储存（1）：cookie在前端</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-03-27 12:13:00" itemprop="dateCreated datePublished" datetime="2013-03-27T12:13:00+08:00">2013-03-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/杂物间/" itemprop="url" rel="index"><span itemprop="name">杂物间</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2013/03/27/javascript-cookie.html" target="_blank">博客园</a>.</div>

<p><style><!--
.tbArg{}
  .tbArg td { padding:2px;}
.tbArg tr:nth-child(2n) { background:#eee}
.tbArg tr:first { font-size:16px;}
--></style></p>
<p>　　以前心里总是默念着这句：\知道资源在哪儿就是成功的一半”。对于很多知识的学习，好像也一直停留在知道它在哪儿的地步，看来现在需要有所改变了！</p><br><p>　　<strong>那就从cookie开始吧~</strong></p><br><blockquote><br><p>　　<strong>Cookie</strong><span>（复数形态Cookies），中文名称为</span><strong>小型文本文件</strong><span>或</span><strong>小甜饼</strong><sup id="cite_ref-1" class="reference"></sup><span>，指某些</span>网站<span>为了辨别用户身份、<span>进行session跟踪</span>而储存在用户本地终端（Client Side）上的数据（通常经过</span>加密<span>）。定义于RFC2109（已废弃），最新取代的规范是<a title="rfc2965.txt" href="http://www.ietf.org/rfc/rfc2965.txt" target="_blank">RFC2965</a>。</span></p><br></blockquote><br><h3>Clasification [分类]</h3><br><p>　　说到底，cookie就是保存在客户端的一段<strong>字符串</strong>（注意：不是数组）。</p><br><p>　　cookie可以手动设置，也可以由服务器产生，当客户端（浏览器）向服务器发送请求，服务器会反馈一些信息给客户端，这些信息的key/value值被浏览器作为文件保存在客户端特定的文件夹中。</p><br><p>　　<strong>1.内存Cookie</strong></p><br><p>　　　　<span>内存Cookie由</span>浏览器<span>维护，保存在</span>内存<span>中，浏览器关闭后就消失了，其存在时间是短暂的。</span></p><br><p><span>　　<strong>2.磁盘Cookie</strong></span></p><br><p>&nbsp;　　　&nbsp;<span>硬盘Cookie保存在</span>硬盘<span>里，有一个过期时间，除非用户手工清理或到了过期时间，硬盘Cookie不会被删除，其存在时间是长期的。</span></p>


<p></p><h3>Arguments [参数]</h3><p></p>
<table class="tbarg" border="1" cellspacing="5" cellpadding="5"><caption>&nbsp;</caption><br><tbody><br><tr><br><td width="120"><span><strong>属&nbsp; 性&nbsp; 名</strong></span></td><br><td><span><strong>描&nbsp;&nbsp;&nbsp; 述</strong></span></td><br></tr><br><tr><br><td><span>String name</span></td><br><td><span>该Cookie的名称。Cookie一旦创建，名称便不可更改</span></td><br></tr><br><tr><br><td><span>Object value</span></td><br><td><span>该Cookie的值。如果值为Unicode字符，需要为字符编码。如果值为二进制数据，则需要使用BASE64编码</span></td><br></tr><br><tr><br><td><span>int maxAge</span></td><br><td><span>该Cookie失效的时间，单位秒。如果为正数，则该Cookie在maxAge秒之后失效。如果为负数，该Cookie为临时Cookie，关闭浏览器即失效，浏览器也不会以任何形式保存该Cookie。如果为0，表示删除该Cookie。默认为–1</span></td><br></tr><br><tr><br><td><span>boolean secure</span></td><br><td><span>该Cookie是否仅被使用安全协议传输。安全协议。安全协议有HTTPS，SSL等，在网络上传输数据之前先将数据加密。默认为false</span></td><br></tr><br><tr><br><td><span>String path</span></td><br><td><span>该Cookie的使用路径。如果设置为\/sessionWeb/“，则只有contextPath为\/sessionWeb”的程序可以访问该Cookie。如果设置为\/“，则本域名下contextPath都可以访问该Cookie。注意最后一个字符必须为\/“</span></td><br></tr><br><tr><br><td><span>String domain</span></td><br><td><span>可以访问该Cookie的域名。如果设置为.google.com”，则所有以\google.com”结尾的域名都可以访问该Cookie。注意第一个字符必须为.“</span></td><br></tr><br><tr><br><td><span>String comment</span></td><br><td><span>该Cookie的用处说明。浏览器显示Cookie信息的时候显示该说明</span></td><br></tr><br><tr><br><td><span>int version</span></td><br><td><span>该Cookie使用的版本号。0表示遵循Netscape的Cookie规范，1表示遵循W3C的RFC 2109规范</span></td><br></tr><br></tbody><br></table>


<p></p><h3>Detail [参数详解]</h3><p></p>
<p>　　<strong>1。key/value</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 document.cookie  = &apos;username=木子Vs立青&apos;</span><br></pre></td></tr></table></figure>
<p>　　很简单吧，cookie是document的一个属性，在控制台，console.log(document.cookie)可以看到该域名下的cookie值。设置方式就是<strong>key=value</strong>.</p><br><p>　　如何已经存在了username这个key，再次如上操作就是修改value值了。</p><br><p>　　<strong>2.maxAge</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 var date = new Date();</span><br><span class="line">2</span><br><span class="line">3 date.setDate(date.getDate()+30);</span><br><span class="line">4 date.toGMTString();</span><br><span class="line">5</span><br><span class="line">6 document.cookie = &quot;name=value;expires=date&quot;</span><br></pre></td></tr></table></figure>
<p>　　expires这个参数是用来设置cookie有效期的，如果将expires设置成一个过去的时间（相对本机系统时间），相应的cookie就被删除，当然也可以手动来删除cookie~</p><br><p>　　上面给出的例子是以天为单位计算的，如果要改成其他的计时方式，可以修改第三行date.setDate(date.getDate()+30)，为30天。比如要改成按小时计算：date.setHours(date.getHours()+30)，为30小时。</p><br><p>　　<strong>3.path</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 document.cookie = &quot;name=value;expires=date;path=path&quot;</span><br></pre></td></tr></table></figure>
<p>&nbsp;　　这里的path如何理解？比如在<a href="http://www.cnblogs.com/hustskyking/下创建一个cookie（即path=/hustskyking/），那么在http://www.cnblogs.com/hustskyking/下所有子目录都是可以访问这个cookie的；再比如path=/，意思就是在http://www.cnblogs.com/下的任何子目录都是访问到这个cookie的。" target="_blank" rel="noopener">http://www.cnblogs.com/hustskyking/下创建一个cookie（即path=/hustskyking/），那么在http://www.cnblogs.com/hustskyking/下所有子目录都是可以访问这个cookie的；再比如path=/，意思就是在http://www.cnblogs.com/下的任何子目录都是访问到这个cookie的。</a></p><br><p>　　<strong>4.domain</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 document.cookie = &quot;name=value;path=path;expires=date;domain=domain&quot;</span><br></pre></td></tr></table></figure>
<p>　　这里要说的是同域访问，比如在a.example.com和b.example.com下共享c.example.com下的cookie文件，只需如此这般…</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 document.cookie = &quot;name=value;path=path;expires=date;domain=example.com&quot;</span><br></pre></td></tr></table></figure>
<p>　　你应该懂了~</p><br><p>　　<strong>5.secure</strong></p><br><p>&nbsp;　　我们知道在网络中建立连接传输数据有两种常见的方式，一个钟是http，另一种是https，后者是加密传输。大家从上面也可以看出，cookie很容易被窃取，通过下面这个方式可以为cookie加一把安全锁。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 document.cookie = &quot;username=木子Vs立青;secure&quot;</span><br></pre></td></tr></table></figure>
<p>　　加了secure（默认值为空），之后，cookie提交到服务器时使用的是https传输。当然这只是加了一层防护，不等于我爱罗的绝对防御~</p>


<p></p><h3>Attention [注意事项]</h3><p></p>
<p>　　<strong>1.value值保护</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 document.cookie = name + &quot;=&quot;+ escape (value);</span><br></pre></td></tr></table></figure>
<p>　　我们通常会用escape将value进行编码，取回的时候用unescape()函数就行了。</p><br><p>　　<strong>2.重要信息就不要放到cookie值中了~</strong></p>


<p></p><h3>Class [封装cookie方法的类]</h3><p></p>
<p><span>　　<strong>1、创建Cookie对象</strong></span></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 //因为是作为类名或者命名空间的使用，所以和Math对象类似，这里使用Cookie来表示该对象</span><br><span class="line">2 var Cookie = new Object();</span><br></pre></td></tr></table></figure>
<p><strong>　　2、实现设置Cookie的方法</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> 1 //name是要设置cookie的名称；value是设置cookie的值，option包括了其它选项，是一个对象作为参数</span><br><span class="line"> 2 Cookie.setCookie = function(name, value, option) &#123;</span><br><span class="line"> 3   //用于存储赋值给document.cookie的cookie格式字符串</span><br><span class="line"> 4   var str = name+&quot;=&quot;+escape(value);</span><br><span class="line"> 5   if(option) &#123;</span><br><span class="line"> 6     //如果设置了过期时间</span><br><span class="line"> 7      if(option.expireDays) &#123;</span><br><span class="line"> 8       var date = new date();</span><br><span class="line"> 9       var ms = option.expireDays*24*3600*1000;</span><br><span class="line">10       date.setTime(date.getTime()+ms);</span><br><span class="line">11       str += &quot;; expires=&quot;+date.toGMTString();</span><br><span class="line">12     &#125;</span><br><span class="line">13     if(option.path) str += &quot;; path=&quot;+path;//设置访问路径</span><br><span class="line">14      if(option.domain) str += &quot;; domain=&quot;+domain;//设置访问主机</span><br><span class="line">15      if(option.secure) str += &quot;; true&quot;;//设置安全性</span><br><span class="line">16   &#125;</span><br><span class="line">17   document.cookie = str;</span><br><span class="line">18 &#125;</span><br></pre></td></tr></table></figure>
<p><strong><span>　　3、实现取Cookie的方法</span></strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> 1 //name是指定cookie的名称，从而根据名称返回相应的值</span><br><span class="line"> 2 Cookie.getCookie = function(name) &#123;</span><br><span class="line"> 3   var cookieArray = document.cookie.split(&quot;; &quot;);//得到分割的cookie名值对</span><br><span class="line"> 4   var cookie = new Object();</span><br><span class="line"> 5   for(var i=0; i</span><br><span class="line">&lt;p&gt;&lt;strong&gt;&lt;span&gt;　　4、实现删除Cookie的方法&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<p> 1 //name是指定cookie的名称，从而根据这个名称删除相应的cookie。在实现中，删除cookie是通过调用setCookie来完成的，将option的expireDays属性指定为负数即可<br> 2 Cookie.deleteCookie = function(name) {<br> 3   this.setCookie(name, “”, {expireDays:-1});//将过期时间设置为过去来删除一个cookie<br> 4 }<br> 5 //通过下面的代码，整个Cookie对象创建完毕后，可以将其放到一个大括号中来定义：<br> 6 var Cookie = {<br> 7    setCookie:function(){},<br> 8    getCookie:function(){},<br> 9    deleteCookie:function(){}<br>10 }<br>11<br>12 //通过这种形式，可以让Cookie的功能更加清晰，它作为一个全局对象，大大方便了对Cookie的操作<br>13 Cookie.setCookie(“user”, “terry”);<br>14 Cookie.deleteCookie(“user”);</p>
<p><code>`</code></p>
<p></p><h3>Substitution [cookie的替代品]</h3><p></p>
<p>　　<span>cookie 是有大小限制的，每个 cookie 所存放的数据不能超过4kb，如果 cookie 字符串的长度超过4kb，则该属性将返回空字符串。</span></p><br><p><span>　　如果我们需要在客户端储存比较大容量的数据，怎么办？选择cookie肯定是不明智的，下次会给大家详细说明userData和localStorage。</span></p><br><p>　　<a title="MSDN userData" href="http://msdn.microsoft.com/zh-cn/vstudio/ms531424" target="_blank">userData</a>(windows+IE平台):&nbsp;<strong>128Kb</strong></p><br><p><strong>　　</strong><a title="wiki localStorage" href="http://en.wikipedia.org/wiki/Web_storage" target="_blank">localStorage</a>(现代浏览器):&nbsp;<strong>&nbsp;5M</strong></p>


<p></p><h3><span>&nbsp;Related blog [相关博文]</span></h3><p></p>
<p><span>　　<a class="titlelink" href="http://www.cnblogs.com/hustskyking/archive/2013/03/28/javascript-userdata-and-localstorage.html" target="_blank" rel="noopener">JavaScript本地储存（2）：userData和localStorage</a></span></p><br><p><span>　　<a class="titlelink" href="http://www.cnblogs.com/hustskyking/archive/2013/03/30/javascript-applicationcache.html" target="_blank" rel="noopener">Javascript本地储存（3）：离线web应用</a></span></p>


<p></p><h3>Reference [参考资料]</h3><p></p>
<p>　　1.<a title="百度文库cookie" href="http://baike.baidu.com/view/835.htm" target="_blank">百度文库</a></p><br><p>　　2.<a title="wiki cookie" href="http://zh.wikipedia.org/wiki/Cookie" target="_blank">wiki</a></p><br><p>　　3.<a title="聂微东博客 js操作cookie" href="http://www.cnblogs.com/Darren_code/archive/2011/11/24/Cookie.html" target="_blank">聂微东博客</a></p><br><p><strong>　　</strong>4.<a title="alixixi" href="http://www.alixixi.com/web/a/2008050746872.shtml" target="_blank">alixixi</a></p>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/2013/03/27/2013-03-27-汤姆大叔的JS系列文章，放在自己家里好找/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2013/03/27/2013-03-27-汤姆大叔的JS系列文章，放在自己家里好找/" class="post-title-link" itemprop="https://handishenniu.coding.me/page/27/index.html">汤姆大叔的JS系列文章，放在自己家里好找</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-03-27 04:58:00" itemprop="dateCreated datePublished" datetime="2013-03-27T04:58:00+08:00">2013-03-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/杂物间/" itemprop="url" rel="index"><span itemprop="name">杂物间</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2013/03/27/2984962.html" target="_blank">博客园</a>.</div>

<p></p><h3>汤姆大叔文章列表</h3><p></p>
<p><a href="http://www.cnblogs.com/TomXu/archive/2011/12/28/2286877.html" target="_blank">深入理解JavaScript系列（1）：编写高质量JavaScript代码的基本要点</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2011/12/29/2290308.html" target="_blank">深入理解JavaScript系列（2）：揭秘命名函数表达式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2011/12/30/2288372.html" target="_blank">深入理解JavaScript系列（3）：全面解析Module模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2011/12/31/2289423.html" target="_blank">深入理解JavaScript系列（4）：立即调用的函数表达式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/05/2305453.html" target="_blank">深入理解JavaScript系列（5）：强大的原型和原型链</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/06/2305513.html" target="_blank">深入理解JavaScript系列（6）：S.O.L.I.D五大原则之单一职责SRP</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/09/2306329.html" target="_blank">深入理解JavaScript系列（7）：S.O.L.I.D五大原则之开闭原则OCP</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/10/2310244.html" target="_blank">深入理解JavaScript系列（8）：S.O.L.I.D五大原则之里氏替换原则LSP</a></p><br><div class="cnblogs_Highlighter"><br><pre class="brush:javascript;gutter:false;">S.O.L.I.D需要加强</pre><br></div><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/11/2311956.html" target="_blank">深入理解JavaScript系列（9）：根本没有\JSON对象”这回事！</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/12/2308594.html" target="_blank">深入理解JavaScript系列（10）：JavaScript核心（晋级高手必读篇）</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/13/2308101.html" target="_blank">深入理解JavaScript系列（11）：执行上下文（Execution Contexts）</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/16/2309728.html" target="_blank">深入理解JavaScript系列（12）：变量对象（Variable Object）</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/17/2310479.html" target="_blank">深入理解JavaScript系列（13）：This? Yes, this!</a></p><br><div class="cnblogs_Highlighter"><br><pre class="brush:javascript;gutter:false;">还需加强。</pre><br></div><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/18/2312463.html" target="_blank">深入理解JavaScript系列（14）：作用域链(Scope Chain)</a></p><br><div class="cnblogs_Highlighter"><br><pre class="brush:javascript;gutter:false;">还需加强。</pre><br></div><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/30/2326372.html" target="_blank">深入理解JavaScript系列（15）：函数（Functions）</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/31/2330252.html" target="_blank">深入理解JavaScript系列（16）：闭包（Closures）</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/03/2330295.html" target="_blank">深入理解JavaScript系列（17）：面向对象编程之一般理论</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/06/2330609.html" target="_blank">深入理解JavaScript系列（18）：面向对象编程之ECMAScript实现</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/08/2341439.html" target="_blank">深入理解JavaScript系列（19）：求值策略</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/10/2342098.html" target="_blank">深入理解JavaScript系列（20）：《你真懂JavaScript吗？》答案详解</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/14/2330137.html" target="_blank">深入理解JavaScript系列（21）：S.O.L.I.D五大原则之接口隔离原则ISP</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/15/2330143.html" target="_blank">深入理解JavaScript系列（22）：S.O.L.I.D五大原则之依赖倒置原则DIP</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/16/2351331.html" target="_blank">深入理解JavaScript系列（23）：JavaScript与DOM（上）&mdash;&mdash;也适用于新手</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/17/2351938.html" target="_blank">深入理解JavaScript系列（24）：JavaScript与DOM（下</a>）</p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/20/2352817.html" target="_blank">深入理解JavaScript系列（25）：设计模式之单例模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/21/2352994.html" target="_blank">深入理解JavaScript系列（26）：设计模式之构造函数模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/22/2353341.html" target="_blank">深入理解JavaScript系列（27）：设计模式之建造者模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/23/2353389.html" target="_blank">深入理解JavaScript系列（28）：设计模式之工厂模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/24/2353434.html" target="_blank">深入理解JavaScript系列（29）：设计模式之装饰者模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/28/2353448.html" target="_blank">深入理解JavaScript系列（30）：设计模式之外观模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/02/29/2354979.html" target="_blank">深入理解JavaScript系列（31）：设计模式之代理模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/03/02/2355128.html" target="_blank">深入理解JavaScript系列（32）：设计模式之观察者模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/03/05/2358552.html" target="_blank">深入理解JavaScript系列（33）：设计模式之策略模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/03/08/2358593.html" target="_blank">深入理解JavaScript系列（34）：设计模式之命令模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/03/09/2358903.html" target="_blank">深入理解JavaScript系列（35）：设计模式之迭代器模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/03/13/2374789.html" target="_blank">深入理解JavaScript系列（36）：设计模式之中介者模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/09/2379774.html" target="_blank" rel="noopener">深入理解JavaScript系列（37）：设计模式之享元模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/10/2435381.html" target="_blank">深入理解JavaScript系列（38）：设计模式之职责链模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/11/2435452.html" target="_blank">深入理解JavaScript系列（39）：设计模式之适配器模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/12/2435530.html" target="_blank">深入理解JavaScript系列（40）：设计模式之组合模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/13/2436371.html" target="_blank">深入理解JavaScript系列（41）：设计模式之模板方法</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/16/2436460.html" target="_blank">深入理解JavaScript系列（42）：设计模式之原型模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/18/2437099.html" target="_blank">深入理解JavaScript系列（43）：设计模式之状态模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/19/2437321.html" target="_blank">深入理解JavaScript系列（44）：设计模式之桥接模式</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/23/2438005.html" target="_blank">深入理解JavaScript系列（45）：代码复用模式（避免篇）</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/24/2438050.html" target="_blank">深入理解JavaScript系列（46）：代码复用模式（推荐篇）</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/25/2439527.html" target="_blank">深入理解JavaScript系列（47）：对象创建模式（上篇）</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/04/26/2443010.html" target="_blank">深入理解JavaScript系列（48）：对象创建模式（下篇）</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/07/23/2580701.html" target="_blank">深入理解JavaScript系列（49）：Function模式（上篇</a>）</p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/07/24/2581239.html" target="_blank">深入理解JavaScript系列（50）：Function模式（下篇）</a></p><br><p><a href="http://www.cnblogs.com/TomXu/archive/2012/07/26/2581268.html" target="_blank">深入理解JavaScript系列（结局篇）</a></p>




<p>原文地址：<a href="http://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html" target="_blank" rel="noopener">http://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html</a></p>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/2012/09/22/2012-09-22-在Javascript中模仿接口（一）/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2012/09/22/2012-09-22-在Javascript中模仿接口（一）/" class="post-title-link" itemprop="https://handishenniu.coding.me/page/27/index.html">在Javascript中模仿接口（一）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2012-09-22 12:27:00" itemprop="dateCreated datePublished" datetime="2012-09-22T12:27:00+08:00">2012-09-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/杂物间/" itemprop="url" rel="index"><span itemprop="name">杂物间</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2012/09/22/3049800.html" target="_blank">博客园</a>.</div>

<p><strong>&nbsp;本文从ITeye导入</strong></p>


<p>在JavaScript中模仿接口&mdash;&mdash;本文摘自《JavaScript设计模式》</p>


<p><strong>一、用注释描述接口</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">    interface Composite &#123;</span><br><span class="line">        function add(child);</span><br><span class="line">        function remove(child);</span><br><span class="line">        function getChild(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    interface FormItem &#123;</span><br><span class="line">        function save();</span><br><span class="line">    &#125;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">var CompositeForm = function(id, method, action)&#123;</span><br><span class="line">    //......</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//Implement the Composite interface.</span><br><span class="line">CompositeForm.prototype.add = function(child)&#123;</span><br><span class="line">    //......</span><br><span class="line">&#125;</span><br><span class="line">CompositeForm.prototype.remove = function(child)&#123;</span><br><span class="line">    //......</span><br><span class="line">&#125;</span><br><span class="line">CompositeForm.prototype.getChild = function(index)&#123;</span><br><span class="line">    //......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">///Implement the FormItem interface.</span><br><span class="line">CompositeForm.prototype.save = function()&#123;</span><br><span class="line">    //......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种模仿并不是很好，他们有为确保CompositeForm真正实现正确的方法集而进行检查，</p><br><p>也不会跑出错误以高质程序员程序中的问题。</p>


<p><strong>二、用属性检查模仿接口</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">        interface Composite &#123;</span><br><span class="line">            function add(child);</span><br><span class="line">            function remove(child);</span><br><span class="line">            function getChild(index);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        interface FormItem &#123;</span><br><span class="line">            function save();</span><br><span class="line">        &#125;</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">    var CompositeForm = function(id, method, action)&#123;</span><br><span class="line">        this.implementsInterfaces = [&apos;Composite&apos;, &apos;FormItem&apos;];</span><br><span class="line">        //......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function addForm(formInstance)&#123;</span><br><span class="line">        if(!implements(formInstance, &apos;Composite&apos;, &apos;FormItem&apos;))&#123;</span><br><span class="line">            throw new Error(&quot;Object does not implement a required interface&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        //......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //The implements function, which checks to see if an object delcares that it</span><br><span class="line">    //implements the required interfaces.</span><br><span class="line"></span><br><span class="line">    function implements(object)&#123;</span><br><span class="line">        for(var i = 0; i &lt; arguments.length; i++)&#123;</span><br><span class="line">            var interfaceName = arguments[i];</span><br><span class="line">            var interfaceFound = false;</span><br><span class="line">            for(var j = 0; j &lt; object.implementsInterface.length; j++)&#123;</span><br><span class="line">                if(object.implementsInterface[j] == interfaceName)&#123;</span><br><span class="line">                    interfaceFound = true;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if(!interfaceFound)&#123;</span><br><span class="line">                return false; //An interface was not found.</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return true; //All interface were found.</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在这个例子中，CompositeForm宣传自己实现了Composite和FormItem这两个接口，其做法是吧这链各个接口的</p><br><p>名称加入一个名为implement上Interfaces的数组。</p>


<p><strong>三、用鸭式辨型模仿接口</strong></p>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//Interfaces</span><br><span class="line"></span><br><span class="line">var composite = new Interface(&apos;Composite&apos;, [&apos;add&apos;, &apos;remove&apos;, &apos;getChild&apos;]);</span><br><span class="line">var FormItem = new Interface(&apos;FormItem&apos;, [&apos;save&apos;]);</span><br><span class="line"></span><br><span class="line">//CompositeForm class</span><br><span class="line">var CompositeForm = function(id, method, action)&#123;</span><br><span class="line">    //........</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addForm(formInstancd)&#123;</span><br><span class="line">    ensureImplements(formInstance, Composite, FormItem);</span><br><span class="line">    //........</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span>&nbsp;</span></p><br><p>待续……</p>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/2012/09/18/2012-09-18-如何设计一个支持方法链式调用的JavaScript库/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2012/09/18/2012-09-18-如何设计一个支持方法链式调用的JavaScript库/" class="post-title-link" itemprop="https://handishenniu.coding.me/page/27/index.html">如何设计一个支持方法链式调用的JavaScript库</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2012-09-18 09:37:00" itemprop="dateCreated datePublished" datetime="2012-09-18T09:37:00+08:00">2012-09-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/杂物间/" itemprop="url" rel="index"><span itemprop="name">杂物间</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2012/09/18/3049801.html" target="_blank">博客园</a>.</div>

<p><strong>本文从ITeye导入</strong></p>


<p>可以先了解下&nbsp;<a class="titlelink" href="http://www.cnblogs.com/hustskyking/archive/2012/09/18/3049802.html" target="_blank" rel="noopener">javascript链式调用的实现方式</a></p>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">//设计一个支持方法链式调用的JavaScript库</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">    常见于大多数JavaScript库中的特性</span><br><span class="line"> &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;</span><br><span class="line">       特性          |                       说明</span><br><span class="line"> &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;</span><br><span class="line">       事件          |   添加和删除事件监听器，对时间对象进行规范内化处理</span><br><span class="line">       DOM          |   类名管理，样式管理</span><br><span class="line">       Ajax         |   多XMLHttpRequest进行规范化处理</span><br><span class="line"> &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;</span><br><span class="line"></span><br><span class="line">    注：可以对私有的_$构造函数进行扩充</span><br><span class="line">*/</span><br><span class="line">Function.prototype.method = function(name, fn)&#123;</span><br><span class="line">    this.prototype[name] = fn;</span><br><span class="line">    return this;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">(function()&#123;</span><br><span class="line"></span><br><span class="line">    function _$(els)&#123;</span><br><span class="line">        this.element = [];</span><br><span class="line">        for(var i = 0, len = els.length; i &lt; len; i++)&#123;</span><br><span class="line">            var element = els[i];</span><br><span class="line">            if(typeof element === &apos;string&apos;)&#123;</span><br><span class="line">                element = document.getElementById(element);</span><br><span class="line">            &#125;</span><br><span class="line">            this.element.push(element);</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">        Events</span><br><span class="line">            * addEvent</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">    _$.method(&apos;addEvent&apos;, function(type, fn)&#123;</span><br><span class="line">            var add = function(el)&#123;</span><br><span class="line">            if(window.addEventListener)&#123;</span><br><span class="line">                el.addEventListener(type, fn, false);</span><br><span class="line">            &#125;else if(window.attachEvent)&#123;</span><br><span class="line">                el.attachEvent(&apos;on&apos; + type, fn);</span><br><span class="line">            &#125;</span><br><span class="line">            this.each(function(el)&#123;</span><br><span class="line">                add(el);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;).</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">        otherFun</span><br><span class="line">            * each</span><br><span class="line">            * setStyle</span><br><span class="line">            * show</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">        method(&apos;otherFun&apos;, function(fn)&#123;</span><br><span class="line">            for(var i = 0, len = this.element.length; i &lt; len; i++)&#123;</span><br><span class="line">                fn.call(this, this.element[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            return this;</span><br><span class="line">        &#125;).</span><br><span class="line">        method(&apos;setStyle&apos;, function(prop, val)&#123;</span><br><span class="line">            this.each(function(el)&#123;</span><br><span class="line">                el.style[prop] = val;</span><br><span class="line">            &#125;);</span><br><span class="line">            return this;</span><br><span class="line">        &#125;).</span><br><span class="line">        method(&apos;show&apos;, function()&#123;</span><br><span class="line">            var that = this;</span><br><span class="line">            this.each(function(el)&#123;</span><br><span class="line">                that.setStyle(&apos;display&apos;, &apos;none&apos;);</span><br><span class="line">            &#125;);</span><br><span class="line">            return this;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    window.installHelper = function(scope, interface)&#123;</span><br><span class="line">        scope[interface] = function()&#123;</span><br><span class="line">            return new _$(arguments);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">    //处理库中$的冲突问题</span><br><span class="line"></span><br><span class="line">    用户可能会这样使用：</span><br><span class="line">    installHelper(window, &quot;$&quot;);</span><br><span class="line"></span><br><span class="line">    $(&apos;example&apos;).show();</span><br><span class="line"></span><br><span class="line">    也可以将功能添加到实现定义好的命名空间对象中：</span><br><span class="line">    window.com = window.com || &#123;&#125;;</span><br><span class="line">    com.example = com.example || &#123;&#125;;</span><br><span class="line">    com.example.util = com.example.util || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    installHelper(com.example.util, &apos;$&apos;);</span><br><span class="line">    (function()&#123;</span><br><span class="line">        var get = com.example.util.get;</span><br><span class="line">        get(&apos;example&apos;).show();</span><br><span class="line">    &#125;)();</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/2012/09/18/2012-09-18-javascript链式调用的实现方式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2012/09/18/2012-09-18-javascript链式调用的实现方式/" class="post-title-link" itemprop="https://handishenniu.coding.me/page/27/index.html">javascript链式调用的实现方式</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2012-09-18 08:58:00" itemprop="dateCreated datePublished" datetime="2012-09-18T08:58:00+08:00">2012-09-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/杂物间/" itemprop="url" rel="index"><span itemprop="name">杂物间</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2012/09/18/3049802.html" target="_blank">博客园</a>.</div>

<p><strong>本文从ITeye导入</strong>&nbsp;</p>


<p>在我们所用到的库中，可以看到很多诸如</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(window).addEvent(&apos;load&apos;, function()&#123;</span><br><span class="line">    $(&apos;test&apos;).show().setStyle(&apos;color&apos;, &apos;red&apos;).addEvent(&apos;click&apos;, function(e)&#123;</span><br><span class="line">        $(this).setStyle(&apos;color&apos;, &apos;yellow&apos;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>&nbsp;的链式调用，那么这样的链式结构是怎么实现的呢，下面我们利用代码来探讨一番：</p>


<p>&nbsp;先分解下，我们队$函数已经很熟悉了，他通常返回一个HTML元素或者HTML元素的集合，如下所示：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function $()&#123;</span><br><span class="line">    var elements = [];</span><br><span class="line">    for(var i = 0, len = arguments.length; i &lt; len; i++)&#123;</span><br><span class="line">        var element = els[i];</span><br><span class="line">        if(typeof element === &apos;string&apos;)&#123;</span><br><span class="line">            element = document.getElementById(element);</span><br><span class="line">        &#125;</span><br><span class="line">        elements.push(element);</span><br><span class="line">    &#125;</span><br><span class="line">    return elements;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;但是，如果把这个函数改造为一个构造器，把那些元素作为数组保存在一个实例属性中，并让所有定义在构造器函数的prototype属性所指对象中的方法都返回用以调用放方法的那个实例的引用，那么他就具有了进行链式调用的能力。</p>


<p>先别说的太远，我们首先需要把这个$函数改为一个工厂函数，他负责创建支持链式调用的对象。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(function()&#123;</span><br><span class="line"></span><br><span class="line">    function _$(els)&#123;</span><br><span class="line">        this.element = [];</span><br><span class="line">        for(var i = 0, len = els.length; i &lt; len; i++)&#123;</span><br><span class="line">            var element = els[i];</span><br><span class="line">            if(typeof element === &apos;string&apos;)&#123;</span><br><span class="line">                element = document.getElementById(element);</span><br><span class="line">            &#125;</span><br><span class="line">            this.element.push(element);</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">    window.$ = function()&#123;</span><br><span class="line">        return new _$(arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>由于所有对象都会继承其原型对象的属性和方法，所以我们可以让定义原型对象中的那几个方法都返回用以调用方法的实例对象的引用，这样既可以对那些方法进行链式调用，想好这一点，我们现在就动手在_$这个私用构造函数的prototype对象那个中添加方法，以便实现链式调用。</p>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">(function()&#123;</span><br><span class="line"></span><br><span class="line">    function _$(els)&#123;</span><br><span class="line">        this.element = [];</span><br><span class="line">        for(var i = 0, len = els.length; i &lt; len; i++)&#123;</span><br><span class="line">            var element = els[i];</span><br><span class="line">            if(typeof element === &apos;string&apos;)&#123;</span><br><span class="line">                element = document.getElementById(element);</span><br><span class="line">            &#125;</span><br><span class="line">            this.element.push(element);</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _$.prototype = &#123;</span><br><span class="line">        each: function(fn)&#123;</span><br><span class="line">            for(var i = 0, len = this.element.length; i &lt; len; i++)&#123;</span><br><span class="line">                fn.call(this, this.element[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            return this;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        setStyle: function(prop, val)&#123;</span><br><span class="line">            this.each(function(el)&#123;</span><br><span class="line">                el.style[prop] = val;</span><br><span class="line">            &#125;);</span><br><span class="line">            return this;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        show: function()&#123;</span><br><span class="line">            var that = this;</span><br><span class="line">            this.each(function(el)&#123;</span><br><span class="line">                that.setStyle(&apos;display&apos;, &apos;none&apos;);</span><br><span class="line">            &#125;);</span><br><span class="line">            return this;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        addEvent: function(type, fn)&#123;</span><br><span class="line">            var add = function(el)&#123;</span><br><span class="line">                if(window.addEventListener)&#123;</span><br><span class="line">                    el.addEventListener(type, fn, false);</span><br><span class="line">                &#125;else if(window.attachEvent)&#123;</span><br><span class="line">                    el.attachEvent(&apos;on&apos; + type, fn);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            this.each(function(el)&#123;</span><br><span class="line">                add(el);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    window.$ = function()&#123;</span><br><span class="line">        return new _$(arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>&nbsp;看看该类每个方法的最后一行，你会发现他们都是以”return this;”结束，这样将用以调用方法的对象传给调用链上的下一个方法。</p><br><p><br>              </p>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.coding.me/2012/09/17/2012-09-17-javascript的灵活性/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2012/09/17/2012-09-17-javascript的灵活性/" class="post-title-link" itemprop="https://handishenniu.coding.me/page/27/index.html">javascript的灵活性</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2012-09-17 09:32:00" itemprop="dateCreated datePublished" datetime="2012-09-17T09:32:00+08:00">2012-09-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/杂物间/" itemprop="url" rel="index"><span itemprop="name">杂物间</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2012/09/17/3049803.html" target="_blank">博客园</a>.</div>


<p>如果你偏爱过程式编程，你可以这样：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*Start and stop animations using functions.*/</span><br><span class="line">function startAnination() &#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line">function stopAnination()&#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种做法很简单，但是你无法创建可以保存状态并且具有一些仅对其内部状态进行操作的方法的动画对象。</p><br><p>下面的代码定义了一个类，你可以用它创建这种对象：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/*Anim class.*/</span><br><span class="line"> var Anim = function()&#123;</span><br><span class="line">    ....</span><br><span class="line"> &#125;;</span><br><span class="line"> Anim.prototype.start = function()&#123;</span><br><span class="line">    ....</span><br><span class="line"> &#125;;</span><br><span class="line"> Anim.prototype.stop = function()&#123;</span><br><span class="line">    ....</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> /*Usage.*/</span><br><span class="line"> var myAnim = new Anim();</span><br><span class="line"> myAnim.start();</span><br><span class="line"> ....</span><br><span class="line"> myAnim.stop();</span><br></pre></td></tr></table></figure>
<p>上述代码定义了一个名为Anim的类，并把两个方法赋给该类的prototype的属性。</p><br><p>如果你更喜欢把类的定义封装在一条声明中，则可以改用下面的代码：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/*Anim class, with a slightly different syntax for declaring methods*/</span><br><span class="line">var Anim = function()&#123;</span><br><span class="line">    ....</span><br><span class="line"> &#125;;</span><br><span class="line"> Anim.prototype = &#123;</span><br><span class="line">    start : function()&#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;;</span><br><span class="line">    stop : function()&#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这在传统的面向对象程序员看来肯呢过更眼熟一点，他们习惯于看到类的方法声明内嵌在类的</p><br><p>声明之中。要是你以前用过这样的编程风格，可能想尝试下下面的是里。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/*Add method to the Function object that can be used to declare methods*/</span><br><span class="line">Function.prototype.methed = function(name, fn)&#123;</span><br><span class="line">    this.prototype[name] = fn;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/*Anim class, with ,methods created using a conbenience ,method.*/</span><br><span class="line">var Anim = function()&#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;;</span><br><span class="line">Anim.method(&apos;start&apos;, function()&#123;</span><br><span class="line">    .....</span><br><span class="line">&#125;);</span><br><span class="line">Anim.method(&apos;stop&apos;, function()&#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Function.protytype.method用于为类添加新方法。他有两个参数，第一个是字符串，表示新方法</p><br><p>的名称；第二个是用作新方法的函数。</p>


<p>你可以进一步修改Function.prototype.method, 使其可被链式调用。这只需要在他返回this</p><br><p>值即可：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/*This version alllows the calls to be chained.*/</span><br><span class="line">Function.prototype.method = function(name, fn)&#123;</span><br><span class="line">    this.prototype[name] = fn;</span><br><span class="line">    return this;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/*Anim class, with methods created using a convenience and chaining.*/</span><br><span class="line">var Anim = function()&#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;;</span><br><span class="line">Anim.</span><br><span class="line">    method(&apos;start&apos;, function()&#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;).</span><br><span class="line">    method(&apos;stop&apos;, function()&#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p><br>              </p>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/26/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><span class="page-number current">27</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/28/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Lion</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">273</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">84</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">215</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lion</span>

  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  

  

  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  

  

  

  

  

  

  

  <script src="/js/src/music/aplayer.js?v=6.6.0"></script>
  <script src="/js/src/music/init.js?v=6.6.0"></script>
</body>
</html>
