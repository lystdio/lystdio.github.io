<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
































<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="撼地神牛">
<meta property="og:url" content="https://handishenniu.com/page/16/index.html">
<meta property="og:site_name" content="撼地神牛">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="撼地神牛">






  <link rel="canonical" href="https://handishenniu.com/page/16/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>撼地神牛</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ab65f84a007e7fb250fe7dbe36037ad6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <meta name="baidu-site-verification" content="qInMpCXDbF">
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
    
    
    
    <a href="https://github.com/lystdio" target="_blank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">撼地神牛</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>站点地图</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

    <a href="https://github.com/lystdio" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.com/2014/08/19/2014-08-19-post-method-change-to-options/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2014/08/19/2014-08-19-post-method-change-to-options/" class="post-title-link" itemprop="https://handishenniu.com/page/16/index.html">POST请求失败，变成options请求</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-08-19 00:00:00" itemprop="dateCreated datePublished" datetime="2014-08-19T00:00:00+08:00">2014-08-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/前端杂烩/网络交互/" itemprop="url" rel="index"><span itemprop="name">网络交互</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>问题：</strong></p>
<blockquote>
<p>我的 XMLHttpRequest 跨域 POST ，怎么请求方式自动由POST变成OPTIONS了呢？</p>
</blockquote>
<p>浏览器为了安全起见，会先发送一个 options 请求，确保请求发送是安全的，一般 POST DELETE PUT 等请求都会修改服务器资源，所以浏览器会先发一个请求，问问服务器是否会正确（允许）请求。</p>
<p>出现 OPTIONS 的情况一般为：</p>
<ol>
<li>非 GET | POST 请求</li>
<li>POST 请求的 content-type 不是常规的那三个</li>
<li>POST 请求的 payload 为 text/xml</li>
</ol>
<blockquote>
<p>我的请求倒是很常规啊，不存在上面3条的问题</p>
</blockquote>
<p>跨域了呀，浏览器也会为了试探服务器是否会接受请求，先发送一个 options 请求。即便是服务器允许程序跨域访问，若不支持 options 请求，请求也会死掉。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.com/2014/08/07/2014-08-07-{}+[]/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2014/08/07/2014-08-07-{}+[]/" class="post-title-link" itemprop="https://handishenniu.com/page/16/index.html">Object + Array</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-08-07 00:00:00" itemprop="dateCreated datePublished" datetime="2014-08-07T00:00:00+08:00">2014-08-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>问题：</strong></p>
<pre><code>{} + []
</code></pre><ul>
<li>{} + [] 结果应该是 0</li>
<li>console.log({} + []) 结果应该是 object object</li>
</ul>
<p>两个 {} 的语义不一样,前者被解析成 {}; +[]; 后者 {} 为对象.</p>
<ul>
<li><p>操作符，针对非 Number 的处理内部调用 ToPrimary() 函数, {} 和 [] 都执行了自身的 toString 函数</p>
<p>  ({} + [])<br>  ({}) + []</p>
</li>
</ul>
<p>这些表达式中，{}都被当做对象来解析，而不是 作用块</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.com/2014/08/07/2014-08-07-position-and-margin/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2014/08/07/2014-08-07-position-and-margin/" class="post-title-link" itemprop="https://handishenniu.com/page/16/index.html">绝对定位，margin:0 auto，让元素竖直居中</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-08-07 00:00:00" itemprop="dateCreated datePublished" datetime="2014-08-07T00:00:00+08:00">2014-08-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>问题：</strong></p>
<pre><code>div {
    margin: auto;
    position: absolute;
    top: 0;
    left: 0;
    right: 0
    bottom: 0;
    width: 100px;
    height: 100px;
}
</code></pre><p>是如何自适应的。</p>
<p>原因是，绝对定位的布局取决于三个因素，一个是元素的位置，一个是元素的尺寸，一个是元素的margin值。</p>
<p>没有设置尺寸和 margin 的元素会自适应剩余空间，位置固定则分配尺寸，尺寸固定边会分配 margin，都是自适应的。</p>
<p>IE7- 的渲染方式不同，渲染规则也不一样，他不会让定位元素去自适应。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.com/2014/08/03/2014-08-03-cb-interface-in-development/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2014/08/03/2014-08-03-cb-interface-in-development/" class="post-title-link" itemprop="https://handishenniu.com/page/16/index.html">谈谈前后端的分工协作</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-08-03 01:06:00" itemprop="dateCreated datePublished" datetime="2014-08-03T01:06:00+08:00">2014-08-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/前端杂烩/观点和感想/" itemprop="url" rel="index"><span itemprop="name">观点和感想</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/08/03/interface-in-development.html" target="_blank">博客园</a>.</div>

<p>前后端分工协作是一个老生常谈的大话题，很多公司都在尝试用工程化的方式去提升前后端之间交流的效率，降低沟通成本，并且也开发了大量的工具。但是几乎没有一种方式是令双方都很满意的。事实上，也不可能让所有人都满意。根本原因还是前后端之间的交集不够大，交流的核心往往只限于接口及接口往外扩散的一部分。这也是为什么很多公司在招聘的时候希望前端人员熟练掌握一门后台语言，后端同学了解前端的相关知识。</p><br><h3>一、开发流程</h3><br><p>前端切完图，处理好接口信息，接着就是把静态demo交给后台去拼接，这是一般的流程。这种流程存在很多的缺陷。</p><br><ul><br><li>后端同学对文件进行拆分拼接的时候，由于对前端知识不熟悉，可能会搞出一堆bug，到最后又需要前端同学帮助分析原因，而前端同学又不是特别了解后端使用的模板，造成尴尬的局面。</li><br><li>如果前端没有使用统一化的文件夹结构，并且静态资源（如图片，css，js等）没有剥离出来放到 CDN，而是使用相对路径去引用，当后端同学需要对静态资源作相关配置时，又得修改各个link，script标签的src属性，容易出错。</li><br><li>接口问题<ol><br><li>后端数据没有准备好，前端需要自己模拟一套，成本高，如果后期接口有改变，自己模拟的那套数据又不行了。</li><br><li>后端数据已经开发好，接口也准备好了，本地需要代理线上数据进行测试。这里有两个费神的地方，一是需要代理，否则可能跨域，二是接口信息如果改动，后期接你项目的人需要改你的代码，麻烦。</li><br></ol></li><br><li>不方便控制输出。为了让首屏加载速度快一点，我们期望后端先吐出一点数据，剩下的才去 ajax 渲染，但让后端吐出多少数据，我们不好控。</li><br></ul><br><p>当然，存在的问题远不止上面枚举的这些，这种传统的方式实在是不酷（Kimi 附身^_^）。还有一种开发流程，SPA（single page application），前后端职责相当清晰，后端给我接口，我全部用 ajax 异步请求，这种方式，在现代浏览器中可以使用 PJAX 稍微提高体验，Facebook 早在三四年前对这种 SPA 的模式提出了一套解决方案，quickling+bigpipe，解决了 SEO 以及数据吐出过慢的问题。他的缺点也是十分明显的：</p><br><ul><br><li>页面太重，前端渲染工作量也大</li><br><li>首屏还是慢</li><br><li>前后端模板复用不了</li><br><li>SEO 依然很狗血（quickling 架构成本高）</li><br><li>history 管理麻烦</li><br></ul><br><p>问题多的已经是无力吐槽了，当然他依然有自己的优势，咱们也不能一票否决。</p><br><p>针对上面看到的问题，现在也有一些团队在尝试前后端之间加一个中间层（比如淘宝UED的 MidWay ）。这个中间层由前端来控制。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+----------------+</span><br><span class="line">|       F2E      |</span><br><span class="line">+---↑--------↑---+</span><br><span class="line">    |        |</span><br><span class="line">+---↓--------↓---+</span><br><span class="line">|     Middle     |</span><br><span class="line">+---↑--------↑---+</span><br><span class="line">    |        |</span><br><span class="line">+---↓--------↓---+</span><br><span class="line">|       R2E      |</span><br><span class="line">+----------------+</span><br></pre></td></tr></table></figure>
<p>中间层的作用就是为了更好的控制数据的输出，如果用MVC模型去分析这个接口，R2E（后端）只负责 M（数据） 这部分，Middle（中间层）处理数据的呈现（包括 V 和 C）。淘宝UED有很多类似的文章，这里不赘述。</p><br><h3>二、核心问题</h3><br><p>上面提出了在业务中看到的常见的三种模式，问题的核心就是数据交给谁去处理。数据交给后台处理，这是模式一，数据交给前端处理，这是模式二，数据交给前端分层处理，这是模式三。三种模式没有优劣之分，其使用还是得看具体场景。</p><br><p>既然都是数据的问题，数据从哪里来？这个问题又回到了接口。</p><br><ul><br><li>接口文档由谁来撰写和维护？</li><br><li>接口信息的改动如何向前后端传递？</li><br><li>如何根据接口规范拿到前后端可用的测试数据？</li><br><li>使用哪种接口？JSON，JSONP？</li><br><li>JSONP 的安全性问题如何处理？</li><br></ul><br><p>这一系列的问题一直困扰着奋战在前线的前端工程师和后端开发者。淘宝团队做了两套接口文档的维护工具，IMS以及DIP，不知道有没有对外开放，两个东西都是基于 JSON Schema 的一个尝试，各有优劣。JSON Schema 是对 JSON 的一个规范，类似我们在数据库中创建表一样，对每个字段做一些限制，这里也是一样的原理，可以对字段进行描述，设置类型，限制字段属性等。</p><br><p>接口文档这个事情，使用 JSON Schema 可以自动化生产，所以只需编写 JSON Schema 而不存在维护问题，在写好的 Schema 中多加些限制性的参数，我们就可以直接根据 Schema 生成 mock（测试） 数据。</p><br><p>mock 数据的外部调用，这倒是很好处理：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">typeof callback === &quot;function&quot; &amp;&amp; callback(&#123;</span><br><span class="line">   json: &quot;jsonContent&quot;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在请求的参数中加入 callback 参数，如 /mock/hashString?cb=callback，一般的 io(ajax) 库都对异步数据获取做了封装，我们在测试的时候使用 jsonp，回头上线，将 dataType 改成 json 就行了。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IO(&#123;</span><br><span class="line">  url: &quot;http://barretlee.com&quot;,</span><br><span class="line">  dataType: &quot;jsonp&quot;, //json</span><br><span class="line">  success: function()&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这里略微麻烦的是 POST 方法，jsonp 只能使用 get 方式插入 script 节点去请求数据，但是 POST，只能呵呵了。</p><br><p>这里的处理也有多重方式可以参考：</p><br><ul><br><li>修改 Hosts，让 mock 的域名指向开发域名</li><br><li>mock 设置 header 响应头，Access-Allow-Origin-Control</li><br></ul><br><p>对于如何拿到跨域的接口信息，我也给出几个参考方案：</p><br><ul><br><li>fiddler 替换包，好像是支持正则的，感兴趣的可以研究下（求分享研究结果，因为我没找到正则的设置位置）</li><br><li>使用 HTTPX 或者其他代理工具，原理和 fiddler 类似，不过可视化效果（体验）要好很多，毕竟人家是专门做代理用的。</li><br><li>自己写一段脚本代理，也就是本地开一个代理服务器，这里需要考虑端口的占用问题。其实我不推荐监听端口，一个比较不错的方案是本地请求全部指向一个脚本文件，然后脚本转发URL，如：<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">原始请求：http://barretlee.com/api/test.json</span><br><span class="line">在ajax请求的时候：</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">  url: &quot;http://&lt;local&gt;/api.php?path=/api/text.json&quot;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br><br><p>php中处理就比较简单啦：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(!isset($_GET[&quot;page&quot;]))&#123;</span><br><span class="line">  echo 0;</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br><span class="line">echo file_get_contents($_GET[&quot;path&quot;]);</span><br></pre></td></tr></table></figure>
<p></p></li><p></p>
<p><li>Ctrl+S,保存把线上的接口数据到本地的api文件夹吧-_-||</li><br></p></ul><p></p>
<p></p><h3>三、小结</h3><p></p>
<p>本文只是对前后端协作存在的问题和现有的几种常见模式做了简要的列举，JSON Schema 具体如何去运用，还有接口的维护问题、接口信息的获取问题没有具体阐述，这个后续有时间会整理下我对他的理解。</p>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.com/2014/07/04/2014-07-04-cb-personal-website-design-part-3/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2014/07/04/2014-07-04-cb-personal-website-design-part-3/" class="post-title-link" itemprop="https://handishenniu.com/page/16/index.html">个人网站架构设计(三) - 从设计到前端到后台</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-07-04 06:06:00" itemprop="dateCreated datePublished" datetime="2014-07-04T06:06:00+08:00">2014-07-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/07/04/personal-website-design-part-3.html" target="_blank">博客园</a>.</div>

<p>网站地址：<a href="http://barretlee.com" target="_blank" rel="noopener">http://barretlee.com</a></p><br><p>在五月份，写过两篇博客，提到了要给自己做个网站，当时人在实习，没太多的时间，只是把大概的思路捋了一番，顺道也买了个云主机（配置比较低，内存才500M）。接着返校处理毕业事宜，于是六月也随着同学之间挥泪告别的声音渐渐远去。七月，家里呆着，中旬回公司。想必这也是我近几年最长的一次假期了=。 =</p><br><h3><span>一、先说设计</span></h3><br><h4>1. 阮一峰的博客</h4><br><p>目前我的博客设计是 fork 了 BeiYuu 的主题，然后七改八改，除了主页 BeiYuu 还认得出是他的之外，其他页面已经动了很大的手术，而这些手术灵感都是源自阮一峰阮大大（我的博客地址是&lt;barretlee.com&gt;，正文部分基本是抄袭他的设计，虽然代码是我重新敲的…）。</p><br><p>阮教授自2003年开始经营他的博客ruanyifeng.com，到目前为止已有十一载，期间肯定也是改版了N次。在多次的改版之后，整个网站，结构上，几乎没有太多的冗余，内容上，更不用说，每一篇都是深入浅出、鞭辟入里，绝对可以给32个赞，想表达的内容全部十分清晰地呈现给了读者，阮大大的文字功底，我辈望尘莫及。</p><br><p>他的博客涉及面广，而且网站的设计上也是花够了心思，在观察他的博客设计时，想到了一些问题。</p><br><ul><br><li>读者进入页面，他最关注的是什么？</li><br><li>通过什么方式来突出文章的重点和亮点？</li><br><li>网站主页展示哪些元素？</li><br><li>如何去表述一个比较新的技术点或者观点？</li><br></ul><br><p>自己的鄙见我就不发表了，不过上面提到的几个问题都是值得去思考的。</p><br><h4>2. 张鑫旭的博客</h4><br><p>张鑫旭大哥，也是通过博客认识的，后来才发现，我与他同是华中科技大学[校友]，再后来又发现，我竟然与他是同一个技术团队（学校&middot;网络应用研发中心）的成员[队友]，再后来还发现，我竟然早就跟他在同一个群里[朋友]。</p><br><p>很多人提到张鑫旭的博客，都说\就是那个喜欢张含韵的人的博客啦”，我倒是问过他，他说测试图片前几张正好是张含韵，顺手选中拿出来。。他的博客也是十分有特色的：</p><br><ul><br><li>专注点很集中 - 前端，而且是小而美的研究，很赞</li><br><li>文风 - 很能扯淡，喜欢的人竖拇指，不喜欢的人觉得罗里吧嗦</li><br></ul><br><p>思考的两个问题：</p><br><ul><br><li>如何让别人一眼发现，\哦，这是那个xxx的博客”？</li><br><li>博客先是记录自己，然后变成服务他人。</li><br></ul><br><h4>3. 简书</h4><br><p>简书的口号就是\找回文字的力量”，我不太喜欢文字（基本没看过小说），所以没有仔细品味简书里面的东西，但却对他网站视觉的设计很感兴趣。简洁大方，有书的味道，整个体验很有质感。</p><br><p>我是个程序猿，不算射鸡湿。如果文章呈现的内容太多，我会hold不住整体的布局，所以会比较中意简洁的设计，简洁的另一个好处就是突出正文，内容很直观的被呈现出来。</p><br><p>以上我列举了三个网站，不用想，肯定又会去抄他们了，囧。。。但其实我参考的网站有十几个，把十几个网站（我觉得）突出的地方整合进了自己的设计，请不要喷我这个不懂设计的程序猿。</p><br><h3>二、从设计到前端实现</h3><br><p>正常的流程是设计-&gt;设计稿-&gt;切图，我跳过了设计稿，直接开始敲代码，貌似自己对代码的亲切度比PSD图片更高（所以为什么总说撸代码呢…）。</p><br><p>设计很简单，故意弱化设计以强化内容，希望能够取长补短。</p><br><h4>1. 正文的设计与实现</h4><br><p>正文的设计参考了简书，但是简书是一个以文字为中心的网站，图片都很少出现。而对于一个博客来说，有几个元素十分重要：代码、引用块、图片、表格、list列表等等。所以这些元素的展示要自己来设计。</p><br><p>细节上的东西，只要进入网站就能看到，所以在这里就不赘述太多。代码的高亮使用的是 prettify 的 light 主题，对它做了微调。</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/07/04/041833036684651.jpg" data-source="http://images.cnitblog.com/i/387325/201407/041833036684651.jpg" alt=""></p><br><p>代码块滚动条的样式也修改了下：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pre::-webkit-scrollbar &#123;width:10px;height:10px;background:#F6F6F6;border-top:1px solid #CCC;padding-top:1px;&#125;</span><br><span class="line">pre::-webkit-scrollbar-thumb &#123;background:#EEE;border-radius:5px;border:1px solid #CCC;border-bottom:0px;&#125;</span><br><span class="line">pre::-webkit-scrollbar-thumb:hover &#123;background:#DDD;&#125;</span><br><span class="line">pre::-webkit-scrollbar &#123;width:10px;height:10px;background:#CCC;&#125;</span><br><span class="line">pre::-webkit-scrollbar-thumb &#123;background:#999;border-radius:5px;&#125;</span><br><span class="line">pre::-webkit-scrollbar-thumb:hover &#123;background:#666;&#125;</span><br><span class="line">pre::-webkit-scrollbar-corner &#123;background:#CCC;&#125;</span><br><span class="line">pre::-webkit-color-swatch &#123;border:none;&#125;</span><br></pre></td></tr></table></figure>
<p>效果是这样的：</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/07/04/041833144027230.jpg" data-source="http://images.cnitblog.com/i/387325/201407/041833144027230.jpg" alt=""></p><br><p>整个设计都是扁平化，没有圆角，看起来感觉还算舒服，下面是引用块的样式呈现：</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/07/04/041833217461008.jpg" data-source="http://images.cnitblog.com/i/387325/201407/041833217461008.jpg" alt=""></p><br><p>由于一些代码是可以直接运行的，所以也给可运行代码加上了一个运行的 button：</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/07/04/041833297309613.jpg" data-source="http://images.cnitblog.com/i/387325/201407/041833297309613.jpg" alt=""></p><br><p>在IE下，是使用一个 about:blank 的空白页打开代码文件，如果浏览器支持 blob 流，将会使用 blob 流打开：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (!operation.isIE()) &#123;</span><br><span class="line">    window.open(URL.createObjectURL(new Blob([code], &#123;</span><br><span class="line">        type: &quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    &#125;)));</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    var d = window.open(&quot;about:blank&quot;).document;</span><br><span class="line">    d.write(code);</span><br><span class="line">    d.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><h4>2. 侧边栏的设计与实现</h4><p></p>
<p><strong>1) 侧边栏-未展开</strong></p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/07/04/041800594809334.jpg" data-source="http://images.cnitblog.com/i/387325/201407/041800594809334.jpg" alt=""></p><br><p>从上图可以看到，侧边栏都是一些功能按钮，从上往下依次是：显示隐藏文章目录，页面主题和字体设置，关于作者，反馈信息，RSS订阅。</p><br><p><span>为啥要搞个侧边栏，还放那么多的功能按钮？就拿司徒正美的博客来说，我在群里吐槽了他博客风格好几次（被骂回来了…理由是每个人审美观不一样），你可以去瞅瞅他的页面，代码字体实在是太小了，每次看他的博客都会把字号和行高调大一点，后来直接写个脚本放在收藏夹，进入他的网页一键处理。</span></p><br><p>这个例子说明，每个人的口味不一样。一个网站，倘若冷暖色调，字体大小等可以自定义的话就更棒了，我没做那么复杂，就是给文章加了个黑色主题。</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/07/04/041801196217820.jpg" data-source="http://images.cnitblog.com/i/387325/201407/041801196217820.jpg" alt=""></p><br><p>通过这个按钮可以进行相应的设置。然后是侧边栏下面的几个按钮：</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/07/04/041801255273825.jpg" data-source="http://images.cnitblog.com/i/387325/201407/041801255273825.jpg" alt=""></p><br><p>\跟我对话”点击之后会在右下角往上蹦出一个浮层：</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/07/04/041801309658987.jpg" data-source="http://images.cnitblog.com/i/387325/201407/041801309658987.jpg" alt=""></p><br><p>这个浮层是可拖动的。</p><br><p><strong>2) 侧边栏-展开</strong></p><br><p>做了个未展开的侧边栏其实也差不多了，后来发现我的页面中好像并没有\文章归档”，\最新文章”，\最近评论”等这些对一个博客来说很常见的元素，于是乎，抄袭了下豆瓣FM的设计，弄了下面的东西：</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/07/04/041801372622578.jpg" data-source="http://images.cnitblog.com/i/387325/201407/041801372622578.jpg" alt=""></p><br><p>这块效果还挺难做的，主要是滚动不好处理。左侧是一个 fixed 定位，容器的高度是死的，也就是 <code>$(window).height()</code> 的高度，blabla.. 细节我不说了，如果你感兴趣可以去思考下如何实现类似豆瓣FM左侧的功能块。我后来是监听鼠标滚动设置负margi-top值来模拟页面滚动。并且这个监听是在整个 document 而不是仅仅是 左侧的 box 上。</p><br><p>整体效果实现并不复杂，麻烦的是一些细节处理。</p><br><h4>2. 底部的设计与实现</h4><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/07/04/041801445126326.jpg" data-source="http://images.cnitblog.com/i/387325/201407/041801445126326.jpg" alt=""></p><br><p>底部的设计我最纠结的是内容，到底放点什么东西。跟文章相关度最高的，一是相关文章，二是评论，所以也就只把这两样放上了。</p><br><h3>三、后台设计和数据库</h3><br><p>开始想过后台用 wordpress 或者其他的框架系统来构建，但是这些东西提供的接口比较冗余，而且功能复杂，没有全盘研究过他们的源码，最后决定自己写一套后端框架以及前后端接口，工作量立马就上去了… 我也是想趁此机会回顾下 php 和 mysql 的知识，太久不用都生疏了。</p><br><h4>1. 旧博客写入数据库</h4><br><p>以前的博客都是使用 Markdown 语法写的，Markdown 的优点就是简洁清晰，但是在解析的时候总是会有这样那样的问题，并且很多 Markdown 解析工具都不支持给元素添加 id 或者 class，这让人很纠结。所以存入数据的文章已经解析成 HTML 了。</p><br><p>Github pages 支持 jekyll 语法，jekyll 允许使用 Markdown，使用 jekyll 语法写的文章内容中多了很多 <code></code></p><br><p>对头部的解析也没啥好办法，就是使用正则来匹配：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$html = file_get_contents($path);</span><br><span class="line">$reg = &quot;/---\n\s*layout:\s*[\s\S]+?\ntitle:\s*(?&lt;title&gt;[\s\S]+?)\n&quot;</span><br><span class="line">  . &quot;description:\s*(?&lt;description&gt;[\s\S]+?)\ncategory:\s*&quot;</span><br><span class="line">  . &quot;(?&lt;category&gt;[\s\S]+?)\n(tags:\s*(?&lt;tags&gt;[\s\S]+?)\n)?---\n(?&lt;content&gt;[\s\S]+)/&quot;;</span><br><span class="line"></span><br><span class="line">preg_match_all($reg, $html, $match);</span><br></pre></td></tr></table></figure>
<p></p>
<p>由于文章并没有集中放在一个文件夹，写了个遍历文件夹的 travel 函数：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function traverse($path = &apos;.&apos;) &#123;</span><br><span class="line">    $current_dir = opendir($path);</span><br><span class="line">    while(($file = readdir($current_dir)) !== false) &#123;</span><br><span class="line">        $sub_dir = $path . DIRECTORY_SEPARATOR . $file;</span><br><span class="line">        if($file == &apos;.&apos; || $file == &apos;..&apos;) &#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125; else if(is_dir($sub_dir)) &#123;</span><br><span class="line">            //echo &apos;Directory &apos; . $file . &apos;:&lt;br&gt;&apos;;</span><br><span class="line">            traverse($sub_dir);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //echo &apos;File in Directory &apos; . $path . &apos;: &apos; . $file . &apos;&lt;br&gt;&apos;;</span><br><span class="line">            dealFile($path . DIRECTORY_SEPARATOR . $file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里需要注意的是，存入数据库之前要处理一些单双引号/UTF-16字符，否则存入的时候会出错。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function remSpecialChars($string) &#123;</span><br><span class="line">    $string = stripslashes($string);</span><br><span class="line">    $string = preg_replace(&quot;/&apos;/&quot;,&quot;&lt;#039;&quot;,$string);</span><br><span class="line">    $string = preg_replace(&apos;/&quot;/&apos;,&apos;&lt;quot;&apos;,$string);</span><br><span class="line">    return $string;</span><br></pre></td></tr></table></figure>
<p>取出的时候还原单双引号：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function addSpecialChars($string) &#123;</span><br><span class="line">    //  $string = htmlspecialchars($string);</span><br><span class="line">    $string = preg_replace(&quot;/&lt;#039;/&quot;,&quot;&apos;&quot;,$string);</span><br><span class="line">    $string = preg_replace(&apos;/&lt;quot;/&apos;,&apos;&quot;&apos;,$string);</span><br><span class="line">    return $string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><h4>2. 网页各个模块的处理</h4><p></p>
<p>网页中，正文、底部和边栏需要数据，所以数据的查询主要是针对这三块。</p><br><p><span>目前这三块数据是后台直接同时输出的，稍微想想就知道这个效率并不高，后续肯定会改成异步接口。封装之后，获取并渲染一篇文章就变得异常轻松了：</span></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">include &apos;page.class.php&apos;;</span><br><span class="line"></span><br><span class="line">$page = new PageInitor();</span><br><span class="line"></span><br><span class="line"># 正文内容</span><br><span class="line">$post = $page-&gt;getPageByTitleEn($_GET[&apos;title&apos;]);</span><br><span class="line"># 底部和侧边内容</span><br><span class="line">$otherData = $page-&gt;getPostOtherData();</span><br></pre></td></tr></table></figure>
<p>后台数据的渲染都是：</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/07/04/041859003714166.jpg" data-source="http://images.cnitblog.com/i/387325/201407/041859003714166.jpg" alt=""></p><br><p>如果改成前端异步获取，那前端又得写一套模板渲染数据，这里感觉流程上存在冗余，后期肯定会改进。</p><br><h4>3. 内容的解析</h4><br><p>文章内容的编写还是使用Markdown，尽管他在某些地方不能满足我的需求。内容的解析使用的是 michelf 的 php-markdown 开源框架：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$cotent = file_get_contents($path);</span><br><span class="line">$html = Markdown::defaultTransform($content);</span><br></pre></td></tr></table></figure>
<p>使用起来也是十分方便，但是上面的函数只能解析一些基础的 Markdown 格式，诸如图片、表格等解析不出来。这需要引入：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Get Markdown class</span><br><span class="line">use \Michelf\Markdown;</span><br><span class="line">use \Michelf\MarkdownExtra;</span><br><span class="line"></span><br><span class="line"># 然后使用</span><br><span class="line">MarkdownExtra::defaultTransform($content)</span><br></pre></td></tr></table></figure>
<p>使用 MarkdownExtra 的类来解析， MarkdownExtra 是继承 <code>\Michelf_MarkdownExtra_TmpImpl</code> 的。</p><br><h3>四、服务器的设置和维护</h3><br><p>目前使用 apache 作为服务器已经够用了，需要缓存的页面也并不多，就是几个列表页和搜索页，所以这方面可以采用技术成熟的 memcache 来处理，只不过后期在同一台服务器上会搭建多个网站，每个网站对应的域名不一样，并且有些网站的后台会使用 nodeJS 来编写，所以还是需要 Nginx 来配置 Virtual Host，Apache 也可以实现 Vhost 的配置，我在本地测试的时候就是使用的 apache 的 Vhost，这里也简单说说 vhost 的配置。</p><br><h4>1. apache 的 vhost 配置</h4><br><p>配置步骤如下：</p><br><ol><br><li>在 httpd.conf 中开启 vhost 模块，并 include 其配置文件 httpd-vhosts.conf</li><br><li>在 httpd-vhosts.conf 写入</li><br></ol><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 这是配置 localhost 这个&quot;域名&quot;</span><br><span class="line">&lt;virtualhost *:80=&quot;&quot;&gt;</span><br><span class="line">    ServerAdmin i@localhost</span><br><span class="line">    DocumentRoot &quot;E:/wamp/www&quot;</span><br><span class="line">    ServerName localhost</span><br><span class="line">    ServerAlias localhost</span><br><span class="line">    ErrorLog &quot;logs/localhost.log&quot;</span><br><span class="line">    CustomLog &quot;logs/localhost-access.log&quot; common</span><br><span class="line">&lt;/virtualhost&gt;</span><br><span class="line"></span><br><span class="line"># 这是配置 test.barretlee.com 这个域名</span><br><span class="line">&lt;virtualhost *:80=&quot;&quot;&gt;</span><br><span class="line">    ServerAdmin test@barretlee.com</span><br><span class="line">    DocumentRoot &quot;E:/wamp/www/barretlee&quot;</span><br><span class="line">    ServerName test.barretlee.com</span><br><span class="line">    ErrorLog &quot;logs/test.barretlee.com-error.log&quot;</span><br><span class="line">    CustomLog &quot;logs/test.barretlee.com-access.log&quot; common</span><br><span class="line">&lt;/virtualhost&gt;</span><br></pre></td></tr></table></figure><br><br><p>因为网上对这方面的配置有详细说明，我也不是行家，就不细说了。</p><br><h4>2. Rewrite模块</h4><br><p>其实就是网页的静态化，我们看到的php页面是：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?id=23</span><br></pre></td></tr></table></figure>
<p>但是我们更希望通过这种方式来获取页面：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php/23</span><br></pre></td></tr></table></figure>
<p>URL 需要进行重写，算是内部重定向吧。这方面的工作可以交给 Nginx 来处理，也可以交给 Apache，由于我本地目前还只配置了 Apache，所以先看看 Apache 的配置方式：</p><br><p><strong>1) 使用了Vhost</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;virtualhost *:80=&quot;&quot;&gt;</span><br><span class="line">    ServerAdmin test@barretlee.com</span><br><span class="line">    DocumentRoot &quot;E:/wamp/www/barretlee&quot;</span><br><span class="line">    ServerName test.barretlee.com</span><br><span class="line">    ErrorLog &quot;logs/test.barretlee.com-error.log&quot;</span><br><span class="line">    CustomLog &quot;logs/test.barretlee.com-access.log&quot; common</span><br><span class="line"></span><br><span class="line">    &lt;directory e:\wamp\www\barretlee=&quot;&quot;&gt;</span><br><span class="line">        Options FollowSymLinks</span><br><span class="line">        AllowOverride None</span><br><span class="line">        Order deny,allow</span><br><span class="line">        Allow from all</span><br><span class="line"></span><br><span class="line">        RewriteEngine on</span><br><span class="line">        RewriteRule ^blog/(\d+)/(\d+)/(.*).html$ index.php?title=$3&lt;year=$1&lt;month=$2</span><br><span class="line">        RewriteRule ^static/(.*)$ static/$1</span><br><span class="line">    &lt;/directory&gt;</span><br><span class="line">&lt;/virtualhost&gt;</span><br></pre></td></tr></table></figure>
<p>如果使用了 Vhost，可以在配置里写上 <code>RewriteEngine on</code>，然后加上需要的 RewriteRule 规则就行了。</p><br><p><strong>2) 没有使用 Vhost</strong></p><br><p>在网页所在文件的根目录下，新建一个 <code>.htaccess</code> 文件，里头写上：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RewriteEngine on</span><br><span class="line">RewriteBase /barretlee</span><br><span class="line">RewriteRule ^blog/(\d+)/(\d+)/(.*).html$ index.php?title=$3&lt;year=$1&lt;month=$2</span><br><span class="line">RewriteRule ^static/(.*)$ static/$1</span><br></pre></td></tr></table></figure>
<p>重定向的内容就行了。</p><br><p>第二种方式会存在一个问题，如果你的资源请求在 /barretlee 的上一层或者上几层，那么这里的正则就会匹配不到了，所以建议使用 Vhost 来配置自己的 Apache。</p><br><h3>五、后期优化和改进</h3><br><p>上面说了这么多，都是这七天来建站的总结，目前的状态是，博客系统已经搭建完毕，但是没有写博客和管理博客的后台，这又是件头疼的事情，不过还好，后台之后自己看得见，就随意一些。也没有归档页面、分类页等页面，这些页面的设计也是伤脑细胞的。</p><br><p>整个网站，博客系统只是一个部分，还有其他的问答平台、好文的爬虫抓取、每月期刊、每周好文推送、邮件系统等等，工程量还蛮大，这对我来说也是一个挑战，可以尽情发挥自己的技能，也是个深度学习的好机会！</p><br><p>页面的加载，首屏时间不能忍受，如果文章篇幅比较大，大约需要1.5到3s才渲染完毕，这个值有点不能忍受。优化方向有：</p><br><ul><br><li>PJAX，页面采用 pushState + AJAX，减少请求，不支持 pushState 的页面采用 hash bang 兼容处理。</li><br><li>bigPipe，如果文章内容比较多，或者其他的模块有所增加，会采用 bigPipe 分拨往前端扔数据。</li><br><li>前后端统一模板，之前也提到了这个问题，后端渲染的时候使用的后端模板，如果前端要异步加载，则需要重新写一套模板来解析合并数据，这两个模板的相似度是很高的，如果可以复用将减少很多工作量。</li><br><li>静态数据的缓存问题</li><br><li>ETag等对页面的标记缓存问题</li><br></ul><br><h3>六、小结</h3><br><p>我最怕的是事情没有一个开始，现在既然已经开始了，我想，离结束也就不远了。</p>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.com/2014/05/15/2014-05-15-cb-personal-website-design-part-2/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2014/05/15/2014-05-15-cb-personal-website-design-part-2/" class="post-title-link" itemprop="https://handishenniu.com/page/16/index.html">个人网站架构设计(二)</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-05-15 01:32:00" itemprop="dateCreated datePublished" datetime="2014-05-15T01:32:00+08:00">2014-05-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/05/15/personal-website-design-part-2.html" target="_blank">博客园</a>.</div>

<p>网站地址：<a href="http://barretlee.com" target="_blank" rel="noopener">http://barretlee.com</a></p><br><p>昨天对网站的架构做了一个简要的分析，有些人不太理解，有了 NodeJS 还要 php 干啥？我推荐了几篇文章给这位童鞋看了：</p><br><ul><br><li><a href="http://ued.taobao.org/blog/2014/04/full-stack-development-with-nodejs/" target="_blank">也谈基于NodeJS的全栈式开发（基于NodeJS的前后端分离）</a></li><br><li><a href="http://ued.taobao.org/blog/2014/04/xtpl/" target="_blank">基于前后端分离的模版探索</a></li><br><li><a href="http://ued.taobao.org/blog/2014/04/modelproxy/" target="_blank">Midway-ModelProxy &mdash; 轻量级的接口配置建模框架</a></li><br><li><a href="http://ued.taobao.org/blog/2014/05/midway-security/" target="_blank">前后端分离模式下的安全解决方案</a></li><br><li><a href="//github.com/lifesinger/lifesinger.github.com/issues/184" target="_blank">Web 研发模式演变</a></li><br></ul><br><p>如果是一个很小的网站，是用那么多层来处理请求和响应，确实是冗余的，不过我打算将这个网站设计成一个实时平台，这个平台中包含了很多很多的通信模块，所有后端选用 NodeJS 作为 I/O 处理器，这是可以理解的。php 用于通信，连接消耗大，而且不方便并行处理，效率很低。在网络通信和I/O处理上，NodeJS是很优秀的工具。</p><br><h3>1. 小小网站，为啥我要如此看重后端</h3><br><p>其实最主要的原因是，我买的主机配置很低。呵呵，是的，昨天很多朋友在留言里都提到了购买云主机/VPS相关的东西。今天我也是花了不少时间在各个群里请教，并且也访问、对比了一些云主机供应商的网站。之前在 V2ex 上看到了不少相关的帖子，今天进去翻，没翻到之前点过赞的贴。过程就不多说了，开始打算买个国外的主机，不用备案~ 后来嫌麻烦，买了个阿里云服务器：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CPU： 1核</span><br><span class="line">内存： 512MB</span><br><span class="line">数据盘： 40G</span><br><span class="line">带宽： 1Mbps</span><br></pre></td></tr></table></figure>
<p>买一年省俩月的钱，总共是七百多。选用的 Ubuntu 12.04, 64位系统。不过呢，我并没有一次性买一年的，先花几十块钱买了一个月，试用，反正以后续费还是原价（不像域名那样坑爹，续费就涨价）。域名我是一次性买的十年的，55/年，这东西不贵，多买几年，省事儿。然后进入阿里云的流程，正在备案中…</p><br><p>回到重点，为啥看重后端，看到上面的配置，相比大家也知道了，搞一个实时通信的网站，每个连接后端都需要内存来处理，而且这个内存在链接断开之前是不会释放的（socket连接），目测同时在线超过30个人，系统就要卡住了。内存是一个很大的瓶颈，然后就是带宽了，1M真的很低。其实买个配置高点的主机，一年也就一两千，这次故意买个最低配置是为了让自己培养珍惜流量意识，希望编程可以考虑到每个 byte 的消耗，等这种意识（或者技术）养成了，再提高主机的配置。</p><br><p>第二个原因就是熟悉后端，数据库方面的处理一直是自己的弱项，如果不试着提高下，以后工作中遇到坎就会很难受了。这段时间在阿里实习，经常会感觉有些知识不够用了，希望返校继续加强学习。</p><br><h3>2. 前端也是重点</h3><br><p>前端有一个很大胆的尝试，\数据在前端”。</p><br><p>打开一个网页，浏览器发送请求到服务器，服务器从数据库里获取数据，经过后台脚本的拼装处理，然后输出到前端，这是最常见的方式。这种方式的缺点就是，频繁的读取数据库，然后还有一大堆经过HTML标签包装过的数据传到前端，期间的冗余消耗是特别大的。于是有人就想到了，后端的数据全部使用JSON方式输出，到了前端再渲染数据，这种方式获得了一定的优化效果，前端端的分离似乎也很明显，但是前端负担就太重了，数据的处理和渲染都是前台，也就是承担了Controller和Views的角色，前台很累，他累了也会发脾气，比如：数据到了，要半天之后才解析完毕，再花半天将其渲染出来。同时这种处理方式也不利于SEO。</p><br><p>现在的尝试是，前端就是一个数据库，每个用户都有数据库数据的一个备份。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">                    +----------+</span><br><span class="line">                    |          |</span><br><span class="line">                    | Database |</span><br><span class="line">                    |          |</span><br><span class="line">                    +-----|----+</span><br><span class="line">                          |</span><br><span class="line">                +---------|----------+</span><br><span class="line">               /|                    |\</span><br><span class="line">              / |       Server       | \</span><br><span class="line">             /  |                    |  \</span><br><span class="line">            /   +----|----------|----+   \</span><br><span class="line">           /         |          |         \</span><br><span class="line">+---------/+  +------|---+  +---|------+  +\---------+</span><br><span class="line">|          |  |          |  |          |  |          |</span><br><span class="line">|  Client  |..|  Client  |..|  Client  |..|  Client  |</span><br><span class="line">|          |  |          |  |          |  |          |</span><br><span class="line">+-----|----+  +-----|----+  +-----|----+  +-----|----+</span><br><span class="line">      |             |             |             |</span><br><span class="line">+-----|----+  +-----|----+  +-----|----+  +-----|----+</span><br><span class="line">|          |  |          |  |          |  |          |</span><br><span class="line">|  Local   |  |  Local   |  |  Local   |  |  Local   |</span><br><span class="line">| Storage  |  | Storage  |  | Storage  |  | Storage  |</span><br><span class="line">|          |  |          |  |          |  |          |</span><br><span class="line">+----------+  +----------+  +----------+  +----------+</span><br></pre></td></tr></table></figure>
<p>浏览器每次连接到服务器，都会将服务器的数据同步到本地，打开页面，第一件事是呈现当前LocalStorage的数据，然后发送一个请求询问服务器，\是否有数据更新啊？”，每次只拉去更新的数据。</p><br><p>有人会觉得这种方式不可取，本地存不了这么多东西啊。当然存不了这么多，一篇文章有作者、标题、日期、概要还有内容，我们可以在本地储存除内容之外的所有东西，就算有100篇文章，其缓存的量也不过几百KB，试想你加载个 JQ 是不是也得上百KB啊~那么每次我们从后端拉取的数据量就十分小了。</p><br><p>至于本地储存的实现方式，这个好处理，LocalStorage、IndexDB、UserData等等，方式很多，还有一些其他比较 hack 的方式，我以后再介绍。</p><br><h3>3. 前后端之间的屏障</h3><br><p>后端会有很多的服务，比如邮件、HTTP、HTTPS、socket等等，再比如：A域名、B域名、A子域名、B子域名的处理等等。为了处理伪静态，安全，缓存，动静页面分离等多个问题，决定在昨天考虑的架构上再加一层 Nginx。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    +------------------+     +------------------+</span><br><span class="line">    | Front-End        |     | Browser          |</span><br><span class="line">    |     前端处理      |     +--------------+   |</span><br><span class="line">    |                  |←---→| LocalStorage |   |</span><br><span class="line">    +--↑-----↑-----↑---+     +--------------+---+</span><br><span class="line">       |     |     |</span><br><span class="line">       |     |     |</span><br><span class="line">       |     |     |</span><br><span class="line">    +------------------+</span><br><span class="line">    | Nginx            |</span><br><span class="line">+----     请求/代理    ---------------------------+</span><br><span class="line">|   |                  |                         |</span><br><span class="line">|   +------------------+                         |</span><br><span class="line">|      |     |     |                             |</span><br><span class="line">|      |     |     |                             |</span><br><span class="line">|   +--↓-----↓-----↓---+                         |</span><br><span class="line">|   | NodeJS           |     +-------------+     |</span><br><span class="line">+--&gt;|     处理I/O       |     | Database    |     |</span><br><span class="line">|   |                  |←-+-→|             |     |</span><br><span class="line">|   +-----|-----↑------+  |  |             |     |</span><br><span class="line">|         |     |         |  |             |     |</span><br><span class="line">|   +-----↓-----|------+  |  +----------+  |     |</span><br><span class="line">|   | PHP              |  |  |          |  |     |</span><br><span class="line">+--&gt;|     处理数据      |←-+-→|   cache  |  |     |</span><br><span class="line">|   |                  |     |          |  |     |</span><br><span class="line">|   +------------------+     +----------+--+     |</span><br><span class="line">|                                                |</span><br><span class="line">+------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>东西越多，维护成本越高，不过我竟然觉得添加一层会有更多的乐趣…</p><br><p>后续会继续记录建站过程。</p>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.com/2014/05/11/2014-05-11-cb-etag-in-node/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2014/05/11/2014-05-11-cb-etag-in-node/" class="post-title-link" itemprop="https://handishenniu.com/page/16/index.html">Etag缓存在PHP和NodeJS中的实现</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-05-11 07:26:00" itemprop="dateCreated datePublished" datetime="2014-05-11T07:26:00+08:00">2014-05-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/前端杂烩/网络交互/" itemprop="url" rel="index"><span itemprop="name">网络交互</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/05/11/etag-in-node.html" target="_blank">博客园</a>.</div>

<p>HTTP 提供了许多页面缓存的方案，其中属 Etag 和 Last-Modified 应用最广。本文会先介绍 Etag 的应用场景，然后说说他在 php 和 node 中的使用。</p><br><h3>一、Etag的使用</h3><br><p>客户端和浏览器之间的交互：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+---------+       1         +---------+</span><br><span class="line">|         |----------------&gt;|         |</span><br><span class="line">|         |   2（200，OK）   |         |</span><br><span class="line">|         |&lt;----------------|         |</span><br><span class="line">|    客   |    3（Etag）     |    服   |</span><br><span class="line">|         |----------------&gt;|         |</span><br><span class="line">|    户   |    4（304）      |    务   |</span><br><span class="line">|         |&lt;----------------|         |</span><br><span class="line">|    端   |    3（强制刷新）  |    端   |</span><br><span class="line">|         |----------------&gt;|         |</span><br><span class="line">|         |   6（200，OK）   |         |</span><br><span class="line">|         |&lt;----------------|         |</span><br><span class="line">+---------+                 +---------+</span><br><span class="line">                &lt;Created By Barret Lee&gt;</span><br></pre></td></tr></table></figure>
<p>1. 客户端向服务器请求资源S</p><br><p>2. 服务器返回数据，并带上一个 Etag</p><br><p>3. 客户端再次请求资源S，由于上次服务器给他返回了一个 Etag，这次请求的时候他会带上这个 Etag</p><br><p>4. 服务器发现请求中包含 Etag，判断是否过期，没过期则返回 304 Not Modified</p><br><p>5. 客户端强制刷新（如chrome中ctrl+shift+R刷新页面），请求中剔除 Etag</p><br><p>6. 服务器未发现请求中包含 Etag，返回资源S，并带上一个 Etag</p><br><h3>二、代码实现</h3><br><p>第一次请求数据：</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/05/11/111923172133405.jpg" data-source="http://images.cnitblog.com/i/387325/201405/111923172133405.jpg" alt=""></p><br><p>浏览器在接受到服务器发过来的 Etag 后，会保存下来，下次请求的时候会将它放在请求头中，其 key 值为 If-None-Match。</p><br><p><img src="//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png" data-original="/blogimgs/2014/05/11/111923246041196.jpg" data-source="http://images.cnitblog.com/i/387325/201405/111923246041196.jpg" alt=""></p><br><p>服务器拿到 If-None-Match 之后，对比之前的 Etag，如果没变，则返回 304 Not Modified.</p><br><h4>1. php 中的 Etag</h4><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $str = &quot;Barret Lee&quot;;</span><br><span class="line">    $Etag = md5($str);</span><br><span class="line"></span><br><span class="line">    if(array_key_exists(&apos;HTTP_IF_NONE_MATCH&apos;, $_SERVER) and $_SERVER[&apos;HTTP_IF_NONE_MATCH&apos;] == $Etag)&#123;</span><br><span class="line">        header(&quot;HTTP/1.1 304 Not Modified&quot;);</span><br><span class="line">        exit();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        header(&quot;Etag:&quot; . $Etag);</span><br><span class="line">        echo $str;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><br><br><p>Etag 是一个字符串，我们一般使用该请求对应响应输出的 md5 值作为 Etag，可以简单地理解为文件的版本号。在 php 中存在两个获取 md5 的函数，一个是针对字符串的，就是 <code>md5()</code>，然后就是针对文件的， <code>md5_file()</code>。</p><br><p>首先判断在请求中是否包含 ‘HTTP_IF_NONE_MATCH’ 这个 key，如果包含并且其值为之前的 md5 值，则返回 304，否则输出 Etag 以及内容。</p><br><h4>2. node 中的 Etag</h4><br><p>与 php 有些不同，从 $_SERVER 中拿到的内容是经过 apache 包装过的，而 node 获取的数据是最原始的。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var hashStr = &quot;A hash string.&quot;;</span><br><span class="line">var hash = require(&quot;crypto&quot;).createHash(&apos;sha1&apos;).update(hashStr).digest(&apos;base64&apos;);</span><br><span class="line"></span><br><span class="line">require(&quot;http&quot;).createServer(function(req, res)&#123;</span><br><span class="line">    if(req.headers[&apos;if-none-match&apos;] == hash)&#123;</span><br><span class="line">        res.writeHead(304);</span><br><span class="line">        res.end();</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    res.writeHead(200, &#123;</span><br><span class="line">        &quot;Etag&quot;: hash</span><br><span class="line">    &#125;)</span><br><span class="line">    res.write(hashStr);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;).listen(9999);</span><br></pre></td></tr></table></figure>
<p>上面对 hashStr（输出的内容） 进行了简单的处理，并将其作为 Etag 放在 head 中输出，上面的代码一目了然，我就不解释了。</p><br><h3>三、小结</h3><br><p>Etag 在缓存处理中用的比较广泛，使用它可以减少一些不必要请求的带宽的占用。服务器输出的内容不变，浏览器就应该使用缓存，没必要每次都向服务器端索要数据，造成不必要的浪费。</p><br><p>从上面我们可以看到，如果想拿到 Etag，就必须先拿到要输出的数据，所以 Etag 只能减少带宽的占用，并不能降低服务器的消耗。如果是静态页面，可以判断文件最近一次的修改时间（Last-Modified），获取文件上次修改时间的消耗比拿到整个数据的消耗要小的多。所以很多时候 Etag 都是配合这 Last-Modified 一起使用的。</p><br><p>上面的 php 和 node 代码演示，很明显的差异就是，node 更加细致，或者说他更加底层，我们可以获取的几乎都是未加修饰的原始数据，从数据量的交互和可操控性来看，我更偏向于 node 的使用。</p>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.com/2014/05/07/2014-05-07-cb-git-improve/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2014/05/07/2014-05-07-cb-git-improve/" class="post-title-link" itemprop="https://handishenniu.com/page/16/index.html">git版本管理策略及相关技巧(A)</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-05-07 09:00:00" itemprop="dateCreated datePublished" datetime="2014-05-07T09:00:00+08:00">2014-05-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/05/07/git-improve.html" target="_blank">博客园</a>.</div>

<p><span>公司几乎所有的项目都是使用 git 仓库来管理代码，以前对 git 只有些肤浅的了解，每次提交代码或者上线的时候总是会提心吊胆，生怕出现一些未知的问题。经过三个月的踩坑和填坑， git 操作颇显成熟。仅以此文回忆学习 git 的历史。</span></p><br><h3>一、基本操作</h3><br><h4>1. 克隆代码</h4><br><p><strong>1.1 添加仓库</strong></p><br><p>最直接的方式：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd dir  # 这里不用新建一个项目名的文件夹，dir为git文件夹的父文件夹</span><br><span class="line">git clone //github.com/barretlee/Micro-Share</span><br></pre></td></tr></table></figure>
<p>你也可以进入一个目录，然后初始化（init）：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd path/to/Project</span><br><span class="line">git init</span><br><span class="line"># 添加远程目录</span><br><span class="line">git remote add origin //github.com/barretlee/Micro-Share</span><br></pre></td></tr></table></figure>
<p>这些都是最基本的了，上面的 remote add 是添加一个远程目录，你也可以添加多个远程目录，什么情况下会添加多个呢？比如：我想把别人的代码处理之后放到自己的 git 仓库上去,</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin //github.com/barretlee/Micro-Share</span><br><span class="line">git remote add mine http://your/path/to/git</span><br><span class="line"># 拉取远程代码到 init 之后的 master 主干上</span><br><span class="line">git fetch origin master</span><br><span class="line"># 修改代码之后，提交到自己的仓库</span><br><span class="line">git commit -am &quot;fist&quot;</span><br><span class="line">git push -u mine master</span><br></pre></td></tr></table></figure>
<p><strong>1.2 添加文件</strong></p><br><p>在提交文件之前首先要添加文件到分支中，很多人只知道：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure>
<p>如果有文件删除，会发现这些删除的文件并没有被附加进去，肿么办？</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#方式一</span><br><span class="line">git add --all .</span><br><span class="line">#方式二</span><br><span class="line">git add -A .</span><br></pre></td></tr></table></figure>
<p><ul></ul></p>
<p><li><code>–all</code> 参数，顾名思义，添加所有文件（change|delete|add）</li></p>
<p><li><code>-A</code> 参数，添加修改过和删除过的文件（change|delete）</li></p>
<p><li>不加 参数，添加修改过和添加的文件（change|add）</li><br></p>
<p><strong>1.3 提交文件</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &quot;comment&quot;</span><br></pre></td></tr></table></figure>
<p>如果没有删除过文件，可以合并添加和提交文件为一步：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -am &quot;add and commit&quot;</span><br></pre></td></tr></table></figure>
<p><strong>1.4 远程提交</strong></p><br><p>提交到远程仓库上：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将 master 提交到 origin 上</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>
<p>这一步操作可能会出现很多的问题，比如：</p><br><p>a) origin为一个多人开发的库，别人在你提交之前已经向 origin 上提交过一次（或者多次），那么此时你的版本是落后于远程服务器版本的，你需要先拉去线上最新的代码：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 拉去远程分支到 master</span><br><span class="line">git pull origin master</span><br></pre></td></tr></table></figure>
<p>b) 执行 a) 之后，有可能也会有提醒：存在冲突，需要合并分支，这个在后面会提到</p><br><p>c) 如果你很自信，觉得线上的版本是存在问题，你这个版本木有问题，你可以强制提交你的代码</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin master -f</span><br></pre></td></tr></table></figure>
<p>这里需要特别注意，加了 -f 线上之前的修改就会被删掉，请谨慎使用！</p><br><h3>二、进阶操作指南</h3><br><p>上面是最基本的几条命令，初用 git 的童鞋一般也只会接触这些东西，在一些复杂的多人开发项目中，修改代码、合并代码十分频繁，上面的命令显然是不够用了。在介绍进阶命令之前，先了解下 git 的三种状态。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-----------+      +-----------+       +-----------+</span><br><span class="line">|           |      |           |       |           |</span><br><span class="line">|  working  | --&gt;  |   index   |  --&gt;  |  commit   |</span><br><span class="line">|           |      |           |       |           |</span><br><span class="line">+-----------+      +-----------+       +-----------+</span><br><span class="line">      ↓                  ↓                   ↓</span><br><span class="line">   当前操作            git add            git commit</span><br><span class="line"></span><br><span class="line">                              &lt;Created By Barret Lee&gt;</span><br></pre></td></tr></table></figure>
<p></p>
<p>你当前的操作状态下，所有文件的状态都在 work 状态，当你执行 git add 之后，文件状态变为 index，也就是在 git 中已经有过一次登记了，而 git commit 之后就被编入了分支，成为 commited 状态了。需要注意的是，这三种状态一直存在，只是会有不同的文件来对应这些状态。</p><br><h4>1. 场景切换</h4><br><blockquote><br><p>Barret 有一天敲代码，代码敲了一半，Boss 跟他说，线上出了个 bug，赶紧的，去修复！</p><br></blockquote><br><p>咋办？上面那堆代码，敲了半个上午啊，重新新建一个文件夹，然后把线上代码再克隆一次修改？这种处理的成本显然太高了！其实 git 为我们提供了很好用的命令 git stash。只要在当前目录下操作：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash</span><br></pre></td></tr></table></figure>
<p>这句命令执行完毕之后，git 管理区中的 stash 会多出一条记录，这条记录保存了上一次提交到目前，你所有的修改:</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">last commit ... working file now</span><br></pre></td></tr></table></figure>
<p>接着你就可以修改你的 bug 了，修改完了之后，再使用</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash pop</span><br></pre></td></tr></table></figure>
<p>将之前保存的修改（场景）还原回来。其内部的原理也是很简单的：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+---------------+      +-----------+      +-----------+       +-----------+</span><br><span class="line">|               |      |           |      |           |       |           |</span><br><span class="line">|  last commit  | --&gt;  |  working  | --&gt;  |   index   |  --&gt;  |  commit   |</span><br><span class="line">|               |      |           |      |           |       |           |</span><br><span class="line">+---------------+  ↑   +-----------+      +-----------+   |   +-----------+</span><br><span class="line">      ↓            |         ↓                  ↓         |          ↓</span><br><span class="line">   上次提交         |      当前操作            git add      |    git commit</span><br><span class="line">                   |                                     s|</span><br><span class="line">                   |                                     t|</span><br><span class="line">                   |       +---------+                   a|</span><br><span class="line">                   |       | Stash 0 |                   s|</span><br><span class="line">                   |       +---------+                   h|</span><br><span class="line">                   +------ | Stash 1 | &lt;------------------+</span><br><span class="line">                           +---------+</span><br><span class="line">                           |  ....   |</span><br><span class="line">                           +---------+</span><br><span class="line">                           | Stash n |</span><br><span class="line">                           +---------+</span><br><span class="line">                                ↓                    &lt;Created By Barret Lee&gt;</span><br><span class="line">                             stash堆栈</span><br></pre></td></tr></table></figure>
<p>有些童鞋可能看不太懂上面的图，git 有一个场景（stash）堆栈，这个堆栈的作用是用于保存修改的，下面举个例子：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 进入文件夹</span><br><span class="line">$ cd test</span><br><span class="line"># 初始化 git</span><br><span class="line">$ it init</span><br><span class="line"># 新建四个文件</span><br><span class="line">$ touch f1 f2 f3 f4</span><br></pre></td></tr></table></figure>
<p>上面初始化一个 git ，然后新建了四个文件</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 修改 f1</span><br><span class="line">$ echo &quot;1&quot; &gt; f1</span><br><span class="line"># 将修改 push 到 stash 栈堆中</span><br><span class="line">$ git stash</span><br></pre></td></tr></table></figure>
<p>上面修改了文件 f1，并保存到场景栈堆中</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 查看 stash 栈堆</span><br><span class="line">$ git stash list</span><br><span class="line">  stash@&#123;0&#125;: WIP on master: 7f58be2 3</span><br></pre></td></tr></table></figure>
<p>查看栈堆，可以看到 stash@{0}</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 修改 f2</span><br><span class="line">$ echo &quot;1&quot; &gt; f2</span><br><span class="line"># 添加修改</span><br><span class="line">$ git add .</span><br><span class="line"># 将修改 push 到 stash 栈堆中</span><br><span class="line">$ git stash</span><br></pre></td></tr></table></figure>
<p>修改文件 f2，添加之后保存到栈堆之中</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查看 stash 栈堆</span><br><span class="line">$ git stash list</span><br><span class="line">    stash@&#123;0&#125;: WIP on master: 7f58be2 3</span><br><span class="line">    stash@&#123;1&#125;: WIP on master: 7f58be2 3</span><br></pre></td></tr></table></figure>
<p>栈堆中多了一个 stash@{1}，这个时候我们去修复 bug，改变其他位置的代码，完了之后：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># pop 栈堆，还原修改</span><br><span class="line">$ git stash pop</span><br></pre></td></tr></table></figure>
<p>上面我们将栈堆 pop 出来，遵循后进先出的规则</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查看文件状态</span><br><span class="line">git status</span><br><span class="line">$ Changes not staged for commit:</span><br><span class="line">    changed: f2</span><br><span class="line">  please commit it</span><br></pre></td></tr></table></figure>
<p>以上代码都是我手动敲出来的，不是复制控制台的代码，大概就是这个么意思吧。关于 stash 的最后一个想说明的命令是：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash clear</span><br></pre></td></tr></table></figure>
<p>清空场景（stash）堆栈。</p><br><h4>2. 代码 diff</h4><br><p><strong>2.1 HEAD</strong></p><br><p>在介绍这块之前，也需要先了解几个基本的常识：</p><br><blockquote><br><p><strong>HEAD</strong>&nbsp; &nbsp; &nbsp;它表示上一次的 commit 版本</p><br><p><strong>HEAD~n</strong> 它表示第上 n 词的 commit 版本，这里的 n 是大于等于 1 的整数</p><br></blockquote><br><p>如果我们要比较上一次和这一次代码之间的差异，可以：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff HEAD~1 HEAD</span><br></pre></td></tr></table></figure>
<p>比较前第三次与现在代码的差异，可以：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff HEAD~3 HEAD</span><br></pre></td></tr></table></figure>
<p>获取前第n次的还有另外一种方式，如前第二次：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HEAD^^</span><br></pre></td></tr></table></figure>
<p>前第五次：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HEAD^^^^^</span><br></pre></td></tr></table></figure>
<p>这样写起来比较累，还是前面的方式比较顺手。</p><br><p><strong>2.2 SHA</strong></p><br><p>关于 SHA 标识的介绍，我这里就懒得打字了，可以看我之前分享的<a href="http://hi.barretlee.com/2014/04/28/git-roll-back/" target="_blank">一点东西</a>，使用</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure>
<p>可以看到每次 commit 的 SHA 标识。要比较两次提交之间的差异，可以直接</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff SHA1 SHA2</span><br></pre></td></tr></table></figure>
<p>其中 SHA1 和 SHA2 是两次提交（commit）时的标识。</p><br><p><strong>2.3 与场景的比较</strong></p><br><p>这个用的比较少，对比目前代码跟最近一次 push 的场景代码差异：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --cached</span><br></pre></td></tr></table></figure>
<p>从字面上也好理解，就是跟缓存的文件做对比嘛~</p><br><h4>3. 版本回退</h4><br><p>如果上面的 SHA，working，index，commit 几种状态和标识没有弄明白，相信这里也是十分难理解的。</p><br><p>版本回退使用的命令是：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset</span><br></pre></td></tr></table></figure>
<p><strong>3.1 三种操作</strong></p><br><p>这个命令后面是要加参数的，分别为：</p><br><p><strong>a) filename</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset HEAD filename  # 从暂存区移除文件</span><br></pre></td></tr></table></figure>
<p>如果之前有 add filename，上面的命令操作之后，filename 将处于未被 add 的状态。也就是从 index 转变成 working 状态。</p><br><p><strong>b) HEAD</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD~n</span><br></pre></td></tr></table></figure>
<p>直接回退到前第 n 个版本。</p><br><p><strong>c) SHA</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard SHA</span><br></pre></td></tr></table></figure>
<p>回到 SHA 对应的 commit 的版本。</p><br><p><strong>3.2 三种方式</strong></p><br><p>上面我们使用的是 <code>–hard</code> 来 reset 代码，这样风险是特别大的，这里有三个可选参数：</p><br><ul><br><li><code>–hard</code> 回退版本，代码也回退，忽略所有修改</li><br><li><code>–soft</code> 回退版本，代码不变，回退所有的 add 操作</li><br><li><code>–mixed</code> 回退版本，代码不变，保留 add 操作</li><br></ul><br><h4>4. 分支处理</h4><br><p><strong>4.1 查看分支</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure>
<p>这是最简单的查看，查看本地创建了哪些分支。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -va</span><br></pre></td></tr></table></figure>
<p>查看本地+远程分支，及其详细信息（上次提交commit信息）</p><br><p><strong>4.2 添加分支</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch branch_name</span><br></pre></td></tr></table></figure>
<p>如果你当前所在的分支是 master，此处创建的分支会直接继承 master 的所有修改历史。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -b branchnew branchold</span><br></pre></td></tr></table></figure>
<p><code>-b</code> 是 base 的意思，如果你有两个分支 A 和 B ，目前在 A 分支上，你先新建一个分支继承 B，此刻你有两个选择：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 选择一</span><br><span class="line"># 先切换到 B 分支上</span><br><span class="line">git checkout B</span><br><span class="line">git branch C</span><br><span class="line"></span><br><span class="line"># 选择二</span><br><span class="line">git branch -b C B</span><br></pre></td></tr></table></figure>
<p><strong>4.3 切换分支</strong></p><br><p><strong>a) 切换到本地分支</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout branch_name</span><br></pre></td></tr></table></figure>
<p><strong>b) 切换到远程分支</strong></p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout remotes/origin/branch_name</span><br><span class="line">git checkout branch_name</span><br></pre></td></tr></table></figure>
<p>详情请看之前分享的这篇文章，<a href="http://hi.barretlee.com/2014/04/30/switch-branch-in-git/" target="_blank">git切换到远程分支</a></p><br><p><strong>4.4 删除分支</strong></p><br><p>显切换到别的分支上，然后</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -d branch_name</span><br></pre></td></tr></table></figure>
<p>如果是远程分支：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin :branch_name</span><br></pre></td></tr></table></figure>
<p>在需要删除的分支前面加一个冒号OK了，push 上去之后，服务器上的分支自然就被删除了。</p><br><hr><br><br><br><br><br><p><strong><span>由于想写的内容实在太长，故打算下次再补充第二部分。</span></strong></p><br><p>下期预告：</p><br><blockquote><br><p> <strong>本节补充：</strong><br>   　　5. tag处理<br>   　　6. 仓库管理<br>  <strong>第三章 版本管理策略</strong><br>    <strong>第四章 看懂 diff</strong><br>    <strong>第五章 配置别名</strong> </p>

<p></p></blockquote><p></p>
<p>下次再做小结。</p>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.com/2014/05/04/2014-05-04-branch-in-regexp/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2014/05/04/2014-05-04-branch-in-regexp/" class="post-title-link" itemprop="https://handishenniu.com/page/16/index.html">正则中分支示例</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-05-04 00:00:00" itemprop="dateCreated datePublished" datetime="2014-05-04T00:00:00+08:00">2014-05-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>问题：</strong></p>
<pre><code>&quot;baddad&quot;.match(/([bd]ad?)*/)
</code></pre><p>为什么匹配的是dad而不是bad。</p>
<p><strong>回答：</strong></p>
<p>不是不匹配bad，而是已经匹配过了，* 号为贪婪模式，所以第一次匹配到 bad 之后会继续往后吞并字符，最后发现后面还有一个 dad 也适合，于是便把 baddad 全部匹配了，第二次匹配是分支匹配，前面的 [bd] 是两个分支，刚才第一个分支已经匹配完了，进入第二个分支<br>，也就是匹配 dad，所以第二个结果是dad就显而易见了。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://handishenniu.com/2014/05/02/2014-05-02-cb-ecmascript6-overview/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lion">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="撼地神牛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2014/05/02/2014-05-02-cb-ecmascript6-overview/" class="post-title-link" itemprop="https://handishenniu.com/page/16/index.html">ECMAScript 6入门</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-05-02 09:42:00" itemprop="dateCreated datePublished" datetime="2014-05-02T09:42:00+08:00">2014-05-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-12 18:10:11" itemprop="dateModified" datetime="2018-12-12T18:10:11+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/前端杂烩/" itemprop="url" rel="index"><span itemprop="name">前端杂烩</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="history-article">本文为归档内容,原始地址在 <a href="http://www.cnblogs.com/hustskyking/archive/2014/05/02/ecmascript6-overview.html" target="_blank">博客园</a>.</div>

<p>预计在2014年底，ECMAScript 6将会正式发布，他的草案在13年3月份被冻结，后续提出新特性将会移至ECMASript 7中。目前还没有哪款浏览器实现了ES6的全部内容，兼容性最强的一款要数FireFox了。具体情况可以在<a href="http://kangax.github.io/es5-compat-table/es6/" target="_blank">这里</a>查看。</p><br><p>关于 ECMAScript 6 草案，我在博客里头复制了一份，可以点击<a href="http://barretlee.com/ST/ES6/" target="_blank">这里</a>。</p><br><p>JavaScript的内容是越来越丰富，在ES6中还添加了模块（module）和类（class），感觉他已经失去了曾经的单纯了，不知道这些新功能的补充对开发者来说是福音还是负担。之前写过两篇关于ES6的文章，<a href="http://www.cnblogs.com/hustskyking/p/ES6-introduce.html" target="_blank" rel="noopener">ECMAScript 6 简介</a> 和 <a href="http://www.cnblogs.com/hustskyking/p/ES6-computed-properties.html" target="_blank" rel="noopener">ECMAScript 6中的let和const关键词</a>，本文将一一介绍ES6中的一些新特性。</p><br><p><strong>注意：如果想测试以下属性，请安装 0.11+ 版本的 node，并添加上 –harmony 参数。</strong></p><br><h3>一、let 和 const</h3><br><p>这个内容在 <a href="http://www.cnblogs.com/hustskyking/p/ES6-computed-properties.html" target="_blank" rel="noopener">ECMAScript 6中的let和const关键词</a>&nbsp;一文中已经介绍过了。简单来说就是一句话：ES6中引入了块级作用域，let的有效区间是他所在的 <code>{}</code> 大括号中。const 为常量，定义之后不能更改，也删除不了。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; const PI = 3.14;&gt; Object.getOwnPropertyDescriptor(window, PI)</span><br><span class="line">Object &#123;value: 3.1415, writable: false, enumerable: true, configurable: false&#125;</span><br></pre></td></tr></table></figure>
<p>writable 和 configurable 都是 false。</p><br><h3>二、多变量的模式赋值</h3><br><p>写过 coffee-script 的人都知道，我们可以这样给一个数据赋值：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num[1..3] = [&quot;hello&quot;, &quot;i&apos;am&quot;, &quot;Barret Lee&quot;]</span><br></pre></td></tr></table></figure>
<p>ES6中也允许类似的多变量赋值：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var [x, y, z] = [&quot;hello&quot;, &quot;i&apos;am&quot;, &quot;Barret Lee&quot;];</span><br></pre></td></tr></table></figure>
<p>更强大的是，他还适合对象：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var &#123; foo, bar &#125; = &#123; foo: &quot;Barret&quot;, bar: &quot;Lee&quot; &#125;;</span><br></pre></td></tr></table></figure>
<p>这种赋值方式是模式匹配的，只要左侧跟右侧对应，便可以成功赋值。感觉新手不会太适应这种写法。</p><br><h3>三、数组推导</h3><br><p>先看例子：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var a1 = [1, 2, 3, 4];</span><br><span class="line">var a2 = [i * 2 for (i of a1)];</span><br><span class="line"></span><br><span class="line">a2 // [2, 4, 6, 8]</span><br></pre></td></tr></table></figure>
<p>这东西只是简化了编程，没有从根本上增加功能和特性，写 coffee 的人应该比较喜欢，我看着还是有点不习惯，其实上面的写法就等价于：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var a1 = [1, 2, 3, 4];</span><br><span class="line">var a2 = a1.map(function (i) &#123; return i * 2 &#125;);</span><br></pre></td></tr></table></figure>
<p>我想除非是代码长度有限制，否则这玩意儿正式出来了我也不会用它。</p><br><h3>四、字符串的扩展</h3><br><p>这一块的内容相当于是给 JS 编码打一个补丁，这个补丁用来弥补双字节 UTF-16 字符带来的问题，引入的各个函数也只是对不同场景的修复。这个扩展还是相当重要的，尤其是 ArrayBuffer 中数据类型的相关处理，涉及到很多类似 Float64Array Uint32Array 等类型化数组的处理，我在 <a href="http://www.cnblogs.com/hustskyking/p/javascript-array.html" target="_blank" rel="noopener">你所不知道的JavaScript数组</a> 曾提到过。</p><br><h4>1. codePointAt</h4><br><p>这个地方需要解释下 JavaScript 对字符的储存模式，JavaScript 中的字符串是以 UTF-16 为代码单元，通常我们使用的字符范围都在 Unicode 值 0x10000 以内，他们对应的 UTF-16 就是它们自身，但 Unicode 中也存在这个范围之外的字符，这时候就需要两个 UTF-16 字符来描述，比如：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(&quot;𠐀&quot;.length); //2</span><br></pre></td></tr></table></figure>
<p>因为字符串的 length 表示的并不是字符个数，而是 UTF-16 的单元个数。关于这方面知识的具体介绍，可以戳<a href="http://www.web-tinker.com/article/20468.html" target="_blank">这里</a>。</p><br><p>ES6提供了 codePointAt 函数来正确处理 4 个字节储存的字符。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var s = &quot;𠐀二&quot;;</span><br><span class="line">s.codePointAt(0);</span><br></pre></td></tr></table></figure>
<p>codePointAt 会把 s 中的两个字符都正确解析出来，相当于智能的将储存单元切换为 2 或者 4.</p><br><h4>2. fromCodePoint</h4><br><p>对应 String.fromCharCode 的能够智能解析 s 的函数是 String.fromCodePoint</p><br><h4>3. 字符的Unicode表示法</h4><br><p>我们知道可以使用 \u0000-\uFFFF 来表示一个 Unicode 字符，依然是上面的问题，如果字符超出了这个范围，比如 “\u10000” 这个字符，便不能正确的解析出来，ES6中可以这样：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#\u&#123;10000&#125;</span><br></pre></td></tr></table></figure>
<p>用大括号括起来就可以正常解析超过 FFFF 的字符了。</p><br><h4>4. 正则修饰符 u</h4><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/^.$/.test(&quot;𠐀&quot;) // false</span><br><span class="line">/^..$/.test(&quot;𠐀&quot;) // true</span><br><span class="line">/^.$/u.test(&quot;𠐀&quot;) // true</span><br></pre></td></tr></table></figure><br><br><p>看到上面三个测试，相信你已经知道是什么意思了。</p><br><h4>5. 几个没啥意思的函数</h4><br><p>contains(), startsWith(), endsWith(), repeat()</p><br><p>都是对 String 的拓展，顾名就能思意。</p><br><h4>6. 模板字符串</h4><br><p>之前写过一篇关于 TEMPLATE 标签的<a href="http://i.cnblogs.com/javascript-template-tag" target="_blank" rel="noopener">文章</a>，这里我们又看到了一个跟模板相关的东西。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 字符串中嵌入变量</span><br><span class="line">var name = &quot;Bob&quot;, time = &quot;today&quot;;</span><br><span class="line">`Hello $&#123;name&#125;, how are you $&#123;time&#125;?`</span><br><span class="line"></span><br><span class="line">var x = 1;</span><br><span class="line">var y = 2;</span><br><span class="line">console.log(`$&#123; x &#125; + $&#123; y &#125; = $&#123; x + y&#125;`)</span><br><span class="line">// &quot;1 + 2 = 3&quot;</span><br></pre></td></tr></table></figure>
<p>配合 TEMPLATE 标签使用是比较方便的，不过 TEMPLATE 标签可以很方便的使用自定义标签，这个特性也不是很突出了。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;test&quot;&gt;</span><br><span class="line">  &lt;x-from&gt;DOM文档&lt;/x-from&gt;</span><br><span class="line">  &lt;x-name&gt;test元素&lt;/x-name&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;template id=&quot;temp&quot;&gt;</span><br><span class="line">  我是来自 &lt;strong&gt;&lt;content select=&quot;x-from&quot;&gt;&lt;/content&gt;&lt;/strong&gt;</span><br><span class="line">  中的 &lt;strong&gt;&lt;content select=&quot;x-name&quot;&gt;&lt;/content&gt;&lt;/strong&gt;</span><br><span class="line">  的数据。</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">var root = test.webkitCreateShadowRoot();</span><br><span class="line">root.appendChild(document.importNode(temp.content));</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p></p><h3>五、数值的扩展</h3><p></p>
<h4>1. 二进制和八进制表示法</h4>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0b111110111 === 503 // true</span><br><span class="line">0o767 === 503 // true</span><br></pre></td></tr></table></figure>
<p>前缀 0b 和 0o 表示二进制和八进制数值</p><br><h4>2. 扩展函数</h4><br><ul><br><li>Number.isFinite()</li><br><li>Number.isNaN()</li><br><li>Number.parseInt()</li><br><li>Number.parseFloat()</li><br><li>Number.isInteger()</li><br></ul><br><p>具体细节可以去 <a href="//developer.mozilla.org/en/" target="_blank">MDN</a> 上搜查。</p><br><h3>六、对象的扩展</h3><br><p>在 ES5.1 中我们看到了 Object 的灵活性提高了很多，加入了 create、defineProperty、freeze 等等很多十分有用的方法，而在 ES6 中，依然继续加强：</p><br><h4>1. <code>Object.is()</code></h4><br><p>比较严格相等，传入两个参数，其功能跟 <code>===</code> 差不多，不同的是：+0不等于-0，NaN与本身恒等</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+0 === -0 //true</span><br><span class="line">NaN === NaN // false</span><br><span class="line"></span><br><span class="line">Object.is(+0, -0) // false</span><br><span class="line">Object.is(NaN, NaN) // true</span><br></pre></td></tr></table></figure>
<h4>2. proto属性</h4>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.__proto__ = otherObj;</span><br></pre></td></tr></table></figure>
<p>这东西浏览器早就实现了，只是在 ES6 才被纳入标准中，还记得这东西被用来判断是否为 IE 么：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var isIE = &quot;__proto__&quot; in &#123;&#125; ? false : true;</span><br></pre></td></tr></table></figure>
<h4>3. 增强的对象写法</h4><br><p>又是一个装饰品：</p><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var Person = &#123;</span><br><span class="line">  name: &apos;Barret Lee&apos;,</span><br><span class="line"></span><br><span class="line">  //等同于birth: birth</span><br><span class="line">  birth,</span><br><span class="line"></span><br><span class="line">  // 等同于hello: function ()...</span><br><span class="line">  hello() &#123; console.log(&apos;My Name Is&apos;, this.name); &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br><br><h4>4. 允许变量渗入 key 中</h4>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var name = &quot;my name&quot;;</span><br><span class="line">var Me = &#123;</span><br><span class="line">    [name]: &quot;Barret Lee&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;李靖&quot;</span><br><span class="line">&#125;;</span><br><span class="line">Me[name]       // &quot;Barret Lee&quot;</span><br><span class="line">Me[&quot;my name&quot;]  // &quot;Barret Lee&quot;</span><br><span class="line">Me[&quot;name&quot;]     // &quot;李靖&quot;</span><br></pre></td></tr></table></figure>
<p>挺方便的，不过容易出错，比如上面，看晕了吧~</p><br><h4>5. Symbol</h4><br><p>一种从类型上区分数据的工具，他是一个原始类型的值，不是对象，很适合做标识符。</p><br><h4>6. Proxy</h4><br><p>Proxy 内置的一个代理工具，使用他可以在对象处理上加一层屏障：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var plain = &#123;</span><br><span class="line">    name : &quot;Barret Lee&quot;</span><br><span class="line">&#125;;</span><br><span class="line">var proxy = new Proxy(plain, &#123;</span><br><span class="line">    get: function(target, property) &#123;</span><br><span class="line">        return property in target ? target[property] : &quot;我擦&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">proxy.name // &quot;Barret Lee&quot;</span><br><span class="line">proxy.title // &quot;我擦&quot;</span><br></pre></td></tr></table></figure>
<p>Proxy(target, handler), 这里的 handler 可以是 set get has hasOwn keys 等等方法，具体可以移步这里：<a href="http://wiki.ecmascript.org/doku.php?id=harmony:direct_proxies" target="_blank">http://wiki.ecmascript.org/doku.php?id=harmony:direct_proxies</a></p><br><h3>七、函数的扩展</h3><br><h4>1. 参数设置默认值</h4><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Point(x = 0, y = 0) &#123;</span><br><span class="line">   this.x = x;</span><br><span class="line">   this.y = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var p = new Point();</span><br><span class="line">// p = &#123; x:0, y:0 &#125;</span><br></pre></td></tr></table></figure><br><br><p>他这个参数可以初始化相当于暴露更多的底层接口吧，提高了函数的拓展性。</p><br><h4>2. rest运算符（…）</h4><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function add(...values) &#123;</span><br><span class="line">    let sum = 0;</span><br><span class="line"></span><br><span class="line">   for (var val of values) &#123;</span><br><span class="line">      sum += val;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   return sum;</span><br><span class="line">&#125;</span><br><span class="line">add(1, 2 ,3)  // 6</span><br></pre></td></tr></table></figure><br><br><p>这里的 values 需要用 val of values 来遍历。</p><br><h4>3. 箭头函数（=&gt;）</h4><br><p>之前写过 coffee ，所以对这个我还是比较熟悉的：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var f = (a, b) =&gt; &#123;return a + b&#125;;</span><br></pre></td></tr></table></figure>
<p>这个跟上面提到的一些内容一样，都是装饰性的，没太多用途。</p><br><h3>八、Set和Map数据结构</h3><br><h4>1. Set</h4><br><p>简单点解释，他就是一个没有重复数值的数组。或者说他就是一个数组的 hash 表。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var items = new Set([1,2,3,4,5,5,5,5]);</span><br><span class="line"></span><br><span class="line">for (i of s) &#123;console.log(i)&#125;</span><br><span class="line">// 2 3 4 5</span><br></pre></td></tr></table></figure>
<p>其遍历也是使用 val of values，他没有继承 Array 的方法，自己的几个方法是：</p><br><ul><br><li>size()：返回成员总数。</li><br><li>add(value)：添加某个值。</li><br><li>delete(value)：删除某个值。</li><br><li>has(value)：返回一个布尔值，表示该值是否为set的成员。</li><br><li>clear()：清除所有成员。</li><br></ul><br><p>转化为数组的方式：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var items = new Set([1, 2, 3, 4, 5]);</span><br><span class="line">var array = Array.from(items);</span><br></pre></td></tr></table></figure>
<p></p><h4>2. Map</h4><p></p>
<p>Map 是一个\超对象”，其 key 除了可以是 String 类型之外，还可以为其他类型（如：对象）</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var m = new Map();</span><br><span class="line"></span><br><span class="line">o = &#123;p: &quot;Hello World&quot;&#125;;</span><br><span class="line"></span><br><span class="line">m.set(o, &quot;content&quot;)</span><br><span class="line"></span><br><span class="line">console.log(m.get(o))</span><br><span class="line">// &quot;content&quot;</span><br></pre></td></tr></table></figure>
<p>他的方法和 Set 差不多：</p><br><ul><br><li>size：返回成员总数。</li><br><li>set(key, value)：设置一个键值对。</li><br><li>get(key)：读取一个键。</li><br><li>has(key)：返回一个布尔值，表示某个键是否在Map数据结构中。</li><br><li>delete(key)：删除某个键。</li><br><li>clear()：清除所有成员。</li><br><li>keys()：返回键名的遍历器。</li><br><li>values()：返回键值的遍历器。</li><br><li>entries()：返回所有成员的遍历器。</li><br></ul><br><h4>3. WeakMap</h4><br><p>如果说Map 是一个\超对象”，那 WeakMap 就是个 \弱超对象”，他的键值只能是除 null 以外的对象。他的存在是为了方便垃圾回收。</p><br><h3>八、遍历器（Iterator）</h3><br><p>相比 Array，他对数据的管理更为紧凑，而且可操纵性也比较强，以后会成为一个比较通用的 JS 工具。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function idMaker()&#123;</span><br><span class="line">    var index = 0;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">       next: function()&#123;</span><br><span class="line">           return &#123;value: index++, done: false&#125;;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var it = idMaker();</span><br><span class="line"></span><br><span class="line">it.next().value // &apos;0&apos;</span><br><span class="line">it.next().value // &apos;1&apos;</span><br><span class="line">it.next().value // &apos;2&apos;</span><br></pre></td></tr></table></figure>
<p>一个对象只要具备了next方法，就可以用for…of循环遍历它的值。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for (var n of it) &#123;</span><br><span class="line">  if (n &gt; 5)</span><br><span class="line">    break;</span><br><span class="line">  console.log(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><h3>九、Generator 函数</h3><p></p>
<p>Generator就是一个改装了的 Iterator 遍历器，通过 yield 来增加一个 next() 节点。</p><br><p>声明一个 Generator 的方法：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function * foo( input ) &#123;</span><br><span class="line">    var res = yield input;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用方式：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function * foo( input ) &#123;</span><br><span class="line">  var res = yield input;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var g = foo(10);</span><br><span class="line">g.next(); // &#123; value: 10, done: false &#125;</span><br><span class="line">g.next(); // &#123; value: undefined, done: true &#125;</span><br></pre></td></tr></table></figure>
<p>Genrator的标识就是函数名前面有个 <code>*</code> 号，由于每个 yield 都会增加一个 next() 节点，当我们在一个 Generator 中添加多个 yield 的时候：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function* G() &#123;</span><br><span class="line">    yield &apos;Barret&apos;;</span><br><span class="line">    yield &apos;Lee&apos;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var g = G();</span><br><span class="line">g.next(); // &quot;Barret&quot;</span><br><span class="line">g.next(); // &quot;Lee&quot;</span><br><span class="line">g.next(); // undefined</span><br><span class="line">g.next(); // Error: Generator has already finished</span><br></pre></td></tr></table></figure>
<p>相比 Iterator，我更喜欢 Generator。</p><br><h3>十、Promise 对象</h3><br><p>ES6将 Promise 纳入规范之后，很多浏览器根据 Promise/A+ 规范实现了一套 API，Promise对象是对异步操作的平坦式表达，避免了 callback hell，也就是多层嵌套的回调函数。这方面的东西可以参考我之前写的 <a href="http://www.cnblogs.com/hustskyking/p/javascript-asynchronous-programming.html" target="_blank" rel="noopener">JavaScript异步编程原理</a>.</p><br><p>这里是 <a href="http://promisesaplus.com/" target="_blank">Promise/A+</a> 规范文档，感兴趣的可以阅读一下。</p><br><p>在Promises/A规范中，每个任务都有三种状态：默认(pending)、完成(fulfilled)、失败(rejected)。</p><br><ul><br><li>默认状态可以单向转移到完成状态，这个过程叫resolve，对应的方法是deferred.resolve(promiseOrValue)；</li><br><li>默认状态还可以单向转移到失败状态，这个过程叫reject，对应的方法是deferred.reject(reason)；</li><br><li>默认状态时，还可以通过deferred.notify(update)来宣告任务执行信息，如执行进度；</li><br><li>状态的转移是一次性的，一旦任务由初始的pending转为其他状态，就会进入到下一个任务的执行过程中。</li><br></ul><br><h3>十一、Class和Module</h3><br><h4>1. Class</h4><br><p>Class，对象模板：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Point &#123;</span><br><span class="line"></span><br><span class="line">  constructor(x, y) &#123;</span><br><span class="line">    this.x = x;</span><br><span class="line">    this.y = y;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  toString() &#123;</span><br><span class="line">    return &apos;(&apos;+this.x+&apos;, &apos;+this.y+&apos;)&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一下子就有了 C++/Java 的感觉了，在类中可以使用 extends 继承：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class ColorPoint extends Point &#123;</span><br><span class="line"></span><br><span class="line">  constructor(x, y, color) &#123;</span><br><span class="line">    super(x, y); // same as super.constructor(x, y)</span><br><span class="line">    this.color = color;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  toString() &#123;</span><br><span class="line">    return this.color+&apos; &apos;+super();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><h4>2. Module</h4><p></p>
<p>之前在<a href="http://www.cnblogs.com/hustskyking/p/how-to-achieve-loading-module.html" target="_blank" rel="noopener">这篇文章</a>谈过模块化编程的必要性，时代在变化，需求也在变，ES6引入 Module 也算是与时俱进。ES6允许将独立的js文件作为模块，也就是说，允许一个JavaScript脚本文件调用另一个脚本文件，从而使得模块化编程成为可能。</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// circle.js</span><br><span class="line"></span><br><span class="line">export function area(radius) &#123;</span><br><span class="line">  return Math.PI * radius * radius;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function circumference(radius) &#123;</span><br><span class="line">  return 2 * Math.PI * radius;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们要引入 circle.js 的函数，可以：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// main.js</span><br><span class="line"></span><br><span class="line">import &#123; area, circumference &#125; from &apos;circle&apos;;</span><br><span class="line"></span><br><span class="line">console.log(&quot;圆面积：&quot; + area(4));</span><br><span class="line">console.log(&quot;圆周长：&quot; + circumference(14));</span><br></pre></td></tr></table></figure>
<p>如果要引入整个 circle 的内容：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// main.js</span><br><span class="line"></span><br><span class="line">module circle from &apos;circle&apos;;</span><br><span class="line"></span><br><span class="line">console.log(&quot;圆面积：&quot; + circle.area(4));</span><br><span class="line">console.log(&quot;圆周长：&quot; + circle.circumference(14));</span><br></pre></td></tr></table></figure>
<p>模块之间的继承使用这条命令：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// other.js</span><br><span class="line">export * from &apos;circle&apos;;</span><br></pre></td></tr></table></figure>
<p></p><p>这个东西，很好用，可惜了，纯洁的 JS，被糟蹋成啥样了=. =</p><p></p>
<p></p><h3>十二、感谢</h3><p></p>
<p></p><p>本文的书写逻辑参考阮一峰的<a href="http://es6.ruanyifeng.com/" target="_blank">总结</a>，并参入了一些个人主观色彩，感谢前人栽树！</p><p></p>
<p></p><h3>十三、参考资料</h3><p></p>
<ul><br><li><a href="http://es6.ruanyifeng.com/" target="_blank">http://es6.ruanyifeng.com/</a> 阮一峰</li><br><li><a href="http://www.web-tinker.com/article/20558.html" target="_blank">http://www.web-tinker.com/article/20558.html</a> <a href="http://www.web-tinker.com/article/20468.html" target="_blank">http://www.web-tinker.com/article/20468.html</a><br><a href="http://www.web-tinker.com/article/20520.html" target="_blank">http://www.web-tinker.com/article/20520.html</a> 次碳酸钴</li><br><li><a href="http://huangj.in/765" target="_blank">http://huangj.in/765</a> H-Jin</li><br><br></ul>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Lion</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">272</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">83</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">214</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lion</span>

  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  

  

  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  
  

  

  

  

  

  

  

  <script src="/js/src/music/aplayer.js?v=6.6.0"></script>
  <script src="/js/src/music/init.js?v=6.6.0"></script>
</body>
</html>
